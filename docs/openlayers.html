<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.3">
<title>IMLGS Map | IMLGS</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight,alt,wide.db1cdf55.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight,alt,wide.db1cdf55.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="modulepreload" href="./_observablehq/client.a43b0b69.js">
<link rel="modulepreload" href="./_observablehq/runtime.e080113b.js">
<link rel="modulepreload" href="./_observablehq/stdlib.55124be9.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/index.ce1bb9fa.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/control/defaults.b6fe9744.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/style/Style.ce8c497d.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/style/Fill.935f49e9.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/control/FullScreen.c659d18c.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/format/GeoJSON.dfad2cba.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/layer/Image.f064a46e.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/source/ImageWMS.2c233b74.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/source/ImageArcGISRest.f58a518d.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/source/OSM.e75af675.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/interaction/Select.7aedf649.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/source/StadiaMaps.81a4b2e6.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/style/Stroke.caf8f151.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/layer/Tile.50d0fe36.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/source/Vector.12e98de1.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/layer/Vector.4c685aa3.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/layer/WebGLVector.ea369a0a.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/format/WKB.83334c08.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/format/WMTSCapabilities.691399f7.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/source/WMTS.f19a4c38.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/tilegrid/WMTS.1b5e255e.js">
<link rel="modulepreload" href="./_node/ol@10.5.0/source/XYZ.dd63b3e0.js">
<link rel="modulepreload" href="./_observablehq/stdlib/duckdb.9cf34035.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.c9657b20.js">
<link rel="modulepreload" href="./_npm/@duckdb/duckdb-wasm@1.29.0/36014af5.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/72f4716c.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/18cbf477.js">
<link rel="modulepreload" href="./_node/rbush@4.0.1/index.6a49fb2b.js">
<link rel="modulepreload" href="./_node/earcut@3.0.1/index.8b5fc318.js">
<link rel="modulepreload" href="./_npm/apache-arrow@19.0.1/42e4d6a9.js">
<link rel="modulepreload" href="./_node/quickselect@3.0.0/index.ca231cf5.js">
<link rel="modulepreload" href="./_npm/tslib@2.8.1/b62a9c4a.js">
<link rel="modulepreload" href="./_npm/flatbuffers@24.12.23/ff64aefa.js">
<link rel="icon" href="./_file/observable.1af93621.png" type="image/png" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.a43b0b69.js";

define({id: "6870f0d2", inputs: ["DuckDBClient"], outputs: ["setupDatasource","source_table","datasource","imlgsdb","listColumns","columnStats","tableSummary"], body: async (DuckDBClient) => {
/**
 * Initialize a view of the remote data.
 * - create "imlgs" view
 */
async function setupDatasource(src, src_table) {
    const db = await DuckDBClient.of();
    // Spatial extension is loaded from observablehq.config.js
    //await db.query("install sptial");
    //await db.query("load spatial");
    await db.query(`create view ${src_table} as select * from read_parquet('${src}')`);
    return db;
}

const source_table = "imlgs";
const datasource = "https://s3.beehivebeach.com/imlgs/imlgs_full.parquet"
const imlgsdb = await setupDatasource(datasource, source_table);

async function listColumns(db, table) {
    const q = `select column_name, column_type from (describe ${table})`;
    const result = await db.query(q);
    //return Array.from(result, (row) => [row.column_name, row.column_type]);
    return result;
}

async function columnStats(db, table, column, key) {
    const q = `select '${key}' as k, min(${column}) as min, max(${column}) as max, count(distinct ${column}) as n from ${table}`;
    return await db.queryRow(q);
}

async function tableSummary(db, table) {
    const cols = await listColumns(db, table);
    const results = [];
    const tasks = [];
    let i = 0;
    for (const col of cols) {
        const row = {
            "Name": col.column_name,
            "Type": col.column_type,
            "Min": null,
            "Max": null,
            "n": null
        }
        results.push(row);
        if (["VARCHAR", "INT", "BIGINT"].includes(col.column_type)) {
            tasks.push(columnStats(db, table, col.column_name, i));
        }
        i += 1;
    }
    await Promise.all(tasks).then((values) => {
        for (const row of values) {
            results[row.k].Min = row.min;
            results[row.k].Max = row.max;
            results[row.k].n = row.n;
        }
    });
    return results;
}
return {setupDatasource,source_table,datasource,imlgsdb,listColumns,columnStats,tableSummary};
}});

define({id: "3cf9ef75", inputs: ["Inputs","display","Generators"], outputs: ["where_clause_join","_platform_input","_device_input","_repository_input","platform_input","device_input","repository_input"], body: (Inputs,display,Generators) => {
const where_clause_join = " AND ";

const _platform_input = Inputs.text({
        label:"Platform",
        submit: true}
    );
display(_platform_input);

const _device_input = Inputs.text({
        label:"Device",
        submit: true}
    );
display(_device_input);

const _repository_input = Inputs.text({
        label:"Repository",
        submit: true}
    );
display(_repository_input);

const platform_input = Generators.observe((notify) => {
    const inputted = () => notify({"v":_platform_input.value, "c": "regexp_matches(platform,?,'i')"});
    inputted();
    _platform_input.addEventListener("input", inputted);
    return () => _platform_input.removeEventListener("input", inputted);
})

const device_input = Generators.observe((notify) => {
    const inputted = () => notify({"v":_device_input.value, "c": "regexp_matches(device,?,'i')"});
    inputted();
    _device_input.addEventListener("input", inputted);
    return () => _device_input.removeEventListener("input", inputted);
})

const repository_input = Generators.observe((notify) => {
    const inputted = () => notify({"v":_repository_input.value, "c": "regexp_matches(facility.facility_code ,?,'i')"});
    inputted();
    _repository_input.addEventListener("input", inputted);
    return () => _repository_input.removeEventListener("input", inputted);
})

return {where_clause_join,_platform_input,_device_input,_repository_input,platform_input,device_input,repository_input};
}});

define({id: "a71de09f", inputs: ["where_clause_join","platform_input","device_input","repository_input"], outputs: ["getWhereClause","the_inputs"], body: (where_clause_join,platform_input,device_input,repository_input) => {
function getWhereClause(inputs) {
    const params = [];
    let where_clause = "";
    if (inputs.length > 0) {
        const clauses = [];
        for (const inp of inputs) {
            if (inp.v) {
                clauses.push(inp.c);
                params.push(inp.v);
            }
        }
        if (params.length > 0){
            where_clause += `${clauses.join(where_clause_join)}`;
        }
    }
    return {"params":params, "clause":where_clause};
}

const the_inputs = [platform_input, device_input, repository_input]
return {getWhereClause,the_inputs};
}});

define({id: "224d8d76", inputs: ["Mutable"], outputs: ["getIdFromURL","record_count","setRecordCount","selected_feature","setSelectedFeature"], body: (Mutable) => {
function getIdFromURL() {
    const hash = window.location.hash;
    if (hash.length > 0) {
        return hash.slice(1);
    }
    return null;
}

const record_count = Mutable("loading....");

const setRecordCount = (n) => {
    record_count.value = n;
}

const selected_feature = Mutable("");
const setSelectedFeature = (pid, v) => {
    selected_feature.value = v;
    window.location.hash = pid;
}

return {getIdFromURL,record_count,setRecordCount,selected_feature,setSelectedFeature};
}});

define({id: "a02e12e2", mode: "inline", inputs: ["record_count","display"], body: async (record_count,display) => {
display(await(
record_count
))
}});

define({id: "4842e7f8", mode: "inline", inputs: ["selected_feature","display"], body: async (selected_feature,display) => {
display(await(
selected_feature
))
}});

define({id: "71d8f66b", outputs: ["ol","defaultControls","CircleStyle","Fill","FullScreen","GeoJSON","ImageLayer","ImageWMS","ImageArcGISRest","OSM","Select","StadiaMaps","Stroke","Style","TileLayer","Vector","VectorLayer","VectorSource","WebGLVectorLayer","WKB","WMTSCapabilities","WMTS","optionsFromCapabilities","WMTSTileGrid","XYZ"], body: async () => {
const [ol, {defaults: defaultControls}, {default: CircleStyle}, {default: Fill}, {default: FullScreen}, {default: GeoJSON}, {default: ImageLayer}, {default: ImageWMS}, {default: ImageArcGISRest}, {default: OSM}, {default: Select}, {default: StadiaMaps}, {default: Stroke}, {default: Style}, {default: TileLayer}, {default: Vector}, {default: VectorLayer}, {default: VectorSource}, {default: WebGLVectorLayer}, {default: WKB}, {default: WMTSCapabilities}, {default: WMTS, optionsFromCapabilities}, {default: WMTSTileGrid}, {default: XYZ}] = await Promise.all([import("./_node/ol@10.5.0/index.ce1bb9fa.js"), import("./_node/ol@10.5.0/control/defaults.b6fe9744.js"), import("./_node/ol@10.5.0/style/Style.ce8c497d.js"), import("./_node/ol@10.5.0/style/Fill.935f49e9.js"), import("./_node/ol@10.5.0/control/FullScreen.c659d18c.js"), import("./_node/ol@10.5.0/format/GeoJSON.dfad2cba.js"), import("./_node/ol@10.5.0/layer/Image.f064a46e.js"), import("./_node/ol@10.5.0/source/ImageWMS.2c233b74.js"), import("./_node/ol@10.5.0/source/ImageArcGISRest.f58a518d.js"), import("./_node/ol@10.5.0/source/OSM.e75af675.js"), import("./_node/ol@10.5.0/interaction/Select.7aedf649.js"), import("./_node/ol@10.5.0/source/StadiaMaps.81a4b2e6.js"), import("./_node/ol@10.5.0/style/Stroke.caf8f151.js"), import("./_node/ol@10.5.0/style/Style.ce8c497d.js"), import("./_node/ol@10.5.0/layer/Tile.50d0fe36.js"), import("./_node/ol@10.5.0/source/Vector.12e98de1.js"), import("./_node/ol@10.5.0/layer/Vector.4c685aa3.js"), import("./_node/ol@10.5.0/source/Vector.12e98de1.js"), import("./_node/ol@10.5.0/layer/WebGLVector.ea369a0a.js"), import("./_node/ol@10.5.0/format/WKB.83334c08.js"), import("./_node/ol@10.5.0/format/WMTSCapabilities.691399f7.js"), import("./_node/ol@10.5.0/source/WMTS.f19a4c38.js"), import("./_node/ol@10.5.0/tilegrid/WMTS.1b5e255e.js"), import("./_node/ol@10.5.0/source/XYZ.dd63b3e0.js")]);
// OpenLayers pieces

return {ol,defaultControls,CircleStyle,Fill,FullScreen,GeoJSON,ImageLayer,ImageWMS,ImageArcGISRest,OSM,Select,StadiaMaps,Stroke,Style,TileLayer,Vector,VectorLayer,VectorSource,WebGLVectorLayer,WKB,WMTSCapabilities,WMTS,optionsFromCapabilities,WMTSTileGrid,XYZ};
}});

define({id: "2214507a", inputs: ["WMTSCapabilities","optionsFromCapabilities","ol","defaultControls","FullScreen","TileLayer","WMTS"], outputs: ["installMap","map"], body: async (WMTSCapabilities,optionsFromCapabilities,ol,defaultControls,FullScreen,TileLayer,WMTS) => {
/* Some other base layers

    new TileLayer({source: new OSM(),}),
    
    new ImageLayer({
        source: new ImageWMS({
            url: "https://wms.gebco.net/mapserv",
            params: {"LAYERS": "gebco_latest_sub_ice_topo"},
            ratio: 1
        })
    })

   new ImageLayer({
    source: new ImageArcGISRest({
        ratio: 1,
        params: {},
        //url: "https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"
        url: "https://services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"
    })
   })

    new TileLayer({
      source: new StadiaMaps({
        layer: 'alidade_satellite',
        retina: true
      })
    }),
*/


async function installMap(mapElement, infoElement) {
    // Setup the ESRI world ocean base layer
    const parser = new WMTSCapabilities();
    const response = await fetch("https://services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/WMTS/1.0.0/WMTSCapabilities.xml")
        .then(function (response) {
            return response.text();
        })
    const result = parser.read(response);
    const options = optionsFromCapabilities(result, {
        layer: 'Ocean_World_Ocean_Base',
        matrixSet: 'EPSG:3857',
    });
    options.wrapX = true;
    const _target = document.getElementById(mapElement);
    _target.innerHTML = `<div id='${infoElement}'></div>`;
    const map = new ol.Map({
        controls: defaultControls().extend([new FullScreen()]),
        layers: [
            new TileLayer({
                opacity: 1,
                source: new WMTS(options)
            }),
        ],
        target: _target,
        view: new ol.View({
            center: [0, 0],
            zoom: 2,
        }),
    });
    return map;
};
const map = await installMap('olmap', 'infooverlay');
return {installMap,map};
}});

define({id: "3a350b9b", inputs: ["imlgsdb"], outputs: ["map_data_layers","makeColors","repositoryStyle"], body: (imlgsdb) => {
const map_data_layers = {
    "samples": null
};
async function makeColors(db) {
    const query = "select distinct facility.facility_code as repository from imlgs";
    const results = await db.query(query);
    const data = [[173, 216, 230],
            [0, 191, 255],
            [30, 144, 255],
            [0,   0, 255],
            [0,   0, 139],
            [72,  61, 139],
            [123, 104, 238],
            [138,  43, 226],
            [128,   0, 128],
            [218, 112, 214],
            [255,   0, 255],
            [255,  20, 147],
            [176,  48,  96],
            [220,  20,  60],
            [240, 128, 128],
            [255,  69,   0],
            [255, 165,   0],
            [244, 164,  96],
            [240, 230, 140],
            [128, 128,   0],
            [139,  69,  19],
            [255, 255,   0],
            [154, 205,  50],
            [124, 252,   0],
            [144, 238, 144],
            [143, 188, 143],
            [34, 139,  34],
            [0, 255, 127],
            [0, 255, 255],
            [0, 139, 139],
            [128, 128, 128],
            [255, 255, 255]];
    const color_rules = ["case"];
    let last_c = 0;
    for (let row of results) {
        const c = data[last_c];
        last_c += 1;
        const _clr = `rgba(${c[0]},${c[1]},${c[2]},0.5)`;
        color_rules.push(["==",["get","repository"], row.repository]);
        color_rules.push(_clr)
    }
    color_rules.push("red");
    const _style = {
            'circle-radius': 2,
            'circle-fill-color': color_rules,
            'circle-stroke-color': 'gray',
            'circle-stroke-width': 0.5
    }
    return _style;
}

const repositoryStyle = makeColors(imlgsdb);
return {map_data_layers,makeColors,repositoryStyle};
}});

define({id: "f5a1016c", inputs: ["setRecordCount","VectorSource","where_clause_join","WKB","WebGLVectorLayer","repositoryStyle","getWhereClause","the_inputs","imlgsdb","map_data_layers","map","setSelectedFeature","getIdFromURL"], outputs: ["getRecord","getRecordCount","loadParquetLayer","selected","where_clause","selectStyle","info","currentFeature","res","displayFeatureInfo","_sel"], body: async (setRecordCount,VectorSource,where_clause_join,WKB,WebGLVectorLayer,repositoryStyle,getWhereClause,the_inputs,imlgsdb,map_data_layers,map,setSelectedFeature,getIdFromURL) => {
async function getRecord(db, imlgsid) {
    if (!imlgsid) {
        return "";
    }
    const columns = [
        "imlgs",
        "igsn",
        "platform",
        "cruise",
        "sample",
        "device",
        "water_depth",
        "facility",
        "ship_code",
        "links",
        "intervals",
        "storage_meth",
        "cored_length",
        "cored_diam",
        "pi",
        "igsn",
        "province",
        "lake",
        "leg",
        "sample_comments"
    ];
    let query = `SELECT ${columns.join(',')} FROM imlgs WHERE imlgs=?`;
    const res = await db.queryRow(query, [imlgsid]);
    return JSON.stringify(res, null, 2); 
}

async function getRecordCount(db, where_clause, params) {
    //const columns = view(Inputs.table(await tableSummary(imlgsdb, "imlgs")));
    let query = "select count(*) as n from imlgs";
    if (where_clause !== "") {
        query = query + " WHERE " + where_clause;
    }
    console.log(query);
    setRecordCount("...");
    const res = await db.queryRow(query, params);
    setRecordCount(res.n);
}

async function loadParquetLayer(db, where_clause="", params=[]) {
    const psource = new VectorSource();
    let _where = " where geometry is not null";
    if (where_clause !== "") {
        _where = _where + where_clause_join + where_clause;
    }
    const query = `select imlgs, ST_AsWKB(geometry) as wkb, facility.facility_code as repository, platform, begin_jd from imlgs ${_where}`;
    console.log(query);
    const data = await db.query(query, params);
    const format = new WKB();
    let i = 0;
    for (const row of data) {
        const feature = format.readFeature(row.wkb, {
            dataProjection: 'EPSG:4326',
            featureProjection: 'EPSG:3857',
        });
        feature.setId(row.imlgs);
        feature.set("repository", row.repository, true);
        feature.set("beginjd", row.begin_jd, true);
        psource.addFeature(feature);
        i += 1;
    }
    console.log(`rows: ${i}`);
    const player = new WebGLVectorLayer({
        source: psource,
        style: repositoryStyle
    });
    return player;
}

let selected = null;

const where_clause = getWhereClause(the_inputs);
getRecordCount(imlgsdb, where_clause.clause, where_clause.params);

loadParquetLayer(imlgsdb, where_clause.clause, where_clause.params).then((pql) => {
    //global the_map_layer;
    if (map_data_layers.samples !== null) {
        console.log("remove layer")
        map.removeLayer(map_data_layers.samples);
        //map_data_layers.samples.dispose();
    }
    console.log("Add layer");
    map_data_layers.samples = pql;
    map.addLayer(map_data_layers.samples);
});

function selectStyle(feature) {
  const color = feature.get('COLOR') || '#eeeeee';
  selected.getFill().setColor(color);
  return selected;
}

const info = document.getElementById('infooverlay');
let currentFeature;
let res = "";
const displayFeatureInfo = function(pixel, target) {
  const feature = target.closest('.ol-control')
    ? undefined
    : map.forEachFeatureAtPixel(pixel, function (feature) {
        return feature;
      });
  if (feature) {
    info.style.left = pixel[0] + 'px';
    info.style.top = pixel[1] + 'px';
    if (feature !== currentFeature) {
      info.style.visibility = 'visible';
      res = feature.getId();
      info.innerText = `${feature.get('repository')} : ${res}`;
    }
  } else {
    info.style.visibility = 'hidden';
    res = "";
  }
  currentFeature = feature;
  return res;
}

map.on('pointermove', function (evt) {
  if (evt.dragging) {
    info.style.visibility = 'hidden';
    currentFeature = undefined;
    return;
  }
  displayFeatureInfo(evt.pixel, evt.originalEvent.target);
});

map.on('click', async function (evt) {
  console.log(`Click ${ evt.originalEvent.target}`);
  const imlgsid = displayFeatureInfo(evt.pixel, evt.originalEvent.target);
  setSelectedFeature("", "");
  const res = await getRecord(imlgsdb, imlgsid);
  setSelectedFeature(imlgsid, res);
});

map.getTargetElement().addEventListener('pointerleave', function () {
  currentFeature = undefined;
  info.style.visibility = 'hidden';
});

const _sel = getIdFromURL();
if (_sel) {
    const res = await getRecord(imlgsdb, _sel);
    setSelectedFeature(_sel, res);
}
return {getRecord,getRecordCount,loadParquetLayer,selected,where_clause,selectStyle,info,currentFeature,res,displayFeatureInfo,_sel};
}});

</script>
</head>
<body>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">IMLGS</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./facet_test_1">Facet test</a></li>
    <li class="observablehq-link observablehq-link-active"><a href="./openlayers">IMLGS Map</a></li>
  </ol>
</nav>
<script>{const e=document.querySelector("#observablehq-sidebar"),o=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?o.checked=r==="true":o.indeterminate=!0;for(const t of document.querySelectorAll("#observablehq-sidebar summary")){const s=t.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${t.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
</nav>
</aside>
<main id="observablehq-main" class="observablehq">
<h1 id="imlgs" tabindex="-1"><a class="observablehq-header-anchor" href="#imlgs">IMLGS</a></h1>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.5.0/ol.css">
<style>
    .map {
        width: 100%;
        height: 600px; 
        position: relative;
    }
    .map:-webkit-full-screen {
        height: 100%;
        margin: 0;
    }
    .map:fullscreen {
        height: 100%;
    }
    #infooverlay {
        position: absolute;
        display: inline-block;
        height: auto;
        width: auto;
        z-index: 100;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 4px;
        padding: 5px;
        left: 50%;
        transform: translateX(3%);
        visibility: hidden;
        pointer-events: none;
        font-size: 0.8rem;
        font-family: monospace;
    }    
</style>    
<div class="observablehq observablehq--block"><!--:6870f0d2:--></div>
<div class="observablehq observablehq--block"><!--:3cf9ef75:--></div>
<div class="observablehq observablehq--block"><!--:a71de09f:--></div>
<div class="observablehq observablehq--block"><!--:224d8d76:--></div>
<p>There are <observablehq-loading></observablehq-loading><!--:a02e12e2:--> matching records.</p>
<!-- The map container -->
<div id="olmap" class="map">
    <div id="infooverlay"></div>
</div>
<pre><observablehq-loading></observablehq-loading><!--:4842e7f8:-->
</pre>
<div class="observablehq observablehq--block"><!--:71d8f66b:--></div>
<div class="observablehq observablehq--block"><!--:2214507a:--></div>
<div class="observablehq observablehq--block"><!--:3a350b9b:--></div>
<div class="observablehq observablehq--block"><!--:f5a1016c:--></div>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./facet_test_1"><span>Facet test</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2025-06-12T14:14:08">Jun 12, 2025</a>.</div>
</footer>
</div>
</body>
</html>
