import xt from"../../rbush@4.0.1/index.6a49fb2b.js";var w={ADD:"add",REMOVE:"remove"},k={PROPERTYCHANGE:"propertychange"},B={CHANGE:"change"};let Rt=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};var wt=Rt;function It(n,t,e){let s,r;e=e||Q;let i=0,o=n.length,a=!1;for(;i<o;)s=i+(o-i>>1),r=+e(n[s],t),r<0?i=s+1:(o=s,a=!r);return a?i:~i}function Q(n,t){return n>t?1:n<t?-1:0}function z(n,t){const e=Array.isArray(t)?t:[t],s=e.length;for(let r=0;r<s;r++)n[n.length]=e[r]}function Ct(n,t){const e=n.length;if(e!==t.length)return!1;for(let s=0;s<e;s++)if(n[s]!==t[s])return!1;return!0}function At(){return!0}function N(){}function Ft(n){let t,e,s;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==s||!Ct(r,e))&&(s=this,e=r,t=n.apply(this,arguments)),t}}function J(n){for(const t in n)delete n[t]}function L(n){let t;for(t in n)return!1;return!t}let Gt=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var T=Gt;let Pt=class extends wt{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const s=this.listeners_||(this.listeners_={}),r=s[t]||(s[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",s=e?t:t.type,r=this.listeners_&&this.listeners_[s];if(!r)return;const i=e?new T(t):t;i.target||(i.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});s in o||(o[s]=0,a[s]=0),++o[s];let h;for(let l=0,u=r.length;l<u;++l)if("handleEvent"in r[l]?h=r[l].handleEvent(i):h=r[l].call(this,i),h===!1||i.propagationStopped){h=!1;break}if(--o[s]===0){let l=a[s];for(delete a[s];l--;)this.removeEventListener(s,N);delete o[s]}return h}disposeInternal(){this.listeners_&&J(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const s=this.listeners_[t];if(!s)return;const r=s.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(s[r]=N,++this.pendingRemovals_[t]):(s.splice(r,1),s.length===0&&delete this.listeners_[t]))}};var bt=Pt;function b(n,t,e,s,r){if(r){const o=e;e=function(a){return n.removeEventListener(t,e),o.call(s??this,a)}}else s&&s!==n&&(e=e.bind(s));const i={target:n,type:t,listener:e};return n.addEventListener(t,e),i}function Z(n,t,e,s){return b(n,t,e,s,!0)}function M(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),J(n))}let S=class extends bt{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(B.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const s=t.length,r=new Array(s);for(let i=0;i<s;++i)r[i]=b(this,t[i],e);return r}return b(this,t,e)}onceInternal(t,e){let s;if(Array.isArray(t)){const r=t.length;s=new Array(r);for(let i=0;i<r;++i)s[i]=Z(this,t[i],e)}else s=Z(this,t,e);return e.ol_key=s,s}unInternal(t,e){const s=e.ol_key;if(s)$t(s);else if(Array.isArray(t))for(let r=0,i=t.length;r<i;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}};S.prototype.on,S.prototype.once,S.prototype.un;function $t(n){if(Array.isArray(n))for(let t=0,e=n.length;t<e;++t)M(n[t]);else M(n)}var Lt=S;let Tt=0;function v(n){return n.ol_uid||(n.ol_uid=String(++Tt))}let tt=class extends T{constructor(t,e,s){super(t),this.key=e,this.oldValue=s}},Mt=class extends Lt{constructor(t){super(),this.on,this.once,this.un,v(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let s;s=`change:${t}`,this.hasListener(s)&&this.dispatchEvent(new tt(s,t,e)),s=k.PROPERTYCHANGE,this.hasListener(s)&&this.dispatchEvent(new tt(s,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,s){const r=this.values_||(this.values_={});if(s)r[t]=e;else{const i=r[t];r[t]=e,i!==e&&this.notify(t,i)}}setProperties(t,e){for(const s in t)this.set(s,t[s],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const s=this.values_[t];delete this.values_[t],L(this.values_)&&(this.values_=null),e||this.notify(t,s)}}};var et=Mt;const st={LENGTH:"length"};let O=class extends T{constructor(t,e,s){super(t),this.element=e,this.index=s}},St=class extends et{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let s=0,r=this.array_.length;s<r;++s)this.assertUnique_(this.array_[s],s);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,s=t.length;e<s;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let s=0,r=e.length;s<r;++s)t(e[s],s,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(st.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new O(w.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let s=0,r=e.length;s<r;++s)if(e[s]===t)return this.removeAt(s)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new O(w.REMOVE,e,t)),e}setAt(t,e){const s=this.getLength();if(t>=s){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new O(w.REMOVE,r,t)),this.dispatchEvent(new O(w.ADD,e,t))}updateLength_(){this.set(st.LENGTH,this.array_.length)}assertUnique_(t,e){for(let s=0,r=this.array_.length;s<r;++s)if(this.array_[s]===t&&s!==e)throw new Error("Duplicate item added to a unique collection")}};var Ot=St;function q(n,t){if(!n)throw new Error(t)}function Dt(n,t){return n[0]<=t[0]&&t[2]<=n[2]&&n[1]<=t[1]&&t[3]<=n[3]}function Ut(){return[1/0,1/0,-1/0,-1/0]}function j(n,t,e,s,r){return r?(r[0]=n,r[1]=t,r[2]=e,r[3]=s,r):[n,t,e,s]}function Xt(n){return j(1/0,1/0,-1/0,-1/0,n)}function Nt(n,t){const e=n[0],s=n[1];return j(e,s,e,s,t)}function nt(n,t,e,s,r){const i=Xt(r);return qt(i,n,t,e,s)}function rt(n,t){return n[0]==t[0]&&n[2]==t[2]&&n[1]==t[1]&&n[3]==t[3]}function qt(n,t,e,s,r){for(;e<s;e+=r)jt(n,t[e],t[e+1]);return n}function jt(n,t,e){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}function it(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function ot(n){return n[3]-n[1]}function H(n){return n[2]-n[0]}function Ht(n,t){const e=t.getExtent(),s=it(n);if(t.canWrapX()&&(s[0]<e[0]||s[0]>=e[2])){const r=H(e),i=Math.floor((s[0]-e[0])/r)*r;n[0]-=i,n[2]-=i}return n}function Yt(n,t,e){if(t.canWrapX()){const s=t.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[s[0],n[1],s[2],n[3]]];Ht(n,t);const r=H(s);if(H(n)>r)return[[s[0],n[1],s[2],n[3]]];if(n[0]<s[0])return[[n[0]+r,n[1],s[2],n[3]],[s[0],n[1],n[2],n[3]]];if(n[2]>s[2])return[[n[0],n[1],s[2],n[3]],[s[0],n[1],n[2]-r,n[3]]]}return[n]}let Wt=!1;function Vt(n,t,e,s,r,i,o){const a=new XMLHttpRequest;a.open("GET",typeof n=="function"?n(e,s,r):n,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=Wt,a.onload=function(h){if(!a.status||a.status>=200&&a.status<300){const l=t.getType();try{let u;l=="text"||l=="json"?u=a.responseText:l=="xml"?u=a.responseXML||a.responseText:l=="arraybuffer"&&(u=a.response),u?i(t.readFeatures(u,{extent:e,featureProjection:r}),t.readProjection(u)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function at(n,t){return function(e,s,r,i,o){Vt(n,t,e,s,r,(a,h)=>{this.addFeatures(a),i!==void 0&&i(a)},()=>{this.changed(),o!==void 0&&o()})}}function Kt(n,t,e,s,r,i){const o=r-e,a=i-s;if(o!==0||a!==0){const h=((n-e)*o+(t-s)*a)/(o*o+a*a);h>1?(e=r,s=i):h>0&&(e+=o*h,s+=a*h)}return kt(n,t,e,s)}function kt(n,t,e,s){const r=e-n,i=s-t;return r*r+i*i}function Bt(n,t,e){return n+e*(t-n)}const Qt={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let zt=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Qt[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};var Y=zt;const $=6378137,I=Math.PI*$,Jt=[-I,-I,I,I],Zt=[-180,-85,180,85],D=$*Math.log(Math.tan(Math.PI/2));let C=class extends Y{constructor(t){super({code:t,units:"m",extent:Jt,global:!0,worldExtent:Zt,getPointResolution:function(e,s){return e/Math.cosh(s[1]/$)}})}};const ht=[new C("EPSG:3857"),new C("EPSG:102100"),new C("EPSG:102113"),new C("EPSG:900913"),new C("http://www.opengis.net/def/crs/EPSG/0/3857"),new C("http://www.opengis.net/gml/srs/epsg.xml#3857")];function te(n,t,e,s){const r=n.length;e=e>1?e:2,s=s??e,t===void 0&&(e>2?t=n.slice():t=new Array(r));for(let i=0;i<r;i+=s){t[i]=I*n[i]/180;let o=$*Math.log(Math.tan(Math.PI*(+n[i+1]+90)/360));o>D?o=D:o<-D&&(o=-D),t[i+1]=o}return t}function ee(n,t,e,s){const r=n.length;e=e>1?e:2,s=s??e,t===void 0&&(e>2?t=n.slice():t=new Array(r));for(let i=0;i<r;i+=s)t[i]=180*n[i]/I,t[i+1]=360*Math.atan(Math.exp(n[i+1]/$))/Math.PI-90;return t}const se=6378137,lt=[-180,-90,180,90],ne=Math.PI*se/180;let R=class extends Y{constructor(t,e){super({code:t,units:"degrees",extent:lt,axisOrientation:e,global:!0,metersPerUnit:ne,worldExtent:lt})}};const ut=[new R("CRS:84"),new R("EPSG:4326","neu"),new R("urn:ogc:def:crs:OGC:1.3:CRS84"),new R("urn:ogc:def:crs:OGC:2:84"),new R("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new R("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new R("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let W={};function re(n){return W[n]||W[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function ie(n,t){W[n]=t}let V={};function U(n,t,e){const s=n.getCode(),r=t.getCode();s in V||(V[s]={}),V[s][r]=e}const oe=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function ae(n){let t=0;for(const r of oe){const i=n.match(r);if(i){t=parseInt(i[1]);break}}if(!t)return null;let e=0,s=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(s=!0,e=t-32600),e?{number:e,north:s}:null}function he(n){return ae(n)?new Y({code:n,units:"m"}):null}const le=[he];function ft(n,t){if(t!==void 0){for(let e=0,s=n.length;e<s;++e)t[e]=n[e];t=t}else t=n.slice();return t}function ue(n){ie(n.getCode(),n),U(n,n,ft)}function fe(n){n.forEach(ue)}function ct(n){if(typeof n!="string")return n;const t=re(n);if(t)return t;for(const e of le){const s=e(n);if(s)return s}return null}function dt(n){fe(n),n.forEach(function(t){n.forEach(function(e){t!==e&&U(t,e,ft)})})}function ce(n,t,e,s){n.forEach(function(r){t.forEach(function(i){U(r,i,e),U(i,r,s)})})}function de(){dt(ht),dt(ut),ce(ut,ht,te,ee)}de();function _e(n,t){return[[-1/0,-1/0,1/0,1/0]]}function pe(n,t,e,s){const r=[];let i=Ut();for(let o=0,a=e.length;o<a;++o){const h=e[o];i=nt(n,t,h[0],s),r.push((i[0]+i[2])/2,(i[1]+i[3])/2),t=h[h.length-1]}return r}function _t(n,t,e,s,r,i){let o=0,a=n[e-s],h=n[e-s+1];for(;t<e;t+=s){const l=n[t],u=n[t+1];h<=i?u>i&&(l-a)*(i-h)-(r-a)*(u-h)>0&&o++:u<=i&&(l-a)*(i-h)-(r-a)*(u-h)<0&&o--,a=l,h=u}return o!==0}function ge(n,t,e,s,r,i){if(e.length===0||!_t(n,t,e[0],s,r,i))return!1;for(let o=1,a=e.length;o<a;++o)if(_t(n,e[o-1],e[o],s,r,i))return!1;return!0}function pt(n,t,e,s,r,i,o){let a,h,l,u,f,c,d;const _=r[i+1],p=[];for(let E=0,X=e.length;E<X;++E){const P=e[E];for(u=n[P-s],c=n[P-s+1],a=t;a<P;a+=s)f=n[a],d=n[a+1],(_<=c&&d<=_||c<=_&&_<=d)&&(l=(_-c)/(d-c)*(f-u)+u,p.push(l)),u=f,c=d}let g=NaN,y=-1/0;for(p.sort(Q),u=p[0],a=1,h=p.length;a<h;++a){f=p[a];const E=Math.abs(f-u);E>y&&(l=(u+f)/2,ge(n,t,e,s,l,_)&&(g=l,y=E)),u=f}return isNaN(g)&&(g=r[i]),o?(o.push(g,_,y),o):[g,_,y]}function Ee(n,t,e,s,r){let i=[];for(let o=0,a=e.length;o<a;++o){const h=e[o];i=pt(n,t,h,s,r,2*o,i),t=h[h.length-1]}return i}function gt(n,t,e,s,r,i,o){let a,h;const l=(e-t)/s;if(l===1)a=t;else if(l===2)a=t,h=r;else if(l!==0){let u=n[t],f=n[t+1],c=0;const d=[0];for(let g=t+s;g<e;g+=s){const y=n[g],E=n[g+1];c+=Math.sqrt((y-u)*(y-u)+(E-f)*(E-f)),d.push(c),u=y,f=E}const _=r*c,p=It(d,_);p<0?(h=(_-d[-p-2])/(d[-p-1]-d[-p-2]),a=t+(-p-2)*s):a=t+p*s}o=o>1?o:2,i=i||new Array(o);for(let u=0;u<o;++u)i[u]=a===void 0?NaN:h===void 0?n[a+u]:Bt(n[a+u],n[a+s+u],h);return i}function me(n,t,e,s){let r=0,i=n[e-s],o=n[e-s+1];for(;t<e;t+=s){const a=n[t],h=n[t+1];r+=(a-i)*(h+o),i=a,o=h}return r===0?void 0:r>0}function ve(n,t){const e=[];let s=0,r=0,i;for(let o=0,a=t.length;o<a;++o){const h=t[o],l=me(n,s,h,2);if(i===void 0&&(i=l),l===i)e.push(t.slice(r,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[r])}r=o+1,s=h}return e}function Et(n,t,e,s,r,i,o){const a=(e-t)/s;if(a<3){for(;t<e;t+=s)i[o++]=n[t],i[o++]=n[t+1];return o}const h=new Array(a);h[0]=1,h[a-1]=1;const l=[t,e-s];let u=0;for(;l.length>0;){const f=l.pop(),c=l.pop();let d=0;const _=n[c],p=n[c+1],g=n[f],y=n[f+1];for(let E=c+s;E<f;E+=s){const X=n[E],P=n[E+1],K=Kt(X,P,_,p,g,y);K>d&&(u=E,d=K)}d>r&&(h[(u-t)/s]=1,c+s<u&&l.push(c,u),u+s<f&&l.push(u,f))}for(let f=0;f<a;++f)h[f]&&(i[o++]=n[t+f*s],i[o++]=n[t+f*s+1]);return o}function ye(n,t,e,s,r,i,o,a){for(let h=0,l=e.length;h<l;++h){const u=e[h];o=Et(n,t,u,s,r,i,o),a.push(o),t=u}return o}function A(n,t){return t*Math.round(n/t)}function xe(n,t,e,s,r,i,o){if(t==e)return o;let a=A(n[t],r),h=A(n[t+1],r);t+=s,i[o++]=a,i[o++]=h;let l,u;do if(l=A(n[t],r),u=A(n[t+1],r),t+=s,t==e)return i[o++]=l,i[o++]=u,o;while(l==a&&u==h);for(;t<e;){const f=A(n[t],r),c=A(n[t+1],r);if(t+=s,f==l&&c==u)continue;const d=l-a,_=u-h,p=f-a,g=c-h;if(d*g==_*p&&(d<0&&p<d||d==p||d>0&&p>d)&&(_<0&&g<_||_==g||_>0&&g>_)){l=f,u=c;continue}i[o++]=l,i[o++]=u,a=l,h=u,l=f,u=c}return i[o++]=l,i[o++]=u,o}function Re(n,t,e,s,r,i,o,a){for(let h=0,l=e.length;h<l;++h){const u=e[h];o=xe(n,t,u,s,r,i,o),a.push(o),t=u}return o}function we(n,t,e,s,r,i,o){i=i||[],o=o||2;let a=0;for(let h=t;h<e;h+=s){const l=n[h],u=n[h+1];i[a++]=r[0]*l+r[2]*u+r[4],i[a++]=r[1]*l+r[3]*u+r[5];for(let f=2;f<o;f++)i[a++]=n[h+f]}return i&&i.length!=a&&(i.length=a),i}new Array(6);function Ie(){return[1,0,0,1,0,0]}function Ce(n,t,e,s,r,i,o,a){const h=Math.sin(i),l=Math.cos(i);return n[0]=s*l,n[1]=r*h,n[2]=-s*h,n[3]=r*l,n[4]=o*s*l-a*s*h+t,n[5]=o*r*h+a*r*l+e,n}const mt=Ie();class G{constructor(t,e,s,r,i,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=s||null,this.properties_=i,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Nt(this.flatCoordinates_):nt(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=it(this.getExtent());this.flatInteriorPoints_=pt(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=ve(this.flatCoordinates_,this.ends_),e=pe(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Ee(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=gt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const s=this.ends_;for(let r=0,i=s.length;r<i;++r){const o=s[r],a=gt(t,e,o,2,.5);z(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=ct(t);const e=t.getExtent(),s=t.getWorldExtent();if(e&&s){const r=ot(s)/ot(e);Ce(mt,s[0],s[3],r,-r,0,0,0),we(this.flatCoordinates_,0,this.flatCoordinates_.length,2,mt,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new G(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Ft((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const s=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":s.length=Et(s,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,s,0),r=[s.length];break;case"MultiLineString":r=[],s.length=ye(s,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,s,0,r);break;case"Polygon":r=[],s.length=Re(s,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),s,0,r);break}return r&&(this.simplifiedGeometry_=new G(this.type_,s,r,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}G.prototype.getFlatCoordinates=G.prototype.getOrientedFlatCoordinates;var F=G;class Ae{constructor(t){this.rbush_=new xt(t),this.items_={}}insert(t,e){const s={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(s),this.items_[v(e)]=s}load(t,e){const s=new Array(e.length);for(let r=0,i=e.length;r<i;r++){const o=t[r],a=e[r],h={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};s[r]=h,this.items_[v(a)]=h}this.rbush_.load(s)}remove(t){const e=v(t),s=this.items_[e];return delete this.items_[e],this.rbush_.remove(s)!==null}update(t,e){const s=this.items_[v(e)],r=[s.minX,s.minY,s.maxX,s.maxY];rt(r,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let s;for(let r=0,i=t.length;r<i;r++)if(s=e(t[r]),s)return s;return s}isEmpty(){return L(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return j(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}var vt=Ae;class Fe extends et{constructor(t){super(),this.projection=ct(t.projection),this.attributions_=yt(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(s,r){e.viewResolver=s,e.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=yt(t),this.changed()}setState(t){this.state_=t,this.changed()}}function yt(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),t=>n):null}var Ge=Fe,m={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class x extends T{constructor(t,e,s){super(t),this.feature=e,this.features=s}}class Pe extends Ge{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=N,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(q(this.format_,"`format` must be set when `url` is set"),this.loader_=at(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:_e;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new vt:null,this.loadedExtentsRtree_=new vt,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let s,r;Array.isArray(t.features)?r=t.features:t.features&&(s=t.features,r=s.getArray()),!e&&s===void 0&&(s=new Ot(r)),r!==void 0&&this.addFeaturesInternal(r),s!==void 0&&this.bindFeaturesCollection_(s)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=v(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const s=t.getGeometry();if(s){const r=s.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new x(m.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof F||(this.featureChangeKeys_[t]=[b(e,B.CHANGE,this.handleFeatureChange_,this),b(e,k.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let s=!0;if(e.getId()!==void 0){const r=String(e.getId());if(!(r in this.idIndex_))this.idIndex_[r]=e;else if(e instanceof F){const i=this.idIndex_[r];i instanceof F?Array.isArray(i)?i.push(e):this.idIndex_[r]=[i,e]:s=!1}else s=!1}return s&&(q(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),s}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],s=[],r=[];for(let i=0,o=t.length;i<o;i++){const a=t[i],h=v(a);this.addToIndex_(h,a)&&s.push(a)}for(let i=0,o=s.length;i<o;i++){const a=s[i],h=v(a);this.setupChangeEvents_(h,a);const l=a.getGeometry();if(l){const u=l.getExtent();e.push(u),r.push(a)}else this.nullGeometryFeatures_[h]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,r),this.hasListener(m.ADDFEATURE))for(let i=0,o=s.length;i<o;i++)this.dispatchEvent(new x(m.ADDFEATURE,s[i]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(m.ADDFEATURE,function(s){e||(e=!0,t.push(s.feature),e=!1)}),this.addEventListener(m.REMOVEFEATURE,function(s){e||(e=!0,t.remove(s.feature),e=!1)}),t.addEventListener(w.ADD,s=>{e||(e=!0,this.addFeature(s.element),e=!1)}),t.addEventListener(w.REMOVE,s=>{e||(e=!0,this.removeFeature(s.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const s in this.featureChangeKeys_)this.featureChangeKeys_[s].forEach(M);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(s=>{this.removeFeatureInternal(s)});for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new x(m.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const s=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(s,function(r){const i=r.getGeometry();if(i instanceof F||i.intersectsCoordinate(t))return e(r)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(s){const r=s.getGeometry();if(r instanceof F||r.intersectsExtent(t)){const i=e(s);if(i)return i}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),L(this.nullGeometryFeatures_)||z(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(s){e.push(s)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=Yt(t,e);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const s=t[0],r=t[1];let i=null;const o=[NaN,NaN];let a=1/0;const h=[-1/0,-1/0,1/0,1/0];return e=e||At,this.featuresRtree_.forEachInExtent(h,function(l){if(e(l)){const u=l.getGeometry(),f=a;if(a=u instanceof F?0:u.closestPointXY(s,r,o,a),a<f){i=l;const c=Math.sqrt(a);h[0]=s-c,h[1]=r-c,h[2]=s+c,h[3]=r+c}}}),i}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,s=v(e),r=e.getGeometry();if(!r)s in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[s]=e);else{const o=r.getExtent();s in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[s],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const i=e.getId();if(i!==void 0){const o=i.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[s]=e;this.changed(),this.dispatchEvent(new x(m.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:v(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&L(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,s){const r=this.loadedExtentsRtree_,i=this.strategy_(t,e,s);for(let o=0,a=i.length;o<a;++o){const h=i[o];r.forEachInExtent(h,function(l){return Dt(l.extent,h)})||(++this.loadingExtentsCount_,this.dispatchEvent(new x(m.FEATURESLOADSTART)),this.loader_.call(this,h,e,s,l=>{--this.loadingExtentsCount_,this.dispatchEvent(new x(m.FEATURESLOADEND,void 0,l))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new x(m.FEATURESLOADERROR))}),r.insert(h,{extent:h.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_,s=e.forEachInExtent(t,function(r){if(rt(r.extent,t))return r});s&&e.remove(s)}removeFeatures(t){let e=!1;for(let s=0,r=t.length;s<r;++s)e=this.removeFeatureInternal(t[s])||e;e&&this.changed()}removeFeature(t){t&&this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=v(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.featureChangeKeys_[e]?.forEach(M),delete this.featureChangeKeys_[e];const s=t.getId();if(s!==void 0){const r=s.toString(),i=this.idIndex_[r];i===t?delete this.idIndex_[r]:Array.isArray(i)&&(i.splice(i.indexOf(t),1),i.length===1&&(this.idIndex_[r]=i[0]))}return delete this.uidIndex_[e],this.hasListener(m.REMOVEFEATURE)&&this.dispatchEvent(new x(m.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){q(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(at(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}var be=Pe;export{x as VectorSourceEvent,be as default};
