var w={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function se(e){const t=lt();for(let i=0,n=e.length;i<n;++i)ft(t,e[i]);return t}function re(e,t){return Ne(e,t[0],t[1])}function Ne(e,t,i){return e[0]<=t&&t<=e[2]&&e[1]<=i&&i<=e[3]}function oe(e,t){const i=e[0],n=e[1],s=e[2],r=e[3],o=t[0],l=t[1];let a=w.UNKNOWN;return o<i?a=a|w.LEFT:o>s&&(a=a|w.RIGHT),l<n?a=a|w.BELOW:l>r&&(a=a|w.ABOVE),a===w.UNKNOWN&&(a=w.INTERSECTING),a}function lt(){return[1/0,1/0,-1/0,-1/0]}function Gt(e,t,i,n,s){return s?(s[0]=e,s[1]=t,s[2]=i,s[3]=n,s):[e,t,i,n]}function Ke(e){return Gt(1/0,1/0,-1/0,-1/0,e)}function He(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function ft(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function qe(e,t,i,n,s){for(;i<n;i+=s)Be(e,t[i],t[i+1]);return e}function Be(e,t,i){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],i),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],i)}function Ve(e,t){let i;return i=t(Lt(e)),i||(i=t(Ot(e)),i)||(i=t(Xt(e)),i)||(i=t(at(e)),i)?i:!1}function It(e){let t=0;return Je(e)||(t=M(e)*K(e)),t}function Lt(e){return[e[0],e[1]]}function Ot(e){return[e[2],e[1]]}function le(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function Qe(e,t){let i;if(t==="bottom-left")i=Lt(e);else if(t==="bottom-right")i=Ot(e);else if(t==="top-left")i=at(e);else if(t==="top-right")i=Xt(e);else throw new Error("Invalid corner");return i}function K(e){return e[3]-e[1]}function At(e,t,i){const n=lt();return jt(e,t)?(e[0]>t[0]?n[0]=e[0]:n[0]=t[0],e[1]>t[1]?n[1]=e[1]:n[1]=t[1],e[2]<t[2]?n[2]=e[2]:n[2]=t[2],e[3]<t[3]?n[3]=e[3]:n[3]=t[3]):Ke(n),n}function at(e){return[e[0],e[3]]}function Xt(e){return[e[2],e[3]]}function M(e){return e[2]-e[0]}function jt(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function Je(e){return e[2]<e[0]||e[3]<e[1]}function ti(e,t,i){let n=!1;const s=oe(e,t),r=oe(e,i);if(s===w.INTERSECTING||r===w.INTERSECTING)n=!0;else{const o=e[0],l=e[1],a=e[2],h=e[3],c=t[0],_=t[1],$=i[0],T=i[1],u=(T-_)/($-c);let d,f;r&w.ABOVE&&!(s&w.ABOVE)&&(d=$-(T-h)/u,n=d>=o&&d<=a),!n&&r&w.RIGHT&&!(s&w.RIGHT)&&(f=T-($-a)*u,n=f>=l&&f<=h),!n&&r&w.BELOW&&!(s&w.BELOW)&&(d=$-(T-l)/u,n=d>=o&&d<=a),!n&&r&w.LEFT&&!(s&w.LEFT)&&(f=T-($-o)*u,n=f>=l&&f<=h)}return n}function ei(e,t){const i=t.getExtent(),n=le(e);if(t.canWrapX()&&(n[0]<i[0]||n[0]>=i[2])){const s=M(i),r=Math.floor((n[0]-i[0])/s)*s;e[0]-=r,e[2]-=r}return e}function ii(e,t,i){if(t.canWrapX()){const n=t.getExtent();if(!isFinite(e[0])||!isFinite(e[2]))return[[n[0],e[1],n[2],e[3]]];ei(e,t);const s=M(n);if(M(e)>s,e[0]<n[0])return[[e[0]+s,e[1],n[2],e[3]],[n[0],e[1],e[2],e[3]]];if(e[2]>n[2])return[[e[0],e[1],n[2],e[3]],[n[0],e[1],e[2]-s,e[3]]]}return[e]}function zt(e,t,i){return Math.min(Math.max(e,t),i)}function ni(e){const t=e.length;for(let n=0;n<t;n++){let s=n,r=Math.abs(e[n][n]);for(let l=n+1;l<t;l++){const a=Math.abs(e[l][n]);a>r&&(r=a,s=l)}if(r===0)return null;const o=e[s];e[s]=e[n],e[n]=o;for(let l=n+1;l<t;l++){const a=-e[l][n]/e[n][n];for(let h=n;h<t+1;h++)n==h?e[l][h]=0:e[l][h]+=a*e[n][h]}}const i=new Array(t);for(let n=t-1;n>=0;n--){i[n]=e[n][t]/e[n][n];for(let s=n-1;s>=0;s--)e[s][t]-=e[s][n]*i[n]}return i}function ae(e){return e*180/Math.PI}function z(e){return e*Math.PI/180}function _t(e,t){const i=e%t;return i*t<0?i+t:i}function he(e,t){const i=Math.pow(10,t);return Math.round(e*i)/i}function mt(e,t){return Math.floor(he(e,t))}function pt(e,t){return Math.ceil(he(e,t))}function Zt(e,t,i){if(e>=t&&e<i)return e;const n=i-t;return((e-t)%n+n)%n+t}const ue={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let si=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||ue[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};var Yt=si;const ht=6378137,H=Math.PI*ht,ri=[-H,-H,H,H],oi=[-180,-85,180,85],xt=ht*Math.log(Math.tan(Math.PI/2));let q=class extends Yt{constructor(t){super({code:t,units:"m",extent:ri,global:!0,worldExtent:oi,getPointResolution:function(i,n){return i/Math.cosh(n[1]/ht)}})}};const ce=[new q("EPSG:3857"),new q("EPSG:102100"),new q("EPSG:102113"),new q("EPSG:900913"),new q("http://www.opengis.net/def/crs/EPSG/0/3857"),new q("http://www.opengis.net/gml/srs/epsg.xml#3857")];function li(e,t,i,n){const s=e.length;i=i>1?i:2,n=n??i,t===void 0&&(i>2?t=e.slice():t=new Array(s));for(let r=0;r<s;r+=n){t[r]=H*e[r]/180;let o=ht*Math.log(Math.tan(Math.PI*(+e[r+1]+90)/360));o>xt?o=xt:o<-xt&&(o=-xt),t[r+1]=o}return t}function ai(e,t,i,n){const s=e.length;i=i>1?i:2,n=n??i,t===void 0&&(i>2?t=e.slice():t=new Array(s));for(let r=0;r<s;r+=n)t[r]=180*e[r]/H,t[r+1]=360*Math.atan(Math.exp(e[r+1]/ht))/Math.PI-90;return t}const hi=6378137,ge=[-180,-90,180,90],ui=Math.PI*hi/180;let Z=class extends Yt{constructor(t,i){super({code:t,units:"degrees",extent:ge,axisOrientation:i,global:!0,metersPerUnit:ui,worldExtent:ge})}};const de=[new Z("CRS:84"),new Z("EPSG:4326","neu"),new Z("urn:ogc:def:crs:OGC:1.3:CRS84"),new Z("urn:ogc:def:crs:OGC:2:84"),new Z("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Z("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Z("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Wt={};function ci(e){return Wt[e]||Wt[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function gi(e,t){Wt[e]=t}function fe(e){for(const t in e)delete e[t]}function di(e){let t;for(t in e)return!1;return!t}let B={};function ut(e,t,i){const n=e.getCode(),s=t.getCode();n in B||(B[n]={}),B[n][s]=i}function Dt(e,t){return e in B&&t in B[e]?B[e][t]:null}const Et=.9996,y=.00669438,vt=y*y,Tt=vt*y,Y=y/(1-y),_e=Math.sqrt(1-y),V=(1-_e)/(1+_e),me=V*V,Ut=me*V,kt=Ut*V,pe=kt*V,xe=1-y/4-3*vt/64-5*Tt/256,fi=3*y/8+3*vt/32+45*Tt/1024,_i=15*vt/256+45*Tt/1024,mi=35*Tt/3072,pi=3/2*V-27/32*Ut+269/512*pe,xi=21/16*me-55/32*kt,Ei=151/96*Ut-417/128*pe,vi=1097/512*kt,$t=6378137;function Ti(e,t,i){const n=e-5e5,s=(i.north?t:t-1e7)/Et/($t*xe),r=s+pi*Math.sin(2*s)+xi*Math.sin(4*s)+Ei*Math.sin(6*s)+vi*Math.sin(8*s),o=Math.sin(r),l=o*o,a=Math.cos(r),h=o/a,c=h*h,_=c*c,$=1-y*l,T=Math.sqrt(1-y*l),u=$t/T,d=(1-y)/$,f=Y*a**2,x=f*f,m=n/(u*Et),E=m*m,p=E*m,g=p*m,S=g*m,L=S*m,P=r-h/d*(E/2-g/24*(5+3*c+10*f-4*x-9*Y))+L/720*(61+90*c+298*f+45*_-252*Y-3*x);let R=(m-p/6*(1+2*c+f)+S/120*(5-2*f+28*c-3*x+8*Y+24*_))/a;return R=Zt(R+z(Te(i.number)),-Math.PI,Math.PI),[ae(R),ae(P)]}const Ee=-80,ve=84,$i=-180,Pi=180;function Ri(e,t,i){e=Zt(e,$i,Pi),t<Ee?t=Ee:t>ve&&(t=ve);const n=z(t),s=Math.sin(n),r=Math.cos(n),o=s/r,l=o*o,a=l*l,h=z(e),c=Te(i.number),_=z(c),$=$t/Math.sqrt(1-y*s**2),T=Y*r**2,u=r*Zt(h-_,-Math.PI,Math.PI),d=u*u,f=d*u,x=f*u,m=x*u,E=m*u,p=$t*(xe*n-fi*Math.sin(2*n)+_i*Math.sin(4*n)-mi*Math.sin(6*n)),g=Et*$*(u+f/6*(1-l+T)+m/120*(5-18*l+a+72*T-58*Y))+5e5;let S=Et*(p+$*o*(d/2+x/24*(5-l+9*T+4*T**2)+E/720*(61-58*l+a+600*T-330*Y)));return i.north||(S+=1e7),[g,S]}function Te(e){return(e-1)*6-180+3}const wi=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function $e(e){let t=0;for(const s of wi){const r=e.match(s);if(r){t=parseInt(r[1]);break}}if(!t)return null;let i=0,n=!1;return t>32700&&t<32761?i=t-32700:t>32600&&t<32661&&(n=!0,i=t-32600),i?{number:i,north:n}:null}function Pe(e,t){return function(i,n,s,r){const o=i.length;s=s>1?s:2,r=r??s,n||(s>2?n=i.slice():n=new Array(o));for(let l=0;l<o;l+=r){const a=i[l],h=i[l+1],c=e(a,h,t);n[l]=c[0],n[l+1]=c[1]}return n}}function Mi(e){return $e(e)?new Yt({code:e,units:"m"}):null}function Si(e){const t=$e(e.getCode());return t?{forward:Pe(Ri,t),inverse:Pe(Ti,t)}:null}const Fi=63710088e-1;function Re(e,t,i){i=i||Fi;const n=z(e[1]),s=z(t[1]),r=(s-n)/2,o=z(t[0]-e[0])/2,l=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(s);return 2*i*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}const bi=[Si],yi=[Mi];function Nt(e,t){if(t!==void 0){for(let i=0,n=e.length;i<n;++i)t[i]=e[i];t=t}else t=e.slice();return t}function Kt(e){gi(e.getCode(),e),ut(e,e,Nt)}function Ci(e){e.forEach(Kt)}function I(e){if(typeof e!="string")return e;const t=ci(e);if(t)return t;for(const i of yi){const n=i(e);if(n)return n}return null}function we(e,t,i,n){e=I(e);let s;const r=e.getPointResolutionFunc();if(r)s=r(t,i);else{const o=e.getUnits();if(o=="degrees"||n=="degrees")s=t;else{const l=qt(e,I("EPSG:4326"));if(!l&&o!=="degrees")s=t*e.getMetersPerUnit();else{let h=[i[0]-t/2,i[1],i[0]+t/2,i[1],i[0],i[1]-t/2,i[0],i[1]+t/2];h=l(h,h,2);const c=Re(h.slice(0,2),h.slice(2,4)),_=Re(h.slice(4,6),h.slice(6,8));s=(c+_)/2}const a=e.getMetersPerUnit();a!==void 0&&(s/=a)}}return s}function Me(e){Ci(e),e.forEach(function(t){e.forEach(function(i){t!==i&&ut(t,i,Nt)})})}function Gi(e,t,i,n){e.forEach(function(s){t.forEach(function(r){ut(s,r,i),ut(r,s,n)})})}function Ii(e){return function(t,i,n,s){const r=t.length;n=n!==void 0?n:2,s=s??n,i=i!==void 0?i:new Array(r);for(let o=0;o<r;o+=s){const l=e(t.slice(o,o+n)),a=l.length;for(let h=0,c=s;h<c;++h)i[o+h]=h>=a?t[o+h]:l[h]}return i}}function Ht(e,t){if(e===t)return!0;const i=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||qt(e,t)===Nt)&&i}function qt(e,t){const i=e.getCode(),n=t.getCode();let s=Dt(i,n);if(s)return s;let r=null,o=null;for(const a of bi)r||(r=a(e)),o||(o=a(t));if(!r&&!o)return null;const l="EPSG:4326";if(o)if(r)s=Bt(r.inverse,o.forward);else{const a=Dt(i,l);a&&(s=Bt(a,o.forward))}else{const a=Dt(l,n);a&&(s=Bt(r.inverse,a))}return s&&(Kt(e),Kt(t),ut(e,t,s)),s}function Bt(e,t){return function(i,n,s,r){return n=e(i,n,s,r),t(n,n,s,r)}}function Se(e,t){const i=I(e),n=I(t);return qt(i,n)}function Fe(e,t,i){const n=Se(t,i);if(!n){const s=I(t).getCode(),r=I(i).getCode();throw new Error(`No transform available between ${s} and ${r}`)}return n(e,void 0,e.length)}function Li(){Me(ce),Me(de),Gi(de,ce,li,ai)}Li();function Oi(e,t,i){return i===void 0&&(i=[0,0]),i[0]=e[0]*t+.5|0,i[1]=e[1]*t+.5|0,i}function W(e,t){return Array.isArray(e)?e:(t===void 0?t=[e,e]:(t[0]=e,t[1]=e),t)}let be=class{constructor(t,i,n,s){this.minX=t,this.maxX=i,this.minY=n,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,i){return this.minX<=t&&t<=this.maxX&&this.minY<=i&&i<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}};function Q(e,t,i,n,s){return s!==void 0?(s.minX=e,s.maxX=t,s.minY=i,s.maxY=n,s):new be(e,t,i,n)}var Ai=be;function Xi(e,t){return e>t?1:e<t?-1:0}function ji(e,t,i){if(e[0]<=t)return 0;const n=e.length;if(t<=e[n-1])return n-1;if(typeof i=="function"){for(let s=1;s<n;++s){const r=e[s];if(r===t)return s;if(r<t)return i(t,e[s-1],r)>0?s-1:s}return n-1}if(i>0){for(let s=1;s<n;++s)if(e[s]<t)return s-1;return n-1}if(i<0){for(let s=1;s<n;++s)if(e[s]<=t)return s;return n-1}for(let s=1;s<n;++s){if(e[s]==t)return s;if(e[s]<t)return e[s-1]-t<t-e[s]?s-1:s}return n-1}function zi(e,t,i){const n=t||Xi;return e.every(function(s,r){if(r===0)return!0;const o=n(e[r-1],s);return!(o>0||o===0)})}function ct(e,t){if(!e)throw new Error(t)}function Pt(e,t,i,n,s,r){let o=0,l=e[i-n],a=e[i-n+1];for(;t<i;t+=n){const h=e[t],c=e[t+1];a<=r?c>r&&(h-l)*(r-a)-(s-l)*(c-a)>0&&o++:c<=r&&(h-l)*(r-a)-(s-l)*(c-a)<0&&o--,l=h,a=c}return o!==0}function Zi(e,t,i,n,s){let r;for(t+=n;t<i;t+=n)if(r=s(e.slice(t-n,t),e.slice(t,t+n)),r)return r;return!1}function Yi(e,t,i,n,s,r){return r=r??qe(lt(),e,t,i,n),jt(s,r)?r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:Zi(e,t,i,n,function(o,l){return ti(s,o,l)}):!1}function Wi(e,t,i,n,s){return!!(Yi(e,t,i,n,s)||Pt(e,t,i,n,s[0],s[1])||Pt(e,t,i,n,s[0],s[3])||Pt(e,t,i,n,s[2],s[1])||Pt(e,t,i,n,s[2],s[3]))}function ye(e,t,i,n){return n!==void 0?(n[0]=e,n[1]=t,n[2]=i,n):[e,t,i]}function Di(e){return Ui(e[0],e[1],e[2])}function Ui(e,t,i){return(t<<e)+i}function ki(e,t){const i=e[0],n=e[1],s=e[2];if(t.getMinZoom()>i||i>t.getMaxZoom())return!1;const r=t.getFullTileRange(i);return r?r.containsXY(n,s):!0}const Ni=42,Ce=256,J=[0,0,0],X=5;let Ki=class{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,ct(zi(this.resolutions_,(s,r)=>r-s),"`resolutions` must be sorted in descending order");let i;if(!t.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!i)i=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==i){i=void 0;break}}this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,ct(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=at(n)),ct(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,ct(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Ce,ct(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((s,r)=>{const o=new Ai(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(n){const l=this.getTileRangeForExtentAndZ(n,r);o.minX=Math.max(l.minX,o.minX),o.maxX=Math.min(l.maxX,o.maxX),o.minY=Math.max(l.minY,o.minY),o.maxY=Math.min(l.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,i,n){const s=this.getTileRangeForExtentAndZ(t,i);for(let r=s.minX,o=s.maxX;r<=o;++r)for(let l=s.minY,a=s.maxY;l<=a;++l)n([i,r,l])}forEachTileCoordParentTileRange(t,i,n,s){let r,o,l,a=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],l=t[2]):a=this.getTileCoordExtent(t,s);h>=this.minZoom;){if(o!==void 0&&l!==void 0?(o=Math.floor(o/2),l=Math.floor(l/2),r=Q(o,o,l,l,n)):r=this.getTileRangeForExtentAndZ(a,h,n),i(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,i,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const r=t[1]*2,o=t[2]*2;return Q(r,r+1,o,o+1,i)}const s=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,i)}return null}getTileRangeForTileCoordAndZ(t,i,n){if(i>this.maxZoom||i<this.minZoom)return null;const s=t[0],r=t[1],o=t[2];if(i===s)return Q(r,o,r,o,n);if(this.zoomFactor_){const a=Math.pow(this.zoomFactor_,i-s),h=Math.floor(r*a),c=Math.floor(o*a);if(i<s)return Q(h,h,c,c,n);const _=Math.floor(a*(r+1))-1,$=Math.floor(a*(o+1))-1;return Q(h,_,c,$,n)}const l=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,i,n)}getTileRangeForExtentAndZ(t,i,n){this.getTileCoordForXYAndZ_(t[0],t[3],i,!1,J);const s=J[1],r=J[2];this.getTileCoordForXYAndZ_(t[2],t[1],i,!0,J);const o=J[1],l=J[2];return Q(s,o,r,l,n)}getTileCoordCenter(t){const i=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=W(this.getTileSize(t[0]),this.tmpSize_);return[i[0]+(t[1]+.5)*s[0]*n,i[1]-(t[2]+.5)*s[1]*n]}getTileCoordExtent(t,i){const n=this.getOrigin(t[0]),s=this.getResolution(t[0]),r=W(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*r[0]*s,l=n[1]-(t[2]+1)*r[1]*s,a=o+r[0]*s,h=l+r[1]*s;return Gt(o,l,a,h,i)}getTileCoordForCoordAndResolution(t,i,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],i,!1,n)}getTileCoordForXYAndResolution_(t,i,n,s,r){const o=this.getZForResolution(n),l=n/this.getResolution(o),a=this.getOrigin(o),h=W(this.getTileSize(o),this.tmpSize_);let c=l*(t-a[0])/n/h[0],_=l*(a[1]-i)/n/h[1];return s?(c=pt(c,X)-1,_=pt(_,X)-1):(c=mt(c,X),_=mt(_,X)),ye(o,c,_,r)}getTileCoordForXYAndZ_(t,i,n,s,r){const o=this.getOrigin(n),l=this.getResolution(n),a=W(this.getTileSize(n),this.tmpSize_);let h=(t-o[0])/l/a[0],c=(o[1]-i)/l/a[1];return s?(h=pt(h,X)-1,c=pt(c,X)-1):(h=mt(h,X),c=mt(c,X)),ye(n,h,c,r)}getTileCoordForCoordAndZ(t,i,n){return this.getTileCoordForXYAndZ_(t[0],t[1],i,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,i){const n=ji(this.resolutions_,t,i||0);return zt(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,i){return Wi(i,0,i.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const i=this.resolutions_.length,n=new Array(i);for(let s=this.minZoom;s<i;++s)n[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=n}};var Ge=Ki;function Ie(e){let t=e.getDefaultTileGrid();return t||(t=Vi(e),e.setDefaultTileGrid(t)),t}function Hi(e,t,i){const n=t[0],s=e.getTileCoordCenter(t),r=Vt(i);if(!re(r,s)){const o=M(r),l=Math.ceil((r[0]-s[0])/o);return s[0]+=o*l,e.getTileCoordForCoordAndZ(s,n)}return t}function qi(e,t,i,n){n=n!==void 0?n:"top-left";const s=Le(e,t,i);return new Ge({extent:e,origin:Qe(e,n),resolutions:s,tileSize:i})}function Bi(e){const t=e||{},i=t.extent||I("EPSG:3857").getExtent(),n={extent:i,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Le(i,t.maxZoom,t.tileSize,t.maxResolution)};return new Ge(n)}function Le(e,t,i,n){t=t!==void 0?t:Ni,i=W(i!==void 0?i:Ce);const s=K(e),r=M(e);n=n>0?n:Math.max(r/i[0],s/i[1]);const o=t+1,l=new Array(o);for(let a=0;a<o;++a)l[a]=n/Math.pow(2,a);return l}function Vi(e,t,i,n){const s=Vt(e);return qi(s,t,i,n)}function Vt(e){e=I(e);let t=e.getExtent();if(!t){const i=180*ue.degrees/e.getMetersPerUnit();t=Gt(-i,-i,i,i)}return t}var tt={CHANGE:"change",ERROR:"error",LOAD:"load"};let Qi=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};var Ji=Qi;function Oe(){}let tn=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var Qt=tn;let en=class extends Ji{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,i){if(!t||!i)return;const n=this.listeners_||(this.listeners_={}),s=n[t]||(n[t]=[]);s.includes(i)||s.push(i)}dispatchEvent(t){const i=typeof t=="string",n=i?t:t.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const r=i?new Qt(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,l[n]=0),++o[n];let a;for(let h=0,c=s.length;h<c;++h)if("handleEvent"in s[h]?a=s[h].handleEvent(r):a=s[h].call(this,r),a===!1||r.propagationStopped){a=!1;break}if(--o[n]===0){let h=l[n];for(delete l[n];h--;)this.removeEventListener(n,Oe);delete o[n]}return a}disposeInternal(){this.listeners_&&fe(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,i){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const s=n.indexOf(i);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[s]=Oe,++this.pendingRemovals_[t]):(n.splice(s,1),n.length===0&&delete this.listeners_[t]))}};var Ae=en;function Rt(e,t,i,n,s){if(s){const o=i;i=function(l){return e.removeEventListener(t,i),o.call(this,l)}}const r={target:e,type:t,listener:i};return e.addEventListener(t,i),r}function wt(e,t,i,n){return Rt(e,t,i,n,!0)}function gt(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),fe(e))}const D=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",nn=D.includes("safari")&&!D.includes("chrom");nn&&(D.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(D)),D.includes("webkit")&&D.includes("edge"),D.includes("macintosh");const sn=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,rn=typeof Image<"u"&&Image.prototype.decode;(function(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e})();function on(e,t,i){const n=e;let s=!0,r=!1,o=!1;const l=[wt(n,tt.LOAD,function(){o=!0,r||t()})];return n.src&&rn?(r=!0,n.decode().then(function(){s&&t()}).catch(function(a){s&&(o?t():i())})):l.push(wt(n,tt.ERROR,i)),function(){s=!1,l.forEach(gt)}}var v={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function ln(e){return Math.pow(e,3)}function Xe(){throw new Error("Unimplemented abstract method.")}let an=0;function dt(e){return e.ol_uid||(e.ol_uid=String(++an))}let hn=class extends Ae{constructor(t,i,n){super(),n=n||{},this.tileCoord=t,this.state=i,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(tt.CHANGE)}release(){this.setState(v.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==v.EMPTY){if(this.state!==v.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){Xe()}getAlpha(t,i){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=i,this.transitionStarts_[t]=n;else if(n===-1)return 1;const s=i-n+1e3/60;return s>=this.transition_?1:ln(s/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}};var je=hn;function Mt(e,t,i,n){let s;return i&&i.length?s=i.shift():sn?s=new OffscreenCanvas(e||300,t||300):s=document.createElement("canvas"),e&&(s.width=e),t&&(s.height=t),s.getContext("2d",n)}function Jt(e){const t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}let un=class extends je{constructor(t,i,n,s,r,o){super(t,i,o),this.crossOrigin_=s,this.src_=n,this.key=n,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=v.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=v.ERROR,this.unlistenImage_(),this.image_=cn(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=v.LOADED:this.state=v.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==v.ERROR&&(this.state=v.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==v.IDLE&&(this.state=v.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=on(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};function cn(){const e=Mt(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}var gn=un;let te;const et=[];function ze(e,t,i,n,s){e.beginPath(),e.moveTo(0,0),e.lineTo(t,i),e.lineTo(n,s),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,n)+1,Math.max(i,s)),e.restore()}function ee(e,t){return Math.abs(e[t*4]-210)>2||Math.abs(e[t*4+3]-.75*255)>2}function dn(){if(te===void 0){const e=Mt(6,6,et);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",ze(e,4,5,4,0),ze(e,4,5,0,5);const t=e.getImageData(0,0,3,3).data;te=ee(t,0)||ee(t,4)||ee(t,8),Jt(e),et.push(e.canvas)}return te}function Ze(e,t,i,n){const s=Fe(i,t,e);let r=we(t,n,i);const o=t.getMetersPerUnit();o!==void 0&&(r*=o);const l=e.getMetersPerUnit();l!==void 0&&(r/=l);const a=e.getExtent();if(!a||re(a,s)){const h=we(e,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}function fn(e,t,i,n){const s=le(i);let r=Ze(e,t,s,n);return(!isFinite(r)||r<=0)&&Ve(i,function(o){return r=Ze(e,t,o,n),isFinite(r)&&r>0}),r}function _n(e,t,i,n,s,r,o,l,a,h,c,_,$,T){const u=Mt(Math.round(i*e),Math.round(i*t),et);if(_||(u.imageSmoothingEnabled=!1),a.length===0)return u.canvas;u.scale(i,i);function d(g){return Math.round(g*i)/i}u.globalCompositeOperation="lighter";const f=lt();a.forEach(function(g,S,L){He(f,g.extent)});let x;const m=i/n,E=(_?1:1+Math.pow(2,-24))/m;x=Mt(Math.round(M(f)*m),Math.round(K(f)*m),et),_||(x.imageSmoothingEnabled=!1),a.forEach(function(g,S,L){if(g.image.width>0&&g.image.height>0){if(g.clipExtent){x.save();const F=(g.clipExtent[0]-f[0])*m,b=-(g.clipExtent[3]-f[3])*m,A=M(g.clipExtent)*m,U=K(g.clipExtent)*m;x.rect(_?F:Math.round(F),_?b:Math.round(b),_?A:Math.round(F+A)-Math.round(F),_?U:Math.round(b+U)-Math.round(b)),x.clip()}const P=(g.extent[0]-f[0])*m,R=-(g.extent[3]-f[3])*m,C=M(g.extent)*m,G=K(g.extent)*m;x.drawImage(g.image,h,h,g.image.width-2*h,g.image.height-2*h,_?P:Math.round(P),_?R:Math.round(R),_?C:Math.round(P+C)-Math.round(P),_?G:Math.round(R+G)-Math.round(R)),g.clipExtent&&x.restore()}});const p=at(o);return l.getTriangles().forEach(function(g,S,L){const P=g.source,R=g.target;let C=P[0][0],G=P[0][1],F=P[1][0],b=P[1][1],A=P[2][0],U=P[2][1];const it=d((R[0][0]-p[0])/r),nt=d(-(R[0][1]-p[1])/r),k=d((R[1][0]-p[0])/r),N=d(-(R[1][1]-p[1])/r),Ft=d((R[2][0]-p[0])/r),bt=d(-(R[2][1]-p[1])/r),yt=C,Ct=G;C=0,G=0,F-=yt,b-=Ct,A-=yt,U-=Ct;const ke=[[F,b,0,0,k-it],[A,U,0,0,Ft-it],[0,0,F,b,N-nt],[0,0,A,U,bt-nt]],st=ni(ke);if(!st)return;if(u.save(),u.beginPath(),dn()||!_){u.moveTo(k,N);const O=4,ot=it-k,ne=nt-N;for(let j=0;j<O;j++)u.lineTo(k+d((j+1)*ot/O),N+d(j*ne/(O-1))),j!=O-1&&u.lineTo(k+d((j+1)*ot/O),N+d((j+1)*ne/(O-1)));u.lineTo(Ft,bt)}else u.moveTo(k,N),u.lineTo(it,nt),u.lineTo(Ft,bt);u.clip(),u.transform(st[0],st[2],st[1],st[3],it,nt),u.translate(f[0]-yt,f[3]-Ct);let rt;if(x)rt=x.canvas,u.scale(E,-E);else{const O=a[0],ot=O.extent;rt=O.image,u.scale(M(ot)/rt.width,-K(ot)/rt.height)}u.drawImage(rt,0,0),u.restore()}),x&&(Jt(x),et.push(x.canvas)),c&&(u.save(),u.globalCompositeOperation="source-over",u.strokeStyle="black",u.lineWidth=1,l.getTriangles().forEach(function(g,S,L){const P=g.target,R=(P[0][0]-p[0])/r,C=-(P[0][1]-p[1])/r,G=(P[1][0]-p[0])/r,F=-(P[1][1]-p[1])/r,b=(P[2][0]-p[0])/r,A=-(P[2][1]-p[1])/r;u.beginPath(),u.moveTo(G,F),u.lineTo(R,C),u.lineTo(b,A),u.closePath(),u.stroke()}),u.restore()),u.canvas}new Array(6);function mn(e,t){const i=t[0],n=t[1];return t[0]=e[0]*i+e[2]*n+e[4],t[1]=e[1]*i+e[3]*n+e[5],t}const pn=10,Ye=.25;class xn{constructor(t,i,n,s,r,o,l){this.sourceProj_=t,this.targetProj_=i;let a={};const h=l?Ii(E=>mn(l,Fe(E,this.targetProj_,this.sourceProj_))):Se(this.targetProj_,this.sourceProj_);this.transformInv_=function(E){const p=E[0]+"/"+E[1];return a[p]||(a[p]=h(E)),a[p]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&M(s)>=M(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?M(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?M(this.targetProj_.getExtent()):null;const c=at(n),_=Xt(n),$=Ot(n),T=Lt(n),u=this.transformInv_(c),d=this.transformInv_(_),f=this.transformInv_($),x=this.transformInv_(T),m=pn+(o?Math.max(0,Math.ceil(Math.log2(It(n)/(o*o*256*256)))):0);if(this.addQuad_(c,_,$,T,u,d,f,x,m),this.wrapsXInSource_){let E=1/0;this.triangles_.forEach(function(p,g,S){E=Math.min(E,p.source[0][0],p.source[1][0],p.source[2][0])}),this.triangles_.forEach(p=>{if(Math.max(p.source[0][0],p.source[1][0],p.source[2][0])-E>this.sourceWorldWidth_/2){const g=[[p.source[0][0],p.source[0][1]],[p.source[1][0],p.source[1][1]],[p.source[2][0],p.source[2][1]]];g[0][0]-E>this.sourceWorldWidth_/2&&(g[0][0]-=this.sourceWorldWidth_),g[1][0]-E>this.sourceWorldWidth_/2&&(g[1][0]-=this.sourceWorldWidth_),g[2][0]-E>this.sourceWorldWidth_/2&&(g[2][0]-=this.sourceWorldWidth_);const S=Math.min(g[0][0],g[1][0],g[2][0]);Math.max(g[0][0],g[1][0],g[2][0])-S<this.sourceWorldWidth_/2&&(p.source=g)}})}a={}}addTriangle_(t,i,n,s,r,o){this.triangles_.push({source:[s,r,o],target:[t,i,n]})}addQuad_(t,i,n,s,r,o,l,a,h){const c=se([r,o,l,a]),_=this.sourceWorldWidth_?M(c)/this.sourceWorldWidth_:null,$=this.sourceWorldWidth_,T=this.sourceProj_.canWrapX()&&_>.5&&_<1;let u=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const f=se([t,i,n,s]);u=M(f)/this.targetWorldWidth_>Ye||u}!T&&this.sourceProj_.isGlobal()&&_&&(u=_>Ye||u)}if(!u&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!jt(c,this.maxSourceExtent_))return;let d=0;if(!u&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(a[0])||!isFinite(a[1]))){if(h>0)u=!0;else if(d=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(l[0])||!isFinite(l[1])?2:0)+(!isFinite(a[0])||!isFinite(a[1])?1:0),d!=1&&d!=2&&d!=4&&d!=8)return}if(h>0){if(!u){const f=[(t[0]+n[0])/2,(t[1]+n[1])/2],x=this.transformInv_(f);let m;T?m=(_t(r[0],$)+_t(l[0],$))/2-_t(x[0],$):m=(r[0]+l[0])/2-x[0];const E=(r[1]+l[1])/2-x[1];u=m*m+E*E>this.errorThresholdSquared_}if(u){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const f=[(i[0]+n[0])/2,(i[1]+n[1])/2],x=this.transformInv_(f),m=[(s[0]+t[0])/2,(s[1]+t[1])/2],E=this.transformInv_(m);this.addQuad_(t,i,f,m,r,o,x,E,h-1),this.addQuad_(m,f,n,s,E,x,l,a,h-1)}else{const f=[(t[0]+i[0])/2,(t[1]+i[1])/2],x=this.transformInv_(f),m=[(n[0]+s[0])/2,(n[1]+s[1])/2],E=this.transformInv_(m);this.addQuad_(t,f,m,s,r,x,E,a,h-1),this.addQuad_(f,i,n,m,x,o,l,E,h-1)}return}}if(T){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}d&11||this.addTriangle_(t,n,s,r,l,a),d&14||this.addTriangle_(t,n,i,r,l,o),d&&(d&13||this.addTriangle_(i,s,t,o,a,r),d&7||this.addTriangle_(i,s,n,o,a,l))}calculateSourceExtent(){const t=lt();return this.triangles_.forEach(function(i,n,s){const r=i.source;ft(t,r[0]),ft(t,r[1]),ft(t,r[2])}),t}getTriangles(){return this.triangles_}}var En=xn;const vn=.5;let Tn=class extends je{constructor(t,i,n,s,r,o,l,a,h,c,_,$){super(r,v.IDLE,$),this.renderEdges_=_!==void 0?_:!1,this.pixelRatio_=l,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=i,this.targetTileGrid_=s,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const T=s.getTileCoordExtent(this.wrappedTileCoord_),u=this.targetTileGrid_.getExtent();let d=this.sourceTileGrid_.getExtent();const f=u?At(T,u):T;if(It(f)===0){this.state=v.EMPTY;return}const x=t.getExtent();x&&(d?d=At(d,x):d=x);const m=s.getResolution(this.wrappedTileCoord_[0]),E=fn(t,n,f,m);if(!isFinite(E)||E<=0){this.state=v.EMPTY;return}const p=c!==void 0?c:vn;if(this.triangulation_=new En(t,n,f,d,E*p,m),this.triangulation_.getTriangles().length===0){this.state=v.EMPTY;return}this.sourceZ_=i.getZForResolution(E);let g=this.triangulation_.calculateSourceExtent();if(d&&(t.canWrapX()?(g[1]=zt(g[1],d[1],d[3]),g[3]=zt(g[3],d[1],d[3])):g=At(g,d)),!It(g))this.state=v.EMPTY;else{let S=0,L=0;t.canWrapX()&&(S=M(x),L=Math.floor((g[0]-x[0])/S)),ii(g.slice(),t).forEach(P=>{const R=i.getTileRangeForExtentAndZ(P,this.sourceZ_);for(let C=R.minX;C<=R.maxX;C++)for(let G=R.minY;G<=R.maxY;G++){const F=h(this.sourceZ_,C,G,l);if(F){const b=L*S;this.sourceTiles_.push({tile:F,offset:b})}}++L}),this.sourceTiles_.length===0&&(this.state=v.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(i=>{const n=i.tile;if(n&&n.getState()==v.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);s[0]+=i.offset,s[2]+=i.offset;const r=this.clipExtent_?.slice();r&&(r[0]+=i.offset,r[2]+=i.offset),t.push({extent:s,clipExtent:r,image:n.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=v.ERROR;else{const i=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(i),s=typeof n=="number"?n:n[0],r=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(i),l=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=_n(s,r,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),o,a,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=v.LOADED}this.changed()}load(){if(this.state==v.IDLE){this.state=v.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:i})=>{const n=i.getState();if(n==v.IDLE||n==v.LOADING){t++;const s=Rt(i,tt.CHANGE,r=>{const o=i.getState();(o==v.LOADED||o==v.ERROR||o==v.EMPTY)&&(gt(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:i},n,s){i.getState()==v.IDLE&&i.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(gt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Jt(this.canvas_.getContext("2d")),et.push(this.canvas_),this.canvas_=null),super.release()}};var $n=Tn;const Pn=/\{z\}/g,Rn=/\{x\}/g,wn=/\{y\}/g,Mn=/\{-y\}/g;function Sn(e,t,i,n,s){return e.replace(Pn,t.toString()).replace(Rn,i.toString()).replace(wn,n.toString()).replace(Mn,function(){if(s===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(s-n).toString()})}function Fn(e){const t=[];let i=/\{([a-z])-([a-z])\}/.exec(e);if(i){const n=i[1].charCodeAt(0),s=i[2].charCodeAt(0);let r;for(r=n;r<=s;++r)t.push(e.replace(i[0],String.fromCharCode(r)));return t}if(i=/\{(\d+)-(\d+)\}/.exec(e),i){const n=parseInt(i[2],10);for(let s=parseInt(i[1],10);s<=n;s++)t.push(e.replace(i[0],s.toString()));return t}return t.push(e),t}function bn(e,t){return function(i,n,s){if(!i)return;let r;const o=i[0];if(t){const l=t.getFullTileRange(o);l&&(r=l.getHeight()-1)}return Sn(e,o,i[1],i[2],r)}}function yn(e,t){const i=e.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=bn(e[s],t);return Cn(n)}function Cn(e){return e.length===1?e[0]:function(t,i,n){if(!t)return;const s=Di(t),r=_t(s,e.length);return e[r](t,i,n)}}var Gn={PROPERTYCHANGE:"propertychange"};let St=class extends Ae{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(tt.CHANGE)}getRevision(){return this.revision_}onInternal(t,i){if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=Rt(this,t[r],i);return s}return Rt(this,t,i)}onceInternal(t,i){let n;if(Array.isArray(t)){const s=t.length;n=new Array(s);for(let r=0;r<s;++r)n[r]=wt(this,t[r],i)}else n=wt(this,t,i);return i.ol_key=n,n}unInternal(t,i){const n=i.ol_key;if(n)In(n);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],i);else this.removeEventListener(t,i)}};St.prototype.on,St.prototype.once,St.prototype.un;function In(e){if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)gt(e[t]);else gt(e)}var Ln=St;let We=class extends Qt{constructor(t,i,n){super(t),this.key=i,this.oldValue=n}},On=class extends Ln{constructor(t){super(),this.on,this.once,this.un,dt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let i;return this.values_&&this.values_.hasOwnProperty(t)&&(i=this.values_[t]),i}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,i){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new We(n,t,i)),n=Gn.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new We(n,t,i))}addChangeListener(t,i){this.addEventListener(`change:${t}`,i)}removeChangeListener(t,i){this.removeEventListener(`change:${t}`,i)}set(t,i,n){const s=this.values_||(this.values_={});if(n)s[t]=i;else{const r=s[t];s[t]=i,r!==i&&this.notify(t,r)}}setProperties(t,i){for(const n in t)this.set(n,t[n],i)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,i){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],di(this.values_)&&(this.values_=null),i||this.notify(t,n)}}};var An=On;class Xn extends An{constructor(t){super(),this.projection=I(t.projection),this.attributions_=De(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const i=this;this.viewPromise_=new Promise(function(n,s){i.viewResolver=n,i.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=De(t),this.changed()}setState(t){this.state_=t,this.changed()}}function De(e){return e?typeof e=="function"?e:(Array.isArray(e)||(e=[e]),t=>e):null}var jn=Xn;class zn extends jn{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const i=[256,256];this.tileGrid&&W(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),i),this.tmpSize=[0,0],this.key_=t.key||dt(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const i=t?this.getTileGridForProjection(t):this.tileGrid;return i?i.getResolutions():null}getTile(t,i,n,s,r){return Xe()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Ie(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,i,n){const s=this.getTileGridForProjection(n),r=this.getTilePixelRatio(i),o=W(s.getTileSize(t),this.tmpSize);return r==1?o:Oi(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,i){const n=i!==void 0?i:this.getProjection(),s=i!==void 0?this.getTileGridForProjection(n):this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=Hi(s,t,n)),ki(t,s)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class Zn extends Qt{constructor(t,i){super(t),this.tile=i}}var Yn=zn,ie={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};let Wn=class Ue extends Yn{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Ue.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const i=t.target,n=dt(i),s=i.getState();let r;s==v.LOADING?(this.tileLoadingKeys_[n]=!0,r=ie.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],r=s==v.ERROR?ie.TILELOADERROR:s==v.LOADED?ie.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new Zn(r,i))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,i){this.tileUrlFunction=t,typeof i<"u"?this.setKey(i):this.changed()}setUrl(t){const i=Fn(t);this.urls=i,this.setUrls(i)}setUrls(t){this.urls=t;const i=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(yn(t,this.tileGrid),i):this.setKey(i)}tileUrlFunction(t,i,n){}};var Dn=Wn;class Un extends Dn{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:kn,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:gn,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!Ht(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){const i=this.getProjection();if(this.tileGrid&&(!i||Ht(i,t)))return this.tileGrid;const n=dt(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Ie(t)),this.tileGridForProjection[n]}createTile_(t,i,n,s,r,o){const l=[t,i,n],a=this.getTileCoordForTileUrlFunction(l,r),h=a?this.tileUrlFunction(a,s,r):void 0,c=new this.tileClass(l,h!==void 0?v.IDLE:v.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(tt.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,i,n,s,r){const o=this.getProjection();if(!o||!r||Ht(o,r))return this.getTileInternal(t,i,n,s,o||r);const l=[t,i,n],a=this.getKey(),h=this.getTileGridForProjection(o),c=this.getTileGridForProjection(r),_=this.getTileCoordForTileUrlFunction(l,r),$=new $n(o,h,r,c,l,_,this.getTilePixelRatio(s),this.getGutter(),(T,u,d,f)=>this.getTileInternal(T,u,d,f,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return $.key=a,$}getTileInternal(t,i,n,s,r){const o=this.getKey();return this.createTile_(t,i,n,s,r,o)}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,i){const n=I(t);if(n){const s=dt(n);s in this.tileGridForProjection||(this.tileGridForProjection[s]=i)}}}function kn(e,t){e.getImage().src=t}var Nn=Un;class Kn extends Nn{constructor(t){t=t||{};const i=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:Bi({extent:Vt(i),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:i,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}var Hn=Kn;const qn='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.',Bn='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',Vn='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',Qn='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',Jn={stamen_terrain:{extension:"png"},stamen_terrain_background:{extension:"png"},stamen_terrain_labels:{extension:"png"},stamen_terrain_lines:{extension:"png"},stamen_toner_background:{extension:"png"},stamen_toner:{extension:"png"},stamen_toner_labels:{extension:"png"},stamen_toner_lines:{extension:"png"},stamen_toner_lite:{extension:"png"},stamen_watercolor:{extension:"jpg"},alidade_smooth:{extension:"png"},alidade_smooth_dark:{extension:"png"},alidade_satellite:{extension:"png"},outdoors:{extension:"png"},osm_bright:{extension:"png"}},ts={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class es extends Hn{constructor(t){const i=t.layer.indexOf("-"),n=i==-1?t.layer:t.layer.slice(0,i),s=ts[n]||{minZoom:0,maxZoom:20,retina:!0},r=Jn[t.layer],o=t.apiKey?"?api_key="+t.apiKey:"",l=s.retina&&t.retina?"@2x":"",a=t.url!==void 0?t.url:"https://tiles.stadiamaps.com/tiles/"+t.layer+"/{z}/{x}/{y}"+l+"."+r.extension+o,h=[Bn,Vn,qn];t.layer.startsWith("stamen_")&&h.splice(1,0,Qn),super({attributions:h,cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:s.maxZoom,minZoom:t.minZoom!==void 0?t.minZoom:s.minZoom,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:a,tilePixelRatio:l?2:1,wrapX:t.wrapX,zDirection:t.zDirection})}}var is=es;export{is as default};
