var R={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},st={CHANGE:"change"};let Ce=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};var Fe=Ce;function We(e,t,i){if(e[0]<=t)return 0;const n=e.length;if(t<=e[n-1])return n-1;for(let s=1;s<n;++s){if(e[s]==t)return s;if(e[s]<t)return e[s-1]-t<t-e[s]?s-1:s}return n-1}function Nt(){}function De(e){function t(){let i;try{i=e()}catch(n){return Promise.reject(n)}return i instanceof Promise?i:Promise.resolve(i)}return t()}function Ut(e){for(const t in e)delete e[t]}function Ne(e){let t;for(t in e)return!1;return!t}let Ue=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var Et=Ue;let Xe=class extends Fe{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,i){if(!t||!i)return;const n=this.listeners_||(this.listeners_={}),s=n[t]||(n[t]=[]);s.includes(i)||s.push(i)}dispatchEvent(t){const i=typeof t=="string",n=i?t:t.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const r=i?new Et(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let u;for(let c=0,l=s.length;c<l;++c)if("handleEvent"in s[c]?u=s[c].handleEvent(r):u=s[c].call(this,r),u===!1||r.propagationStopped){u=!1;break}if(--o[n]===0){let c=a[n];for(delete a[n];c--;)this.removeEventListener(n,Nt);delete o[n]}return u}disposeInternal(){this.listeners_&&Ut(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,i){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const s=n.indexOf(i);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[s]=Nt,++this.pendingRemovals_[t]):(n.splice(s,1),n.length===0&&delete this.listeners_[t]))}};var Xt=Xe;function rt(e,t,i,n,s){if(s){const o=i;i=function(a){return e.removeEventListener(t,i),o.call(this,a)}}const r={target:e,type:t,listener:i};return e.addEventListener(t,i),r}function kt(e,t,i,n){return rt(e,t,i,n,!0)}function It(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),Ut(e))}const G=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",ke=G.includes("safari")&&!G.includes("chrom");ke&&(G.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(G)),G.includes("webkit")&&G.includes("edge"),G.includes("macintosh");const He=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Ht=typeof Image<"u"&&Image.prototype.decode,Yt=typeof createImageBitmap=="function";(function(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e})();let Ye=class extends Xt{constructor(t,i,n,s){super(),this.extent=t,this.pixelRatio_=n,this.resolution=i,this.state=typeof s=="function"?R.IDLE:s,this.image_=null,this.loader=typeof s=="function"?s:null}changed(){this.dispatchEvent(st.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==R.IDLE&&this.loader){this.state=R.LOADING,this.changed();const t=this.getResolution(),i=Array.isArray(t)?t[0]:t;De(()=>this.loader(this.getExtent(),i,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||Yt&&n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=R.LOADED}).catch(n=>{this.state=R.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}};function qe(e,t){return new Promise((i,n)=>{function s(){o(),i(e)}function r(){o(),n(new Error("Image load error"))}function o(){e.removeEventListener("load",s),e.removeEventListener("error",r)}e.addEventListener("load",s),e.addEventListener("error",r)})}function Qe(e,t){return e.src&&Ht?new Promise((i,n)=>e.decode().then(()=>i(e)).catch(s=>e.complete&&e.width?i(e):n(s))):qe(e)}function qt(e,t){return t&&(e.src=t),e.src&&Ht&&Yt?e.decode().then(()=>createImageBitmap(e)).catch(i=>{if(e.complete&&e.width)return e;throw i}):Qe(e)}var Qt=Ye;function Vt(e){const t=ot();for(let i=0,n=e.length;i<n;++i)at(t,e[i]);return t}function Ve(e,t){return Be(e,t[0],t[1])}function Bt(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function Be(e,t,i){return e[0]<=t&&t<=e[2]&&e[1]<=i&&i<=e[3]}function ot(){return[1/0,1/0,-1/0,-1/0]}function Kt(e,t,i,n,s){return s?(s[0]=e,s[1]=t,s[2]=i,s[3]=n,s):[e,t,i,n]}function Ke(e){return Kt(1/0,1/0,-1/0,-1/0,e)}function ze(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function Je(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function at(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function Ze(e){let t=0;return ee(e)||(t=w(e)*y(e)),t}function tn(e){return[e[0],e[1]]}function en(e){return[e[2],e[1]]}function zt(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function Jt(e,t,i,n,s){const[r,o,a,u,c,l,d,I]=nn(e,t,i,n);return Kt(Math.min(r,a,c,d),Math.min(o,u,l,I),Math.max(r,a,c,d),Math.max(o,u,l,I),s)}function nn(e,t,i,n){const s=t*n[0]/2,r=t*n[1]/2,o=Math.cos(i),a=Math.sin(i),u=s*o,c=s*a,l=r*o,d=r*a,I=e[0],P=e[1];return[I-u+d,P-c-l,I-u-d,P-c+l,I+u-d,P+c+l,I+u+d,P+c-l,I-u+d,P-c-l]}function y(e){return e[3]-e[1]}function sn(e,t,i){const n=ot();return te(e,t)?(e[0]>t[0]?n[0]=e[0]:n[0]=t[0],e[1]>t[1]?n[1]=e[1]:n[1]=t[1],e[2]<t[2]?n[2]=e[2]:n[2]=t[2],e[3]<t[3]?n[3]=e[3]:n[3]=t[3]):Ke(n),n}function Zt(e){return[e[0],e[3]]}function rn(e){return[e[2],e[3]]}function w(e){return e[2]-e[0]}function te(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function ee(e){return e[2]<e[0]||e[3]<e[1]}function on(e){const t=e.length;for(let n=0;n<t;n++){let s=n,r=Math.abs(e[n][n]);for(let a=n+1;a<t;a++){const u=Math.abs(e[a][n]);u>r&&(r=u,s=a)}if(r===0)return null;const o=e[s];e[s]=e[n],e[n]=o;for(let a=n+1;a<t;a++){const u=-e[a][n]/e[n][n];for(let c=n;c<t+1;c++)n==c?e[a][c]=0:e[a][c]+=u*e[n][c]}}const i=new Array(t);for(let n=t-1;n>=0;n--){i[n]=e[n][t]/e[n][n];for(let s=n-1;s>=0;s--)e[s][t]-=e[s][n]*i[n]}return i}function ne(e){return e*180/Math.PI}function C(e){return e*Math.PI/180}function Pt(e,t){const i=e%t;return i*t<0?i+t:i}function Rt(e,t){const i=Math.pow(10,t);return Math.round(e*i)/i}function ie(e,t){return Math.round(Rt(e,t))}function se(e,t){return Math.floor(Rt(e,t))}function ut(e,t){return Math.ceil(Rt(e,t))}function Mt(e,t,i){if(e>=t&&e<i)return e;const n=i-t;return((e-t)%n+n)%n+t}function re(e,t){const i=(""+e).split("."),n=(""+t).split(".");for(let s=0;s<Math.max(i.length,n.length);s++){const r=parseInt(i[s]||"0",10),o=parseInt(n[s]||"0",10);if(r>o)return 1;if(o>r)return-1}return 0}const an={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let un=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||an[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};var wt=un;const tt=6378137,k=Math.PI*tt,cn=[-k,-k,k,k],hn=[-180,-85,180,85],ct=tt*Math.log(Math.tan(Math.PI/2));let H=class extends wt{constructor(t){super({code:t,units:"m",extent:cn,global:!0,worldExtent:hn,getPointResolution:function(i,n){return i/Math.cosh(n[1]/tt)}})}};const oe=[new H("EPSG:3857"),new H("EPSG:102100"),new H("EPSG:102113"),new H("EPSG:900913"),new H("http://www.opengis.net/def/crs/EPSG/0/3857"),new H("http://www.opengis.net/gml/srs/epsg.xml#3857")];function ln(e,t,i,n){const s=e.length;i=i>1?i:2,n=n??i,t===void 0&&(i>2?t=e.slice():t=new Array(s));for(let r=0;r<s;r+=n){t[r]=k*e[r]/180;let o=tt*Math.log(Math.tan(Math.PI*(+e[r+1]+90)/360));o>ct?o=ct:o<-ct&&(o=-ct),t[r+1]=o}return t}function dn(e,t,i,n){const s=e.length;i=i>1?i:2,n=n??i,t===void 0&&(i>2?t=e.slice():t=new Array(s));for(let r=0;r<s;r+=n)t[r]=180*e[r]/k,t[r+1]=360*Math.atan(Math.exp(e[r+1]/tt))/Math.PI-90;return t}const gn=6378137,ae=[-180,-90,180,90],fn=Math.PI*gn/180;let F=class extends wt{constructor(t,i){super({code:t,units:"degrees",extent:ae,axisOrientation:i,global:!0,metersPerUnit:fn,worldExtent:ae})}};const ue=[new F("CRS:84"),new F("EPSG:4326","neu"),new F("urn:ogc:def:crs:OGC:1.3:CRS84"),new F("urn:ogc:def:crs:OGC:2:84"),new F("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new F("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new F("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let $t={};function _n(e){return $t[e]||$t[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function pn(e,t){$t[e]=t}let Y={};function et(e,t,i){const n=e.getCode(),s=t.getCode();n in Y||(Y[n]={}),Y[n][s]=i}function xt(e,t){return e in Y&&t in Y[e]?Y[e][t]:null}const ht=.9996,x=.00669438,lt=x*x,dt=lt*x,W=x/(1-x),ce=Math.sqrt(1-x),q=(1-ce)/(1+ce),he=q*q,Ot=he*q,St=Ot*q,le=St*q,de=1-x/4-3*lt/64-5*dt/256,mn=3*x/8+3*lt/32+45*dt/1024,vn=15*lt/256+45*dt/1024,En=35*dt/3072,In=3/2*q-27/32*Ot+269/512*le,Pn=21/16*he-55/32*St,Rn=151/96*Ot-417/128*le,Mn=1097/512*St,gt=6378137;function wn(e,t,i){const n=e-5e5,s=(i.north?t:t-1e7)/ht/(gt*de),r=s+In*Math.sin(2*s)+Pn*Math.sin(4*s)+Rn*Math.sin(6*s)+Mn*Math.sin(8*s),o=Math.sin(r),a=o*o,u=Math.cos(r),c=o/u,l=c*c,d=l*l,I=1-x*a,P=Math.sqrt(1-x*a),h=gt/P,m=(1-x)/I,_=W*u**2,p=_*_,f=n/(h*ht),E=f*f,v=E*f,g=v*f,O=g*f,it=O*f,$=r-c/m*(E/2-g/24*(5+3*l+10*_-4*p-9*W))+it/720*(61+90*l+298*_+45*d-252*W-3*p);let M=(f-v/6*(1+2*l+_)+O/120*(5-2*_+28*l-3*p+8*W+24*d))/u;return M=Mt(M+C(_e(i.number)),-Math.PI,Math.PI),[ne(M),ne($)]}const ge=-80,fe=84,$n=-180,xn=180;function On(e,t,i){e=Mt(e,$n,xn),t<ge?t=ge:t>fe&&(t=fe);const n=C(t),s=Math.sin(n),r=Math.cos(n),o=s/r,a=o*o,u=a*a,c=C(e),l=_e(i.number),d=C(l),I=gt/Math.sqrt(1-x*s**2),P=W*r**2,h=r*Mt(c-d,-Math.PI,Math.PI),m=h*h,_=m*h,p=_*h,f=p*h,E=f*h,v=gt*(de*n-mn*Math.sin(2*n)+vn*Math.sin(4*n)-En*Math.sin(6*n)),g=ht*I*(h+_/6*(1-a+P)+f/120*(5-18*a+u+72*P-58*W))+5e5;let O=ht*(v+I*o*(m/2+p/24*(5-a+9*P+4*P**2)+E/720*(61-58*a+u+600*P-330*W)));return i.north||(O+=1e7),[g,O]}function _e(e){return(e-1)*6-180+3}const Sn=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function pe(e){let t=0;for(const s of Sn){const r=e.match(s);if(r){t=parseInt(r[1]);break}}if(!t)return null;let i=0,n=!1;return t>32700&&t<32761?i=t-32700:t>32600&&t<32661&&(n=!0,i=t-32600),i?{number:i,north:n}:null}function me(e,t){return function(i,n,s,r){const o=i.length;s=s>1?s:2,r=r??s,n||(s>2?n=i.slice():n=new Array(o));for(let a=0;a<o;a+=r){const u=i[a],c=i[a+1],l=e(u,c,t);n[a]=l[0],n[a+1]=l[1]}return n}}function An(e){return pe(e)?new wt({code:e,units:"m"}):null}function jn(e){const t=pe(e.getCode());return t?{forward:me(On,t),inverse:me(wn,t)}:null}const bn=63710088e-1;function ve(e,t,i){i=i||bn;const n=C(e[1]),s=C(t[1]),r=(s-n)/2,o=C(t[0]-e[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(s);return 2*i*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}const yn=[jn],Ln=[An];function At(e,t){if(t!==void 0){for(let i=0,n=e.length;i<n;++i)t[i]=e[i];t=t}else t=e.slice();return t}function jt(e){pn(e.getCode(),e),et(e,e,At)}function Tn(e){e.forEach(jt)}function S(e){if(typeof e!="string")return e;const t=_n(e);if(t)return t;for(const i of Ln){const n=i(e);if(n)return n}return null}function Ee(e,t,i,n){e=S(e);let s;const r=e.getPointResolutionFunc();if(r)s=r(t,i);else{const o=e.getUnits();if(o=="degrees"||n=="degrees")s=t;else{const a=bt(e,S("EPSG:4326"));if(!a&&o!=="degrees")s=t*e.getMetersPerUnit();else{let c=[i[0]-t/2,i[1],i[0]+t/2,i[1],i[0],i[1]-t/2,i[0],i[1]+t/2];c=a(c,c,2);const l=ve(c.slice(0,2),c.slice(2,4)),d=ve(c.slice(4,6),c.slice(6,8));s=(l+d)/2}const u=e.getMetersPerUnit();u!==void 0&&(s/=u)}}return s}function Ie(e){Tn(e),e.forEach(function(t){e.forEach(function(i){t!==i&&et(t,i,At)})})}function Gn(e,t,i,n){e.forEach(function(s){t.forEach(function(r){et(s,r,i),et(r,s,n)})})}function Cn(e){return function(t,i,n,s){const r=t.length;n=n!==void 0?n:2,s=s??n,i=i!==void 0?i:new Array(r);for(let o=0;o<r;o+=s){const a=e(t.slice(o,o+n)),u=a.length;for(let c=0,l=s;c<l;++c)i[o+c]=c>=u?t[o+c]:a[c]}return i}}function Pe(e,t){if(e===t)return!0;const i=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||bt(e,t)===At)&&i}function bt(e,t){const i=e.getCode(),n=t.getCode();let s=xt(i,n);if(s)return s;let r=null,o=null;for(const u of yn)r||(r=u(e)),o||(o=u(t));if(!r&&!o)return null;const a="EPSG:4326";if(o)if(r)s=yt(r.inverse,o.forward);else{const u=xt(i,a);u&&(s=yt(u,o.forward))}else{const u=xt(a,n);u&&(s=yt(r.inverse,u))}return s&&(jt(e),jt(t),et(e,t,s)),s}function yt(e,t){return function(i,n,s,r){return n=e(i,n,s,r),t(n,n,s,r)}}function Re(e,t){const i=S(e),n=S(t);return bt(i,n)}function Lt(e,t,i){const n=Re(t,i);if(!n){const s=S(t).getCode(),r=S(i).getCode();throw new Error(`No transform available between ${s} and ${r}`)}return n(e,void 0,e.length)}function Fn(){Ie(oe),Ie(ue),Gn(ue,oe,ln,dn)}Fn();function Tt(e,t,i,n){let s;return i&&i.length?s=i.shift():He?s=new OffscreenCanvas(e||300,t||300):s=document.createElement("canvas"),e&&(s.width=e),t&&(s.height=t),s.getContext("2d",n)}function Me(e){const t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}let Gt;const nt=[];function we(e,t,i,n,s){e.beginPath(),e.moveTo(0,0),e.lineTo(t,i),e.lineTo(n,s),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,n)+1,Math.max(i,s)),e.restore()}function Ct(e,t){return Math.abs(e[t*4]-210)>2||Math.abs(e[t*4+3]-.75*255)>2}function Wn(){if(Gt===void 0){const e=Tt(6,6,nt);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",we(e,4,5,4,0),we(e,4,5,0,5);const t=e.getImageData(0,0,3,3).data;Gt=Ct(t,0)||Ct(t,4)||Ct(t,8),Me(e),nt.push(e.canvas)}return Gt}function $e(e,t,i,n){const s=Lt(i,t,e);let r=Ee(t,n,i);const o=t.getMetersPerUnit();o!==void 0&&(r*=o);const a=e.getMetersPerUnit();a!==void 0&&(r/=a);const u=e.getExtent();if(!u||Ve(u,s)){const c=Ee(e,r,s)/r;isFinite(c)&&c>0&&(r/=c)}return r}function Dn(e,t,i,n,s,r,o,a,u,c,l,d,I,P){const h=Tt(Math.round(i*e),Math.round(i*t),nt);if(d||(h.imageSmoothingEnabled=!1),u.length===0)return h.canvas;h.scale(i,i);function m(g){return Math.round(g*i)/i}h.globalCompositeOperation="lighter";const _=ot();u.forEach(function(g,O,it){Je(_,g.extent)});let p;const f=i/n,E=(d?1:1+Math.pow(2,-24))/f;(u.length!==1||c!==0)&&(p=Tt(Math.round(w(_)*f),Math.round(y(_)*f),nt),d||(p.imageSmoothingEnabled=!1),u.forEach(function(g,O,it){if(g.image.width>0&&g.image.height>0){if(g.clipExtent){p.save();const j=(g.clipExtent[0]-_[0])*f,b=-(g.clipExtent[3]-_[3])*f,D=w(g.clipExtent)*f,N=y(g.clipExtent)*f;p.rect(d?j:Math.round(j),d?b:Math.round(b),d?D:Math.round(j+D)-Math.round(j),d?N:Math.round(b+N)-Math.round(b)),p.clip()}const $=(g.extent[0]-_[0])*f,M=-(g.extent[3]-_[3])*f,Q=w(g.extent)*f,V=y(g.extent)*f;p.drawImage(g.image,c,c,g.image.width-2*c,g.image.height-2*c,d?$:Math.round($),d?M:Math.round(M),d?Q:Math.round($+Q)-Math.round($),d?V:Math.round(M+V)-Math.round(M)),g.clipExtent&&p.restore()}}));const v=Zt(o);return a.getTriangles().forEach(function(g,O,it){const $=g.source,M=g.target;let Q=$[0][0],V=$[0][1],j=$[1][0],b=$[1][1],D=$[2][0],N=$[2][1];const B=m((M[0][0]-v[0])/r),K=m(-(M[0][1]-v[1])/r),U=m((M[1][0]-v[0])/r),X=m(-(M[1][1]-v[1])/r),_t=m((M[2][0]-v[0])/r),pt=m(-(M[2][1]-v[1])/r),mt=Q,vt=V;Q=0,V=0,j-=mt,b-=vt,D-=mt,N-=vt;const Ge=[[j,b,0,0,U-B],[D,N,0,0,_t-B],[0,0,j,b,X-K],[0,0,D,N,pt-K]],z=on(Ge);if(!z)return;if(h.save(),h.beginPath(),Wn()||!d){h.moveTo(U,X);const A=4,Z=B-U,Dt=K-X;for(let T=0;T<A;T++)h.lineTo(U+m((T+1)*Z/A),X+m(T*Dt/(A-1))),T!=A-1&&h.lineTo(U+m((T+1)*Z/A),X+m((T+1)*Dt/(A-1)));h.lineTo(_t,pt)}else h.moveTo(U,X),h.lineTo(B,K),h.lineTo(_t,pt);h.clip(),h.transform(z[0],z[2],z[1],z[3],B,K),h.translate(_[0]-mt,_[3]-vt);let J;if(p)J=p.canvas,h.scale(E,-E);else{const A=u[0],Z=A.extent;J=A.image,h.scale(w(Z)/J.width,-y(Z)/J.height)}h.drawImage(J,0,0),h.restore()}),p&&(Me(p),nt.push(p.canvas)),h.canvas}function Ft(e){return Array.isArray(e)?Math.min(...e):e}new Array(6);function Nn(e,t){const i=t[0],n=t[1];return t[0]=e[0]*i+e[2]*n+e[4],t[1]=e[1]*i+e[3]*n+e[5],t}const Un=10,xe=.25;class Xn{constructor(t,i,n,s,r,o,a){this.sourceProj_=t,this.targetProj_=i;let u={};const c=a?Cn(E=>Nn(a,Lt(E,this.targetProj_,this.sourceProj_))):Re(this.targetProj_,this.sourceProj_);this.transformInv_=function(E){const v=E[0]+"/"+E[1];return u[v]||(u[v]=c(E)),u[v]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&w(s)>=w(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?w(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?w(this.targetProj_.getExtent()):null;const l=Zt(n),d=rn(n),I=en(n),P=tn(n),h=this.transformInv_(l),m=this.transformInv_(d),_=this.transformInv_(I),p=this.transformInv_(P),f=Un+(o?Math.max(0,Math.ceil(Math.log2(Ze(n)/(o*o*256*256)))):0);if(this.addQuad_(l,d,I,P,h,m,_,p,f),this.wrapsXInSource_){let E=1/0;this.triangles_.forEach(function(v,g,O){E=Math.min(E,v.source[0][0],v.source[1][0],v.source[2][0])}),this.triangles_.forEach(v=>{if(Math.max(v.source[0][0],v.source[1][0],v.source[2][0])-E>this.sourceWorldWidth_/2){const g=[[v.source[0][0],v.source[0][1]],[v.source[1][0],v.source[1][1]],[v.source[2][0],v.source[2][1]]];g[0][0]-E>this.sourceWorldWidth_/2&&(g[0][0]-=this.sourceWorldWidth_),g[1][0]-E>this.sourceWorldWidth_/2&&(g[1][0]-=this.sourceWorldWidth_),g[2][0]-E>this.sourceWorldWidth_/2&&(g[2][0]-=this.sourceWorldWidth_);const O=Math.min(g[0][0],g[1][0],g[2][0]);Math.max(g[0][0],g[1][0],g[2][0])-O<this.sourceWorldWidth_/2&&(v.source=g)}})}u={}}addTriangle_(t,i,n,s,r,o){this.triangles_.push({source:[s,r,o],target:[t,i,n]})}addQuad_(t,i,n,s,r,o,a,u,c){const l=Vt([r,o,a,u]),d=this.sourceWorldWidth_?w(l)/this.sourceWorldWidth_:null,I=this.sourceWorldWidth_,P=this.sourceProj_.canWrapX()&&d>.5&&d<1;let h=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const _=Vt([t,i,n,s]);h=w(_)/this.targetWorldWidth_>xe||h}!P&&this.sourceProj_.isGlobal()&&d&&(h=d>xe||h)}if(!h&&this.maxSourceExtent_&&isFinite(l[0])&&isFinite(l[1])&&isFinite(l[2])&&isFinite(l[3])&&!te(l,this.maxSourceExtent_))return;let m=0;if(!h&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(u[0])||!isFinite(u[1]))){if(c>0)h=!0;else if(m=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(u[0])||!isFinite(u[1])?1:0),m!=1&&m!=2&&m!=4&&m!=8)return}if(c>0){if(!h){const _=[(t[0]+n[0])/2,(t[1]+n[1])/2],p=this.transformInv_(_);let f;P?f=(Pt(r[0],I)+Pt(a[0],I))/2-Pt(p[0],I):f=(r[0]+a[0])/2-p[0];const E=(r[1]+a[1])/2-p[1];h=f*f+E*E>this.errorThresholdSquared_}if(h){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const _=[(i[0]+n[0])/2,(i[1]+n[1])/2],p=this.transformInv_(_),f=[(s[0]+t[0])/2,(s[1]+t[1])/2],E=this.transformInv_(f);this.addQuad_(t,i,_,f,r,o,p,E,c-1),this.addQuad_(f,_,n,s,E,p,a,u,c-1)}else{const _=[(t[0]+i[0])/2,(t[1]+i[1])/2],p=this.transformInv_(_),f=[(n[0]+s[0])/2,(n[1]+s[1])/2],E=this.transformInv_(f);this.addQuad_(t,_,f,s,r,p,E,u,c-1),this.addQuad_(_,i,n,f,p,o,a,E,c-1)}return}}if(P){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}m&11||this.addTriangle_(t,n,s,r,a,u),m&14||this.addTriangle_(t,n,i,r,a,o),m&&(m&13||this.addTriangle_(i,s,t,o,u,r),m&7||this.addTriangle_(i,s,n,o,u,a))}calculateSourceExtent(){const t=ot();return this.triangles_.forEach(function(i,n,s){const r=i.source;at(t,r[0]),at(t,r[1]),at(t,r[2])}),t}getTriangles(){return this.triangles_}}var kn=Xn;const Hn=.5;class Yn extends Qt{constructor(t,i,n,s,r,o,a){let u=t.getExtent();u&&t.canWrapX()&&(u=u.slice(),u[0]=-1/0,u[2]=1/0);let c=i.getExtent();c&&i.canWrapX()&&(c=c.slice(),c[0]=-1/0,c[2]=1/0);const l=c?sn(n,c):n,d=zt(l),I=$e(t,i,d,s),P=Hn,h=new kn(t,i,l,u,I*P,s),m=h.calculateSourceExtent(),_=ee(m)?null:o(m,I,r),p=_?R.IDLE:R.EMPTY,f=_?_.getPixelRatio():1;super(n,s,f,p),this.targetProj_=i,this.maxSourceExtent_=u,this.triangulation_=h,this.targetResolution_=s,this.targetExtent_=n,this.sourceImage_=_,this.sourcePixelRatio_=f,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==R.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==R.LOADED){const i=w(this.targetExtent_)/this.targetResolution_,n=y(this.targetExtent_)/this.targetResolution_;this.canvas_=Dn(i,n,this.sourcePixelRatio_,Ft(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=t,this.changed()}load(){if(this.state==R.IDLE){this.state=R.LOADING,this.changed();const t=this.sourceImage_.getState();t==R.LOADED||t==R.ERROR?this.reproject_():(this.sourceListenerKey_=rt(this.sourceImage_,st.CHANGE,i=>{const n=this.sourceImage_.getState();(n==R.LOADED||n==R.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){It(this.sourceListenerKey_),this.sourceListenerKey_=null}}var qn=Yn,Qn={PROPERTYCHANGE:"propertychange"};let ft=class extends Xt{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(st.CHANGE)}getRevision(){return this.revision_}onInternal(t,i){if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=rt(this,t[r],i);return s}return rt(this,t,i)}onceInternal(t,i){let n;if(Array.isArray(t)){const s=t.length;n=new Array(s);for(let r=0;r<s;++r)n[r]=kt(this,t[r],i)}else n=kt(this,t,i);return i.ol_key=n,n}unInternal(t,i){const n=i.ol_key;if(n)Vn(n);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],i);else this.removeEventListener(t,i)}};ft.prototype.on,ft.prototype.once,ft.prototype.un;function Vn(e){if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)It(e[t]);else It(e)}var Bn=ft;let Kn=0;function zn(e){return e.ol_uid||(e.ol_uid=String(++Kn))}class Oe extends Et{constructor(t,i,n){super(t),this.key=i,this.oldValue=n}}class Jn extends Bn{constructor(t){super(),this.on,this.once,this.un,zn(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let i;return this.values_&&this.values_.hasOwnProperty(t)&&(i=this.values_[t]),i}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,i){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new Oe(n,t,i)),n=Qn.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new Oe(n,t,i))}addChangeListener(t,i){this.addEventListener(`change:${t}`,i)}removeChangeListener(t,i){this.removeEventListener(`change:${t}`,i)}set(t,i,n){const s=this.values_||(this.values_={});if(n)s[t]=i;else{const r=s[t];s[t]=i,r!==i&&this.notify(t,r)}}setProperties(t,i){for(const n in t)this.set(n,t[n],i)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,i){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],Ne(this.values_)&&(this.values_=null),i||this.notify(t,n)}}}var Zn=Jn;let ti=class extends Zn{constructor(t){super(),this.projection=S(t.projection),this.attributions_=Se(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const i=this;this.viewPromise_=new Promise(function(n,s){i.viewResolver=n,i.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Se(t),this.changed()}setState(t){this.state_=t,this.changed()}};function Se(e){return e?typeof e=="function"?e:(Array.isArray(e)||(e=[e]),t=>e):null}var ei=ti;const L=4,Wt={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class ni extends Et{constructor(t,i){super(t),this.image=i}}class ii extends ei{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const i=this.getResolutions();if(i){const n=We(i,t);t=i[n]}return t}getImage(t,i,n,s){const r=this.getProjection();if(!r||!s||Pe(r,s))return r&&(s=r),this.getImageInternal(t,i,n,s);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Pe(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==i&&ze(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new qn(r,s,t,i,n,(o,a,u)=>this.getImageInternal(o,a,u,r),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,i,n,s){if(this.loader){const r=Ae(t,i,n,1),o=this.findNearestResolution(i);if(this.image&&(this.static_||this.wantedProjection_===s&&(this.wantedExtent_&&Bt(this.wantedExtent_,r)||Bt(this.image.getExtent(),r))&&(this.wantedResolution_&&Ft(this.wantedResolution_)===o||Ft(this.image.getResolution())===o)))return this.image;this.wantedProjection_=s,this.wantedExtent_=r,this.wantedResolution_=o,this.image=new Qt(r,o,n,this.loader),this.image.addEventListener(st.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const i=t.target;let n;switch(i.getState()){case R.LOADING:this.loading=!0,n=Wt.IMAGELOADSTART;break;case R.LOADED:this.loading=!1,n=Wt.IMAGELOADEND;break;case R.ERROR:this.loading=!1,n=Wt.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new ni(n,i))}}function si(e,t){e.getImage().src=t}function Ae(e,t,i,n){const s=t/i,r=zt(e),o=ut(w(e)/s,L),a=ut(y(e)/s,L),u=ut((n-1)*o/2,L),c=o+2*u,l=ut((n-1)*a/2,L),d=a+2*l;return Jt(r,s,0,[c,d])}var ri=ii;function je(e,t){const i=[];Object.keys(t).forEach(function(s){t[s]!==null&&t[s]!==void 0&&i.push(s+"="+encodeURIComponent(t[s]))});const n=i.join("&");return e=e.replace(/[?&]$/,""),e+=e.includes("?")?"&":"?",e+n}const be="1.3.0",ye=[101,101];function Le(e,t,i,n,s){s.WIDTH=i[0],s.HEIGHT=i[1];const r=n.getAxisOrientation(),o=re(s.VERSION,"1.3")>=0;s[o?"CRS":"SRS"]=n.getCode();const a=o&&r.startsWith("ne")?[t[1],t[0],t[3],t[2]]:t;return s.BBOX=a.join(","),je(e,s)}function oi(e,t,i,n,s,r,o){r=Object.assign({REQUEST:"GetMap"},r);const a=t/i,u=[ie(w(e)/a,L),ie(y(e)/a,L)];if(i!=1)switch(o){case"geoserver":const c=90*i+.5|0;"FORMAT_OPTIONS"in r?r.FORMAT_OPTIONS+=";dpi:"+c:r.FORMAT_OPTIONS="dpi:"+c;break;case"mapserver":r.MAP_RESOLUTION=90*i;break;case"carmentaserver":case"qgis":r.DPI=90*i;break;default:throw new Error("Unknown `serverType` configured")}return Le(s,e,u,n,r)}function Te(e,t){return Object.assign({REQUEST:t,SERVICE:"WMS",VERSION:be,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},e)}function ai(e){const t=e.hidpi===void 0?!0:e.hidpi,i=S(e.projection||"EPSG:3857"),n=e.ratio||1.5,s=e.load||qt,r=e.crossOrigin??null;return(o,a,u)=>{o=Ae(o,a,u,n),u!=1&&(!t||e.serverType===void 0)&&(u=1);const c=oi(o,a,u,i,e.url,Te(e.params,"GetMap"),e.serverType),l=new Image;return l.crossOrigin=r,s(l,c).then(d=>({image:d,extent:o,pixelRatio:u}))}}function ui(e,t,i){if(e.url===void 0)return;const n=S(e.projection||"EPSG:3857"),s=Jt(t,i,0,ye),r={QUERY_LAYERS:e.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(r,Te(e.params,"GetFeatureInfo"),e.params);const o=se((t[0]-s[0])/i,L),a=se((s[3]-t[1])/i,L),u=re(r.VERSION,"1.3")>=0;return r[u?"I":"X"]=o,r[u?"J":"Y"]=a,Le(e.url,s,ye,n,r)}function ci(e,t){if(e.url===void 0)return;const i={SERVICE:"WMS",VERSION:be,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t!==void 0){const n=S(e.projection||"EPSG:3857").getMetersPerUnit()||1,s=28e-5;i.SCALE=t*n/s}if(Object.assign(i,e.params),e.params!==void 0&&i.LAYER===void 0){const n=i.LAYERS;if(!(!Array.isArray(n)||n.length!==1))return;i.LAYER=n}return je(e.url,i)}class hi extends ri{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:si,this.params_=Object.assign({},t.params),this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(t,i,n,s){const r=S(n),o=this.getProjection();o&&o!==r&&(i=$e(o,r,t,i),t=Lt(t,r,o));const a={url:this.url_,params:{...this.params_,...s},projection:o||r};return ui(a,t,i)}getLegendUrl(t,i){return ci({url:this.url_,params:{...this.params_,...i}},t)}getParams(){return this.params_}getImageInternal(t,i,n,s){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==s)&&(this.loaderProjection_=s,this.loader=ai({crossOrigin:this.crossOrigin_,params:this.params_,projection:s,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(r,o)=>(this.image.setImage(r),this.imageLoadFunction_(this.image,o),qt(r))})),super.getImageInternal(t,i,n,s))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}setUrl(t){t!=this.url_&&(this.url_=t,this.loader=null,this.changed())}setParams(t){this.params_=Object.assign({},t),this.changed()}updateParams(t){Object.assign(this.params_,t),this.changed()}changed(){this.image=null,super.changed()}}var li=hi;export{li as default};
