var y={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function oe(e){const t=lt();for(let i=0,n=e.length;i<n;++i)pt(t,e[i]);return t}function Ve(e,t,i){const n=Math.min.apply(null,e),s=Math.min.apply(null,t),r=Math.max.apply(null,e),o=Math.max.apply(null,t);return _t(n,s,r,o,i)}function le(e,t){return Qe(e,t[0],t[1])}function Be(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function Qe(e,t,i){return e[0]<=t&&t<=e[2]&&e[1]<=i&&i<=e[3]}function ae(e,t){const i=e[0],n=e[1],s=e[2],r=e[3],o=t[0],l=t[1];let a=y.UNKNOWN;return o<i?a=a|y.LEFT:o>s&&(a=a|y.RIGHT),l<n?a=a|y.BELOW:l>r&&(a=a|y.ABOVE),a===y.UNKNOWN&&(a=y.INTERSECTING),a}function lt(){return[1/0,1/0,-1/0,-1/0]}function _t(e,t,i,n,s){return s?(s[0]=e,s[1]=t,s[2]=i,s[3]=n,s):[e,t,i,n]}function he(e){return _t(1/0,1/0,-1/0,-1/0,e)}function Je(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function pt(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function ti(e,t,i,n,s){for(;i<n;i+=s)ei(e,t[i],t[i+1]);return e}function ei(e,t,i){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],i),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],i)}function ii(e,t){let i;return i=t(Ot(e)),i||(i=t(jt(e)),i)||(i=t(Xt(e)),i)||(i=t(at(e)),i)?i:!1}function Lt(e){let t=0;return ce(e)||(t=I(e)*K(e)),t}function Ot(e){return[e[0],e[1]]}function jt(e){return[e[2],e[1]]}function ue(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function ni(e,t){let i;if(t==="bottom-left")i=Ot(e);else if(t==="bottom-right")i=jt(e);else if(t==="top-left")i=at(e);else if(t==="top-right")i=Xt(e);else throw new Error("Invalid corner");return i}function K(e){return e[3]-e[1]}function At(e,t,i){const n=lt();return zt(e,t)?(e[0]>t[0]?n[0]=e[0]:n[0]=t[0],e[1]>t[1]?n[1]=e[1]:n[1]=t[1],e[2]<t[2]?n[2]=e[2]:n[2]=t[2],e[3]<t[3]?n[3]=e[3]:n[3]=t[3]):he(n),n}function at(e){return[e[0],e[3]]}function Xt(e){return[e[2],e[3]]}function I(e){return e[2]-e[0]}function zt(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function ce(e){return e[2]<e[0]||e[3]<e[1]}function si(e,t,i){let n=!1;const s=ae(e,t),r=ae(e,i);if(s===y.INTERSECTING||r===y.INTERSECTING)n=!0;else{const o=e[0],l=e[1],a=e[2],h=e[3],u=t[0],_=t[1],v=i[0],M=i[1],c=(M-_)/(v-u);let g,f;r&y.ABOVE&&!(s&y.ABOVE)&&(g=v-(M-h)/c,n=g>=o&&g<=a),!n&&r&y.RIGHT&&!(s&y.RIGHT)&&(f=M-(v-a)*c,n=f>=l&&f<=h),!n&&r&y.BELOW&&!(s&y.BELOW)&&(g=v-(M-l)/c,n=g>=o&&g<=a),!n&&r&y.LEFT&&!(s&y.LEFT)&&(f=M-(v-o)*c,n=f>=l&&f<=h)}return n}function ri(e,t,i,n){if(ce(e))return he(i);let s=[];s=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]],t(s,s,2);const r=[],o=[];for(let l=0,a=s.length;l<a;l+=2)r.push(s[l]),o.push(s[l+1]);return Ve(r,o,i)}function oi(e,t){const i=t.getExtent(),n=ue(e);if(t.canWrapX()&&(n[0]<i[0]||n[0]>=i[2])){const s=I(i),r=Math.floor((n[0]-i[0])/s)*s;e[0]-=r,e[2]-=r}return e}function li(e,t,i){if(t.canWrapX()){const n=t.getExtent();if(!isFinite(e[0])||!isFinite(e[2]))return[[n[0],e[1],n[2],e[3]]];oi(e,t);const s=I(n);if(I(e)>s,e[0]<n[0])return[[e[0]+s,e[1],n[2],e[3]],[n[0],e[1],e[2],e[3]]];if(e[2]>n[2])return[[e[0],e[1],n[2],e[3]],[n[0],e[1],e[2]-s,e[3]]]}return[e]}function Wt(e,t,i){return Math.min(Math.max(e,t),i)}function ai(e){const t=e.length;for(let n=0;n<t;n++){let s=n,r=Math.abs(e[n][n]);for(let l=n+1;l<t;l++){const a=Math.abs(e[l][n]);a>r&&(r=a,s=l)}if(r===0)return null;const o=e[s];e[s]=e[n],e[n]=o;for(let l=n+1;l<t;l++){const a=-e[l][n]/e[n][n];for(let h=n;h<t+1;h++)n==h?e[l][h]=0:e[l][h]+=a*e[n][h]}}const i=new Array(t);for(let n=t-1;n>=0;n--){i[n]=e[n][t]/e[n][n];for(let s=n-1;s>=0;s--)e[s][t]-=e[s][n]*i[n]}return i}function de(e){return e*180/Math.PI}function z(e){return e*Math.PI/180}function mt(e,t){const i=e%t;return i*t<0?i+t:i}function ge(e,t){const i=Math.pow(10,t);return Math.round(e*i)/i}function xt(e,t){return Math.floor(ge(e,t))}function Tt(e,t){return Math.ceil(ge(e,t))}function Dt(e,t,i){if(e>=t&&e<i)return e;const n=i-t;return((e-t)%n+n)%n+t}const fe={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let hi=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||fe[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};var Yt=hi;const ht=6378137,q=Math.PI*ht,ui=[-q,-q,q,q],ci=[-180,-85,180,85],Et=ht*Math.log(Math.tan(Math.PI/2));let H=class extends Yt{constructor(t){super({code:t,units:"m",extent:ui,global:!0,worldExtent:ci,getPointResolution:function(i,n){return i/Math.cosh(n[1]/ht)}})}};const _e=[new H("EPSG:3857"),new H("EPSG:102100"),new H("EPSG:102113"),new H("EPSG:900913"),new H("http://www.opengis.net/def/crs/EPSG/0/3857"),new H("http://www.opengis.net/gml/srs/epsg.xml#3857")];function di(e,t,i,n){const s=e.length;i=i>1?i:2,n=n??i,t===void 0&&(i>2?t=e.slice():t=new Array(s));for(let r=0;r<s;r+=n){t[r]=q*e[r]/180;let o=ht*Math.log(Math.tan(Math.PI*(+e[r+1]+90)/360));o>Et?o=Et:o<-Et&&(o=-Et),t[r+1]=o}return t}function gi(e,t,i,n){const s=e.length;i=i>1?i:2,n=n??i,t===void 0&&(i>2?t=e.slice():t=new Array(s));for(let r=0;r<s;r+=n)t[r]=180*e[r]/q,t[r+1]=360*Math.atan(Math.exp(e[r+1]/ht))/Math.PI-90;return t}const fi=6378137,pe=[-180,-90,180,90],_i=Math.PI*fi/180;let W=class extends Yt{constructor(t,i){super({code:t,units:"degrees",extent:pe,axisOrientation:i,global:!0,metersPerUnit:_i,worldExtent:pe})}};const me=[new W("CRS:84"),new W("EPSG:4326","neu"),new W("urn:ogc:def:crs:OGC:1.3:CRS84"),new W("urn:ogc:def:crs:OGC:2:84"),new W("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new W("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new W("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ut={};function pi(e){return Ut[e]||Ut[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function mi(e,t){Ut[e]=t}function xe(e){for(const t in e)delete e[t]}function xi(e){let t;for(t in e)return!1;return!t}let V={};function ut(e,t,i){const n=e.getCode(),s=t.getCode();n in V||(V[n]={}),V[n][s]=i}function Zt(e,t){return e in V&&t in V[e]?V[e][t]:null}const vt=.9996,O=.00669438,Mt=O*O,Pt=Mt*O,D=O/(1-O),Te=Math.sqrt(1-O),B=(1-Te)/(1+Te),Ee=B*B,Nt=Ee*B,kt=Nt*B,ve=kt*B,Me=1-O/4-3*Mt/64-5*Pt/256,Ti=3*O/8+3*Mt/32+45*Pt/1024,Ei=15*Mt/256+45*Pt/1024,vi=35*Pt/3072,Mi=3/2*B-27/32*Nt+269/512*ve,Pi=21/16*Ee-55/32*kt,Si=151/96*Nt-417/128*ve,Ri=1097/512*kt,St=6378137;function $i(e,t,i){const n=e-5e5,s=(i.north?t:t-1e7)/vt/(St*Me),r=s+Mi*Math.sin(2*s)+Pi*Math.sin(4*s)+Si*Math.sin(6*s)+Ri*Math.sin(8*s),o=Math.sin(r),l=o*o,a=Math.cos(r),h=o/a,u=h*h,_=u*u,v=1-O*l,M=Math.sqrt(1-O*l),c=St/M,g=(1-O)/v,f=D*a**2,E=f*f,x=n/(c*vt),p=x*x,T=p*x,d=T*x,w=d*x,L=w*x,$=r-h/g*(p/2-d/24*(5+3*u+10*f-4*E-9*D))+L/720*(61+90*u+298*f+45*_-252*D-3*E);let S=(x-T/6*(1+2*u+f)+w/120*(5-2*f+28*u-3*E+8*D+24*_))/a;return S=Dt(S+z(Re(i.number)),-Math.PI,Math.PI),[de(S),de($)]}const Pe=-80,Se=84,wi=-180,Fi=180;function Ci(e,t,i){e=Dt(e,wi,Fi),t<Pe?t=Pe:t>Se&&(t=Se);const n=z(t),s=Math.sin(n),r=Math.cos(n),o=s/r,l=o*o,a=l*l,h=z(e),u=Re(i.number),_=z(u),v=St/Math.sqrt(1-O*s**2),M=D*r**2,c=r*Dt(h-_,-Math.PI,Math.PI),g=c*c,f=g*c,E=f*c,x=E*c,p=x*c,T=St*(Me*n-Ti*Math.sin(2*n)+Ei*Math.sin(4*n)-vi*Math.sin(6*n)),d=vt*v*(c+f/6*(1-l+M)+x/120*(5-18*l+a+72*M-58*D))+5e5;let w=vt*(T+v*o*(g/2+E/24*(5-l+9*M+4*M**2)+p/720*(61-58*l+a+600*M-330*D)));return i.north||(w+=1e7),[d,w]}function Re(e){return(e-1)*6-180+3}const yi=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function $e(e){let t=0;for(const s of yi){const r=e.match(s);if(r){t=parseInt(r[1]);break}}if(!t)return null;let i=0,n=!1;return t>32700&&t<32761?i=t-32700:t>32600&&t<32661&&(n=!0,i=t-32600),i?{number:i,north:n}:null}function we(e,t){return function(i,n,s,r){const o=i.length;s=s>1?s:2,r=r??s,n||(s>2?n=i.slice():n=new Array(o));for(let l=0;l<o;l+=r){const a=i[l],h=i[l+1],u=e(a,h,t);n[l]=u[0],n[l+1]=u[1]}return n}}function Ii(e){return $e(e)?new Yt({code:e,units:"m"}):null}function Gi(e){const t=$e(e.getCode());return t?{forward:we(Ci,t),inverse:we($i,t)}:null}const bi=63710088e-1;function Fe(e,t,i){i=i||bi;const n=z(e[1]),s=z(t[1]),r=(s-n)/2,o=z(t[0]-e[0])/2,l=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(s);return 2*i*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}const Li=[Gi],Oi=[Ii];function Kt(e,t){if(t!==void 0){for(let i=0,n=e.length;i<n;++i)t[i]=e[i];t=t}else t=e.slice();return t}function qt(e){mi(e.getCode(),e),ut(e,e,Kt)}function ji(e){e.forEach(qt)}function b(e){if(typeof e!="string")return e;const t=pi(e);if(t)return t;for(const i of Oi){const n=i(e);if(n)return n}return null}function Ce(e,t,i,n){e=b(e);let s;const r=e.getPointResolutionFunc();if(r)s=r(t,i);else{const o=e.getUnits();if(o=="degrees"||n=="degrees")s=t;else{const l=Ht(e,b("EPSG:4326"));if(!l&&o!=="degrees")s=t*e.getMetersPerUnit();else{let h=[i[0]-t/2,i[1],i[0]+t/2,i[1],i[0],i[1]-t/2,i[0],i[1]+t/2];h=l(h,h,2);const u=Fe(h.slice(0,2),h.slice(2,4)),_=Fe(h.slice(4,6),h.slice(6,8));s=(u+_)/2}const a=e.getMetersPerUnit();a!==void 0&&(s/=a)}}return s}function ye(e){ji(e),e.forEach(function(t){e.forEach(function(i){t!==i&&ut(t,i,Kt)})})}function Ai(e,t,i,n){e.forEach(function(s){t.forEach(function(r){ut(s,r,i),ut(r,s,n)})})}function Xi(e){return function(t,i,n,s){const r=t.length;n=n!==void 0?n:2,s=s??n,i=i!==void 0?i:new Array(r);for(let o=0;o<r;o+=s){const l=e(t.slice(o,o+n)),a=l.length;for(let h=0,u=s;h<u;++h)i[o+h]=h>=a?t[o+h]:l[h]}return i}}function ct(e,t){if(e===t)return!0;const i=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||Ht(e,t)===Kt)&&i}function Ht(e,t){const i=e.getCode(),n=t.getCode();let s=Zt(i,n);if(s)return s;let r=null,o=null;for(const a of Li)r||(r=a(e)),o||(o=a(t));if(!r&&!o)return null;const l="EPSG:4326";if(o)if(r)s=Vt(r.inverse,o.forward);else{const a=Zt(i,l);a&&(s=Vt(a,o.forward))}else{const a=Zt(l,n);a&&(s=Vt(r.inverse,a))}return s&&(qt(e),qt(t),ut(e,t,s)),s}function Vt(e,t){return function(i,n,s,r){return n=e(i,n,s,r),t(n,n,s,r)}}function Bt(e,t){const i=b(e),n=b(t);return Ht(i,n)}function Ie(e,t,i){const n=Bt(t,i);if(!n){const s=b(t).getCode(),r=b(i).getCode();throw new Error(`No transform available between ${s} and ${r}`)}return n(e,void 0,e.length)}function zi(e,t,i,n){const s=Bt(t,i);return ri(e,s,void 0)}function Wi(){ye(_e),ye(me),Ai(me,_e,di,gi)}Wi();let Ge=class{constructor(t,i,n,s){this.minX=t,this.maxX=i,this.minY=n,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,i){return this.minX<=t&&t<=this.maxX&&this.minY<=i&&i<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}};function Q(e,t,i,n,s){return s!==void 0?(s.minX=e,s.maxX=t,s.minY=i,s.maxY=n,s):new Ge(e,t,i,n)}var Di=Ge;function Yi(e,t){return e>t?1:e<t?-1:0}function Ui(e,t,i){if(e[0]<=t)return 0;const n=e.length;if(t<=e[n-1])return n-1;if(typeof i=="function"){for(let s=1;s<n;++s){const r=e[s];if(r===t)return s;if(r<t)return i(t,e[s-1],r)>0?s-1:s}return n-1}if(i>0){for(let s=1;s<n;++s)if(e[s]<t)return s-1;return n-1}if(i<0){for(let s=1;s<n;++s)if(e[s]<=t)return s;return n-1}for(let s=1;s<n;++s){if(e[s]==t)return s;if(e[s]<t)return e[s-1]-t<t-e[s]?s-1:s}return n-1}function Zi(e,t,i){const n=t||Yi;return e.every(function(s,r){if(r===0)return!0;const o=n(e[r-1],s);return!(o>0||o===0)})}function dt(e,t){if(!e)throw new Error(t)}function Rt(e,t,i,n,s,r){let o=0,l=e[i-n],a=e[i-n+1];for(;t<i;t+=n){const h=e[t],u=e[t+1];a<=r?u>r&&(h-l)*(r-a)-(s-l)*(u-a)>0&&o++:u<=r&&(h-l)*(r-a)-(s-l)*(u-a)<0&&o--,l=h,a=u}return o!==0}function Ni(e,t,i,n,s){let r;for(t+=n;t<i;t+=n)if(r=s(e.slice(t-n,t),e.slice(t,t+n)),r)return r;return!1}function ki(e,t,i,n,s,r){return r=r??ti(lt(),e,t,i,n),zt(s,r)?r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:Ni(e,t,i,n,function(o,l){return si(s,o,l)}):!1}function Ki(e,t,i,n,s){return!!(ki(e,t,i,n,s)||Rt(e,t,i,n,s[0],s[1])||Rt(e,t,i,n,s[0],s[3])||Rt(e,t,i,n,s[2],s[1])||Rt(e,t,i,n,s[2],s[3]))}function qi(e,t,i){return i===void 0&&(i=[0,0]),i[0]=e[0]*t+.5|0,i[1]=e[1]*t+.5|0,i}function Y(e,t){return Array.isArray(e)?e:(t===void 0?t=[e,e]:(t[0]=e,t[1]=e),t)}function be(e,t,i,n){return n!==void 0?(n[0]=e,n[1]=t,n[2]=i,n):[e,t,i]}function Hi(e){return Vi(e[0],e[1],e[2])}function Vi(e,t,i){return(t<<e)+i}function Bi(e,t){const i=e[0],n=e[1],s=e[2];if(t.getMinZoom()>i||i>t.getMaxZoom())return!1;const r=t.getFullTileRange(i);return r?r.containsXY(n,s):!0}const Qi=42,Le=256,J=[0,0,0],A=5;let Ji=class{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,dt(Zi(this.resolutions_,(s,r)=>r-s),"`resolutions` must be sorted in descending order");let i;if(!t.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!i)i=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==i){i=void 0;break}}this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,dt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=at(n)),dt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,dt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Le,dt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((s,r)=>{const o=new Di(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(n){const l=this.getTileRangeForExtentAndZ(n,r);o.minX=Math.max(l.minX,o.minX),o.maxX=Math.min(l.maxX,o.maxX),o.minY=Math.max(l.minY,o.minY),o.maxY=Math.min(l.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,i,n){const s=this.getTileRangeForExtentAndZ(t,i);for(let r=s.minX,o=s.maxX;r<=o;++r)for(let l=s.minY,a=s.maxY;l<=a;++l)n([i,r,l])}forEachTileCoordParentTileRange(t,i,n,s){let r,o,l,a=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],l=t[2]):a=this.getTileCoordExtent(t,s);h>=this.minZoom;){if(o!==void 0&&l!==void 0?(o=Math.floor(o/2),l=Math.floor(l/2),r=Q(o,o,l,l,n)):r=this.getTileRangeForExtentAndZ(a,h,n),i(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,i,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const r=t[1]*2,o=t[2]*2;return Q(r,r+1,o,o+1,i)}const s=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,i)}return null}getTileRangeForTileCoordAndZ(t,i,n){if(i>this.maxZoom||i<this.minZoom)return null;const s=t[0],r=t[1],o=t[2];if(i===s)return Q(r,o,r,o,n);if(this.zoomFactor_){const a=Math.pow(this.zoomFactor_,i-s),h=Math.floor(r*a),u=Math.floor(o*a);if(i<s)return Q(h,h,u,u,n);const _=Math.floor(a*(r+1))-1,v=Math.floor(a*(o+1))-1;return Q(h,_,u,v,n)}const l=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,i,n)}getTileRangeForExtentAndZ(t,i,n){this.getTileCoordForXYAndZ_(t[0],t[3],i,!1,J);const s=J[1],r=J[2];this.getTileCoordForXYAndZ_(t[2],t[1],i,!0,J);const o=J[1],l=J[2];return Q(s,o,r,l,n)}getTileCoordCenter(t){const i=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=Y(this.getTileSize(t[0]),this.tmpSize_);return[i[0]+(t[1]+.5)*s[0]*n,i[1]-(t[2]+.5)*s[1]*n]}getTileCoordExtent(t,i){const n=this.getOrigin(t[0]),s=this.getResolution(t[0]),r=Y(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*r[0]*s,l=n[1]-(t[2]+1)*r[1]*s,a=o+r[0]*s,h=l+r[1]*s;return _t(o,l,a,h,i)}getTileCoordForCoordAndResolution(t,i,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],i,!1,n)}getTileCoordForXYAndResolution_(t,i,n,s,r){const o=this.getZForResolution(n),l=n/this.getResolution(o),a=this.getOrigin(o),h=Y(this.getTileSize(o),this.tmpSize_);let u=l*(t-a[0])/n/h[0],_=l*(a[1]-i)/n/h[1];return s?(u=Tt(u,A)-1,_=Tt(_,A)-1):(u=xt(u,A),_=xt(_,A)),be(o,u,_,r)}getTileCoordForXYAndZ_(t,i,n,s,r){const o=this.getOrigin(n),l=this.getResolution(n),a=Y(this.getTileSize(n),this.tmpSize_);let h=(t-o[0])/l/a[0],u=(o[1]-i)/l/a[1];return s?(h=Tt(h,A)-1,u=Tt(u,A)-1):(h=xt(h,A),u=xt(u,A)),be(n,h,u,r)}getTileCoordForCoordAndZ(t,i,n){return this.getTileCoordForXYAndZ_(t[0],t[1],i,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,i){const n=Ui(this.resolutions_,t,i||0);return Wt(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,i){return Ki(i,0,i.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const i=this.resolutions_.length,n=new Array(i);for(let s=this.minZoom;s<i;++s)n[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=n}};var Oe=Ji;let tn=class extends Oe{constructor(t){super({extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes}),this.matrixIds_=t.matrixIds}getMatrixId(t){return this.matrixIds_[t]}getMatrixIds(){return this.matrixIds_}};function en(e,t,i){const n=[],s=[],r=[],o=[],l=[];i=i!==void 0?i:[];const a="SupportedCRS",h="TileMatrix",u="Identifier",_="ScaleDenominator",v="TopLeftCorner",M="TileWidth",c="TileHeight",g=e[a],f=b(g),E=f.getMetersPerUnit(),x=f.getAxisOrientation().startsWith("ne");return e[h].sort(function(p,T){return T[_]-p[_]}),e[h].forEach(function(p){let T;if(i.length>0?T=i.find(function(d){return p[u]==d[h]?!0:p[u].includes(":")?!1:e[u]+":"+p[u]===d[h]}):T=!0,T){s.push(p[u]);const d=p[_]*28e-5/E,w=p[M],L=p[c];x?r.push([p[v][1],p[v][0]]):r.push(p[v]),n.push(d),o.push(w==L?w:[w,L]),l.push([p.MatrixWidth,p.MatrixHeight])}}),new tn({extent:t,origins:r,resolutions:n,matrixIds:s,tileSizes:o,sizes:l})}function je(e,t){const i=[];Object.keys(t).forEach(function(s){t[s]!==null&&t[s]!==void 0&&i.push(s+"="+encodeURIComponent(t[s]))});const n=i.join("&");return e=e.replace(/[?&]$/,""),e+=e.includes("?")?"&":"?",e+n}const nn=/\{z\}/g,sn=/\{x\}/g,rn=/\{y\}/g,on=/\{-y\}/g;function ln(e,t,i,n,s){return e.replace(nn,t.toString()).replace(sn,i.toString()).replace(rn,n.toString()).replace(on,function(){if(s===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(s-n).toString()})}function Ae(e){const t=[];let i=/\{([a-z])-([a-z])\}/.exec(e);if(i){const n=i[1].charCodeAt(0),s=i[2].charCodeAt(0);let r;for(r=n;r<=s;++r)t.push(e.replace(i[0],String.fromCharCode(r)));return t}if(i=/\{(\d+)-(\d+)\}/.exec(e),i){const n=parseInt(i[2],10);for(let s=parseInt(i[1],10);s<=n;s++)t.push(e.replace(i[0],s.toString()));return t}return t.push(e),t}function an(e,t){return function(i,n,s){if(!i)return;let r;const o=i[0];if(t){const l=t.getFullTileRange(o);l&&(r=l.getHeight()-1)}return ln(e,o,i[1],i[2],r)}}function hn(e,t){const i=e.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=an(e[s],t);return Qt(n)}function Qt(e){return e.length===1?e[0]:function(t,i,n){if(!t)return;const s=Hi(t),r=mt(s,e.length);return e[r](t,i,n)}}var tt={CHANGE:"change",ERROR:"error",LOAD:"load"};let un=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};var cn=un;function Xe(){}let dn=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var Jt=dn;let gn=class extends cn{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,i){if(!t||!i)return;const n=this.listeners_||(this.listeners_={}),s=n[t]||(n[t]=[]);s.includes(i)||s.push(i)}dispatchEvent(t){const i=typeof t=="string",n=i?t:t.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const r=i?new Jt(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,l[n]=0),++o[n];let a;for(let h=0,u=s.length;h<u;++h)if("handleEvent"in s[h]?a=s[h].handleEvent(r):a=s[h].call(this,r),a===!1||r.propagationStopped){a=!1;break}if(--o[n]===0){let h=l[n];for(delete l[n];h--;)this.removeEventListener(n,Xe);delete o[n]}return a}disposeInternal(){this.listeners_&&xe(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,i){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const s=n.indexOf(i);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[s]=Xe,++this.pendingRemovals_[t]):(n.splice(s,1),n.length===0&&delete this.listeners_[t]))}};var ze=gn;function $t(e,t,i,n,s){if(s){const o=i;i=function(l){return e.removeEventListener(t,i),o.call(this,l)}}const r={target:e,type:t,listener:i};return e.addEventListener(t,i),r}function wt(e,t,i,n){return $t(e,t,i,n,!0)}function gt(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),xe(e))}const U=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",fn=U.includes("safari")&&!U.includes("chrom");fn&&(U.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(U)),U.includes("webkit")&&U.includes("edge"),U.includes("macintosh");const _n=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,pn=typeof Image<"u"&&Image.prototype.decode;(function(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e})();function mn(e,t,i){const n=e;let s=!0,r=!1,o=!1;const l=[wt(n,tt.LOAD,function(){o=!0,r||t()})];return n.src&&pn?(r=!0,n.decode().then(function(){s&&t()}).catch(function(a){s&&(o?t():i())})):l.push(wt(n,tt.ERROR,i)),function(){s=!1,l.forEach(gt)}}var P={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function xn(e){return Math.pow(e,3)}function We(){throw new Error("Unimplemented abstract method.")}let Tn=0;function ft(e){return e.ol_uid||(e.ol_uid=String(++Tn))}let En=class extends ze{constructor(t,i,n){super(),n=n||{},this.tileCoord=t,this.state=i,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(tt.CHANGE)}release(){this.setState(P.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==P.EMPTY){if(this.state!==P.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){We()}getAlpha(t,i){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=i,this.transitionStarts_[t]=n;else if(n===-1)return 1;const s=i-n+1e3/60;return s>=this.transition_?1:xn(s/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}};var De=En;function Ft(e,t,i,n){let s;return i&&i.length?s=i.shift():_n?s=new OffscreenCanvas(e||300,t||300):s=document.createElement("canvas"),e&&(s.width=e),t&&(s.height=t),s.getContext("2d",n)}function te(e){const t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}let vn=class extends De{constructor(t,i,n,s,r,o){super(t,i,o),this.crossOrigin_=s,this.src_=n,this.key=n,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=P.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=P.ERROR,this.unlistenImage_(),this.image_=Mn(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=P.LOADED:this.state=P.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==P.ERROR&&(this.state=P.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==P.IDLE&&(this.state=P.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=mn(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};function Mn(){const e=Ft(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}var Pn=vn;let ee;const et=[];function Ye(e,t,i,n,s){e.beginPath(),e.moveTo(0,0),e.lineTo(t,i),e.lineTo(n,s),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,n)+1,Math.max(i,s)),e.restore()}function ie(e,t){return Math.abs(e[t*4]-210)>2||Math.abs(e[t*4+3]-.75*255)>2}function Sn(){if(ee===void 0){const e=Ft(6,6,et);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",Ye(e,4,5,4,0),Ye(e,4,5,0,5);const t=e.getImageData(0,0,3,3).data;ee=ie(t,0)||ie(t,4)||ie(t,8),te(e),et.push(e.canvas)}return ee}function Ue(e,t,i,n){const s=Ie(i,t,e);let r=Ce(t,n,i);const o=t.getMetersPerUnit();o!==void 0&&(r*=o);const l=e.getMetersPerUnit();l!==void 0&&(r/=l);const a=e.getExtent();if(!a||le(a,s)){const h=Ce(e,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}function Rn(e,t,i,n){const s=ue(i);let r=Ue(e,t,s,n);return(!isFinite(r)||r<=0)&&ii(i,function(o){return r=Ue(e,t,o,n),isFinite(r)&&r>0}),r}function $n(e,t,i,n,s,r,o,l,a,h,u,_,v,M){const c=Ft(Math.round(i*e),Math.round(i*t),et);if(_||(c.imageSmoothingEnabled=!1),a.length===0)return c.canvas;c.scale(i,i);function g(d){return Math.round(d*i)/i}c.globalCompositeOperation="lighter";const f=lt();a.forEach(function(d,w,L){Je(f,d.extent)});let E;const x=i/n,p=(_?1:1+Math.pow(2,-24))/x;E=Ft(Math.round(I(f)*x),Math.round(K(f)*x),et),_||(E.imageSmoothingEnabled=!1),a.forEach(function(d,w,L){if(d.image.width>0&&d.image.height>0){if(d.clipExtent){E.save();const F=(d.clipExtent[0]-f[0])*x,C=-(d.clipExtent[3]-f[3])*x,G=I(d.clipExtent)*x,Z=K(d.clipExtent)*x;E.rect(_?F:Math.round(F),_?C:Math.round(C),_?G:Math.round(F+G)-Math.round(F),_?Z:Math.round(C+Z)-Math.round(C)),E.clip()}const $=(d.extent[0]-f[0])*x,S=-(d.extent[3]-f[3])*x,m=I(d.extent)*x,R=K(d.extent)*x;E.drawImage(d.image,h,h,d.image.width-2*h,d.image.height-2*h,_?$:Math.round($),_?S:Math.round(S),_?m:Math.round($+m)-Math.round($),_?R:Math.round(S+R)-Math.round(S)),d.clipExtent&&E.restore()}});const T=at(o);return l.getTriangles().forEach(function(d,w,L){const $=d.source,S=d.target;let m=$[0][0],R=$[0][1],F=$[1][0],C=$[1][1],G=$[2][0],Z=$[2][1];const it=g((S[0][0]-T[0])/r),nt=g(-(S[0][1]-T[1])/r),N=g((S[1][0]-T[0])/r),k=g(-(S[1][1]-T[1])/r),yt=g((S[2][0]-T[0])/r),It=g(-(S[2][1]-T[1])/r),Gt=m,bt=R;m=0,R=0,F-=Gt,C-=bt,G-=Gt,Z-=bt;const He=[[F,C,0,0,N-it],[G,Z,0,0,yt-it],[0,0,F,C,k-nt],[0,0,G,Z,It-nt]],st=ai(He);if(!st)return;if(c.save(),c.beginPath(),Sn()||!_){c.moveTo(N,k);const j=4,ot=it-N,re=nt-k;for(let X=0;X<j;X++)c.lineTo(N+g((X+1)*ot/j),k+g(X*re/(j-1))),X!=j-1&&c.lineTo(N+g((X+1)*ot/j),k+g((X+1)*re/(j-1)));c.lineTo(yt,It)}else c.moveTo(N,k),c.lineTo(it,nt),c.lineTo(yt,It);c.clip(),c.transform(st[0],st[2],st[1],st[3],it,nt),c.translate(f[0]-Gt,f[3]-bt);let rt;if(E)rt=E.canvas,c.scale(p,-p);else{const j=a[0],ot=j.extent;rt=j.image,c.scale(I(ot)/rt.width,-K(ot)/rt.height)}c.drawImage(rt,0,0),c.restore()}),E&&(te(E),et.push(E.canvas)),u&&(c.save(),c.globalCompositeOperation="source-over",c.strokeStyle="black",c.lineWidth=1,l.getTriangles().forEach(function(d,w,L){const $=d.target,S=($[0][0]-T[0])/r,m=-($[0][1]-T[1])/r,R=($[1][0]-T[0])/r,F=-($[1][1]-T[1])/r,C=($[2][0]-T[0])/r,G=-($[2][1]-T[1])/r;c.beginPath(),c.moveTo(R,F),c.lineTo(S,m),c.lineTo(C,G),c.closePath(),c.stroke()}),c.restore()),c.canvas}new Array(6);function wn(e,t){const i=t[0],n=t[1];return t[0]=e[0]*i+e[2]*n+e[4],t[1]=e[1]*i+e[3]*n+e[5],t}const Fn=10,Ze=.25;let Cn=class{constructor(t,i,n,s,r,o,l){this.sourceProj_=t,this.targetProj_=i;let a={};const h=l?Xi(p=>wn(l,Ie(p,this.targetProj_,this.sourceProj_))):Bt(this.targetProj_,this.sourceProj_);this.transformInv_=function(p){const T=p[0]+"/"+p[1];return a[T]||(a[T]=h(p)),a[T]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&I(s)>=I(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?I(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?I(this.targetProj_.getExtent()):null;const u=at(n),_=Xt(n),v=jt(n),M=Ot(n),c=this.transformInv_(u),g=this.transformInv_(_),f=this.transformInv_(v),E=this.transformInv_(M),x=Fn+(o?Math.max(0,Math.ceil(Math.log2(Lt(n)/(o*o*256*256)))):0);if(this.addQuad_(u,_,v,M,c,g,f,E,x),this.wrapsXInSource_){let p=1/0;this.triangles_.forEach(function(T,d,w){p=Math.min(p,T.source[0][0],T.source[1][0],T.source[2][0])}),this.triangles_.forEach(T=>{if(Math.max(T.source[0][0],T.source[1][0],T.source[2][0])-p>this.sourceWorldWidth_/2){const d=[[T.source[0][0],T.source[0][1]],[T.source[1][0],T.source[1][1]],[T.source[2][0],T.source[2][1]]];d[0][0]-p>this.sourceWorldWidth_/2&&(d[0][0]-=this.sourceWorldWidth_),d[1][0]-p>this.sourceWorldWidth_/2&&(d[1][0]-=this.sourceWorldWidth_),d[2][0]-p>this.sourceWorldWidth_/2&&(d[2][0]-=this.sourceWorldWidth_);const w=Math.min(d[0][0],d[1][0],d[2][0]);Math.max(d[0][0],d[1][0],d[2][0])-w<this.sourceWorldWidth_/2&&(T.source=d)}})}a={}}addTriangle_(t,i,n,s,r,o){this.triangles_.push({source:[s,r,o],target:[t,i,n]})}addQuad_(t,i,n,s,r,o,l,a,h){const u=oe([r,o,l,a]),_=this.sourceWorldWidth_?I(u)/this.sourceWorldWidth_:null,v=this.sourceWorldWidth_,M=this.sourceProj_.canWrapX()&&_>.5&&_<1;let c=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const f=oe([t,i,n,s]);c=I(f)/this.targetWorldWidth_>Ze||c}!M&&this.sourceProj_.isGlobal()&&_&&(c=_>Ze||c)}if(!c&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!zt(u,this.maxSourceExtent_))return;let g=0;if(!c&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(a[0])||!isFinite(a[1]))){if(h>0)c=!0;else if(g=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(l[0])||!isFinite(l[1])?2:0)+(!isFinite(a[0])||!isFinite(a[1])?1:0),g!=1&&g!=2&&g!=4&&g!=8)return}if(h>0){if(!c){const f=[(t[0]+n[0])/2,(t[1]+n[1])/2],E=this.transformInv_(f);let x;M?x=(mt(r[0],v)+mt(l[0],v))/2-mt(E[0],v):x=(r[0]+l[0])/2-E[0];const p=(r[1]+l[1])/2-E[1];c=x*x+p*p>this.errorThresholdSquared_}if(c){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const f=[(i[0]+n[0])/2,(i[1]+n[1])/2],E=this.transformInv_(f),x=[(s[0]+t[0])/2,(s[1]+t[1])/2],p=this.transformInv_(x);this.addQuad_(t,i,f,x,r,o,E,p,h-1),this.addQuad_(x,f,n,s,p,E,l,a,h-1)}else{const f=[(t[0]+i[0])/2,(t[1]+i[1])/2],E=this.transformInv_(f),x=[(n[0]+s[0])/2,(n[1]+s[1])/2],p=this.transformInv_(x);this.addQuad_(t,f,x,s,r,E,p,a,h-1),this.addQuad_(f,i,n,x,E,o,l,p,h-1)}return}}if(M){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}g&11||this.addTriangle_(t,n,s,r,l,a),g&14||this.addTriangle_(t,n,i,r,l,o),g&&(g&13||this.addTriangle_(i,s,t,o,a,r),g&7||this.addTriangle_(i,s,n,o,a,l))}calculateSourceExtent(){const t=lt();return this.triangles_.forEach(function(i,n,s){const r=i.source;pt(t,r[0]),pt(t,r[1]),pt(t,r[2])}),t}getTriangles(){return this.triangles_}};var yn=Cn;const In=.5;let Gn=class extends De{constructor(t,i,n,s,r,o,l,a,h,u,_,v){super(r,P.IDLE,v),this.renderEdges_=_!==void 0?_:!1,this.pixelRatio_=l,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=i,this.targetTileGrid_=s,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const M=s.getTileCoordExtent(this.wrappedTileCoord_),c=this.targetTileGrid_.getExtent();let g=this.sourceTileGrid_.getExtent();const f=c?At(M,c):M;if(Lt(f)===0){this.state=P.EMPTY;return}const E=t.getExtent();E&&(g?g=At(g,E):g=E);const x=s.getResolution(this.wrappedTileCoord_[0]),p=Rn(t,n,f,x);if(!isFinite(p)||p<=0){this.state=P.EMPTY;return}const T=u!==void 0?u:In;if(this.triangulation_=new yn(t,n,f,g,p*T,x),this.triangulation_.getTriangles().length===0){this.state=P.EMPTY;return}this.sourceZ_=i.getZForResolution(p);let d=this.triangulation_.calculateSourceExtent();if(g&&(t.canWrapX()?(d[1]=Wt(d[1],g[1],g[3]),d[3]=Wt(d[3],g[1],g[3])):d=At(d,g)),!Lt(d))this.state=P.EMPTY;else{let w=0,L=0;t.canWrapX()&&(w=I(E),L=Math.floor((d[0]-E[0])/w)),li(d.slice(),t).forEach($=>{const S=i.getTileRangeForExtentAndZ($,this.sourceZ_);for(let m=S.minX;m<=S.maxX;m++)for(let R=S.minY;R<=S.maxY;R++){const F=h(this.sourceZ_,m,R,l);if(F){const C=L*w;this.sourceTiles_.push({tile:F,offset:C})}}++L}),this.sourceTiles_.length===0&&(this.state=P.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(i=>{const n=i.tile;if(n&&n.getState()==P.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);s[0]+=i.offset,s[2]+=i.offset;const r=this.clipExtent_?.slice();r&&(r[0]+=i.offset,r[2]+=i.offset),t.push({extent:s,clipExtent:r,image:n.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=P.ERROR;else{const i=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(i),s=typeof n=="number"?n:n[0],r=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(i),l=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=$n(s,r,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),o,a,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=P.LOADED}this.changed()}load(){if(this.state==P.IDLE){this.state=P.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:i})=>{const n=i.getState();if(n==P.IDLE||n==P.LOADING){t++;const s=$t(i,tt.CHANGE,r=>{const o=i.getState();(o==P.LOADED||o==P.ERROR||o==P.EMPTY)&&(gt(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:i},n,s){i.getState()==P.IDLE&&i.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(gt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(te(this.canvas_.getContext("2d")),et.push(this.canvas_),this.canvas_=null),super.release()}};var bn=Gn;function Ne(e){let t=e.getDefaultTileGrid();return t||(t=An(e),e.setDefaultTileGrid(t)),t}function Ln(e,t,i){const n=t[0],s=e.getTileCoordCenter(t),r=ke(i);if(!le(r,s)){const o=I(r),l=Math.ceil((r[0]-s[0])/o);return s[0]+=o*l,e.getTileCoordForCoordAndZ(s,n)}return t}function On(e,t,i,n){n=n!==void 0?n:"top-left";const s=jn(e,t,i);return new Oe({extent:e,origin:ni(e,n),resolutions:s,tileSize:i})}function jn(e,t,i,n){t=t!==void 0?t:Qi,i=Y(i!==void 0?i:Le);const s=K(e),r=I(e);n=n>0?n:Math.max(r/i[0],s/i[1]);const o=t+1,l=new Array(o);for(let a=0;a<o;++a)l[a]=n/Math.pow(2,a);return l}function An(e,t,i,n){const s=ke(e);return On(s,t,i,n)}function ke(e){e=b(e);let t=e.getExtent();if(!t){const i=180*fe.degrees/e.getMetersPerUnit();t=_t(-i,-i,i,i)}return t}var Xn={PROPERTYCHANGE:"propertychange"};let Ct=class extends ze{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(tt.CHANGE)}getRevision(){return this.revision_}onInternal(t,i){if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=$t(this,t[r],i);return s}return $t(this,t,i)}onceInternal(t,i){let n;if(Array.isArray(t)){const s=t.length;n=new Array(s);for(let r=0;r<s;++r)n[r]=wt(this,t[r],i)}else n=wt(this,t,i);return i.ol_key=n,n}unInternal(t,i){const n=i.ol_key;if(n)zn(n);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],i);else this.removeEventListener(t,i)}};Ct.prototype.on,Ct.prototype.once,Ct.prototype.un;function zn(e){if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)gt(e[t]);else gt(e)}var Wn=Ct;class Ke extends Jt{constructor(t,i,n){super(t),this.key=i,this.oldValue=n}}class Dn extends Wn{constructor(t){super(),this.on,this.once,this.un,ft(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let i;return this.values_&&this.values_.hasOwnProperty(t)&&(i=this.values_[t]),i}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,i){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new Ke(n,t,i)),n=Xn.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new Ke(n,t,i))}addChangeListener(t,i){this.addEventListener(`change:${t}`,i)}removeChangeListener(t,i){this.removeEventListener(`change:${t}`,i)}set(t,i,n){const s=this.values_||(this.values_={});if(n)s[t]=i;else{const r=s[t];s[t]=i,r!==i&&this.notify(t,r)}}setProperties(t,i){for(const n in t)this.set(n,t[n],i)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,i){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],xi(this.values_)&&(this.values_=null),i||this.notify(t,n)}}}var Yn=Dn;class Un extends Yn{constructor(t){super(),this.projection=b(t.projection),this.attributions_=qe(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const i=this;this.viewPromise_=new Promise(function(n,s){i.viewResolver=n,i.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=qe(t),this.changed()}setState(t){this.state_=t,this.changed()}}function qe(e){return e?typeof e=="function"?e:(Array.isArray(e)||(e=[e]),t=>e):null}var Zn=Un;class Nn extends Zn{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const i=[256,256];this.tileGrid&&Y(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),i),this.tmpSize=[0,0],this.key_=t.key||ft(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const i=t?this.getTileGridForProjection(t):this.tileGrid;return i?i.getResolutions():null}getTile(t,i,n,s,r){return We()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Ne(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,i,n){const s=this.getTileGridForProjection(n),r=this.getTilePixelRatio(i),o=Y(s.getTileSize(t),this.tmpSize);return r==1?o:qi(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,i){const n=i!==void 0?i:this.getProjection(),s=i!==void 0?this.getTileGridForProjection(n):this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=Ln(s,t,n)),Bi(t,s)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class kn extends Jt{constructor(t,i){super(t),this.tile=i}}var Kn=Nn,ne={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class se extends Kn{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===se.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const i=t.target,n=ft(i),s=i.getState();let r;s==P.LOADING?(this.tileLoadingKeys_[n]=!0,r=ne.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],r=s==P.ERROR?ne.TILELOADERROR:s==P.LOADED?ne.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new kn(r,i))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,i){this.tileUrlFunction=t,typeof i<"u"?this.setKey(i):this.changed()}setUrl(t){const i=Ae(t);this.urls=i,this.setUrls(i)}setUrls(t){this.urls=t;const i=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(hn(t,this.tileGrid),i):this.setKey(i)}tileUrlFunction(t,i,n){}}var qn=se;class Hn extends qn{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Vn,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Pn,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!ct(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){const i=this.getProjection();if(this.tileGrid&&(!i||ct(i,t)))return this.tileGrid;const n=ft(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Ne(t)),this.tileGridForProjection[n]}createTile_(t,i,n,s,r,o){const l=[t,i,n],a=this.getTileCoordForTileUrlFunction(l,r),h=a?this.tileUrlFunction(a,s,r):void 0,u=new this.tileClass(l,h!==void 0?P.IDLE:P.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=o,u.addEventListener(tt.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,i,n,s,r){const o=this.getProjection();if(!o||!r||ct(o,r))return this.getTileInternal(t,i,n,s,o||r);const l=[t,i,n],a=this.getKey(),h=this.getTileGridForProjection(o),u=this.getTileGridForProjection(r),_=this.getTileCoordForTileUrlFunction(l,r),v=new bn(o,h,r,u,l,_,this.getTilePixelRatio(s),this.getGutter(),(M,c,g,f)=>this.getTileInternal(M,c,g,f,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return v.key=a,v}getTileInternal(t,i,n,s,r){const o=this.getKey();return this.createTile_(t,i,n,s,r,o)}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,i){const n=b(t);if(n){const s=ft(n);s in this.tileGridForProjection||(this.tileGridForProjection[s]=i)}}}function Vn(e,t){e.getImage().src=t}var Bn=Hn;class Qn extends Bn{constructor(t){const i=t.requestEncoding!==void 0?t.requestEncoding:"KVP",n=t.tileGrid;let s=t.urls;s===void 0&&t.url!==void 0&&(s=Ae(t.url)),super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:s,wrapX:t.wrapX!==void 0?t.wrapX:!1,transition:t.transition,zDirection:t.zDirection}),this.version_=t.version!==void 0?t.version:"1.0.0",this.format_=t.format!==void 0?t.format:"image/jpeg",this.dimensions_=t.dimensions!==void 0?t.dimensions:{},this.layer_=t.layer,this.matrixSet_=t.matrixSet,this.style_=t.style,this.requestEncoding_=i,this.setKey(this.getKeyForDimensions_()),s&&s.length>0&&(this.tileUrlFunction=Qt(s.map(this.createFromWMTSTemplate.bind(this))))}setUrls(t){this.urls=t;const i=t.join(`
`);this.setTileUrlFunction(Qt(t.map(this.createFromWMTSTemplate.bind(this))),i)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const t=this.urls?this.urls.slice(0):[];for(const i in this.dimensions_)t.push(i+"-"+this.dimensions_[i]);return t.join("/")}updateDimensions(t){Object.assign(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(t){const i=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};i=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=i=="KVP"?je(t,n):t.replace(/\{(\w+?)\}/g,function(o,l){return l.toLowerCase()in n?n[l.toLowerCase()]:o});const s=this.tileGrid,r=this.dimensions_;return function(o,l,a){if(!o)return;const h={TileMatrix:s.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(h,r);let u=t;return i=="KVP"?u=je(u,h):u=u.replace(/\{(\w+?)\}/g,function(_,v){return encodeURIComponent(h[v])}),u}}}var Jn=Qn;function ts(e,t){const i=e.Contents.Layer?.find(function(m){return m.Identifier==t.layer});if(!i)return null;const n=e.Contents.TileMatrixSet;let s;i.TileMatrixSetLink.length>1?"projection"in t?s=i.TileMatrixSetLink.findIndex(function(m){const R=n.find(function(G){return G.Identifier==m.TileMatrixSet}).SupportedCRS,F=b(R),C=b(t.projection);return F&&C?ct(F,C):R==t.projection}):s=i.TileMatrixSetLink.findIndex(function(m){return m.TileMatrixSet==t.matrixSet}):s=0,s<0&&(s=0);const r=i.TileMatrixSetLink[s].TileMatrixSet,o=i.TileMatrixSetLink[s].TileMatrixSetLimits;let l=i.Format[0];"format"in t&&(l=t.format),s=i.Style.findIndex(function(m){return"style"in t?m.Title==t.style:m.isDefault}),s<0&&(s=0);const a=i.Style[s].Identifier,h={};"Dimension"in i&&i.Dimension.forEach(function(m,R,F){const C=m.Identifier;let G=m.Default;G===void 0&&(G=m.Value[0]),h[C]=G});const u=e.Contents.TileMatrixSet.find(function(m){return m.Identifier==r});let _;const v=u.SupportedCRS;if(v&&(_=b(v)),"projection"in t){const m=b(t.projection);m&&(!_||ct(m,_))&&(_=m)}let M=!1;const c=_.getAxisOrientation().startsWith("ne");let g=u.TileMatrix[0],f={MinTileCol:0,MinTileRow:0,MaxTileCol:g.MatrixWidth-1,MaxTileRow:g.MatrixHeight-1};if(o){f=o[o.length-1];const m=u.TileMatrix.find(R=>R.Identifier===f.TileMatrix||u.Identifier+":"+R.Identifier===f.TileMatrix);m&&(g=m)}const E=g.ScaleDenominator*28e-5/_.getMetersPerUnit(),x=c?[g.TopLeftCorner[1],g.TopLeftCorner[0]]:g.TopLeftCorner,p=g.TileWidth*E,T=g.TileHeight*E;let d=u.BoundingBox;d&&c&&(d=[d[1],d[0],d[3],d[2]]);let w=[x[0]+p*f.MinTileCol,x[1]-T*(1+f.MaxTileRow),x[0]+p*(1+f.MaxTileCol),x[1]-T*f.MinTileRow];if(d!==void 0&&!Be(d,w)){const m=i.WGS84BoundingBox,R=b("EPSG:4326").getExtent();if(w=d,m)M=m[0]===R[0]&&m[2]===R[2];else{const F=zi(d,u.SupportedCRS,"EPSG:4326");M=F[0]-1e-10<=R[0]&&F[2]+1e-10>=R[2]}}const L=en(u,w,o),$=[];let S=t.requestEncoding;if(S=S!==void 0?S:"","OperationsMetadata"in e&&"GetTile"in e.OperationsMetadata){const m=e.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let R=0,F=m.length;R<F;++R)if(m[R].Constraint){const C=m[R].Constraint.find(function(G){return G.name=="GetEncoding"}).AllowedValues.Value;if(S===""&&(S=C[0]),S==="KVP")C.includes("KVP")&&$.push(m[R].href);else break}else m[R].href&&(S="KVP",$.push(m[R].href))}return $.length===0&&(S="REST",i.ResourceURL.forEach(function(m){m.resourceType==="tile"&&(l=m.format,$.push(m.template))})),{urls:$,layer:t.layer,matrixSet:r,format:l,projection:_,requestEncoding:S,tileGrid:L,style:a,dimensions:h,wrapX:M,crossOrigin:t.crossOrigin}}export{Jn as default,ts as optionsFromCapabilities};
