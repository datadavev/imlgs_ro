var M={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function re(e){const t=lt();for(let i=0,n=e.length;i<n;++i)ft(t,e[i]);return t}function oe(e,t){return ke(e,t[0],t[1])}function ke(e,t,i){return e[0]<=t&&t<=e[2]&&e[1]<=i&&i<=e[3]}function le(e,t){const i=e[0],n=e[1],s=e[2],r=e[3],o=t[0],l=t[1];let a=M.UNKNOWN;return o<i?a=a|M.LEFT:o>s&&(a=a|M.RIGHT),l<n?a=a|M.BELOW:l>r&&(a=a|M.ABOVE),a===M.UNKNOWN&&(a=M.INTERSECTING),a}function lt(){return[1/0,1/0,-1/0,-1/0]}function bt(e,t,i,n,s){return s?(s[0]=e,s[1]=t,s[2]=i,s[3]=n,s):[e,t,i,n]}function Ke(e){return bt(1/0,1/0,-1/0,-1/0,e)}function He(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function ft(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function qe(e,t,i,n,s){for(;i<n;i+=s)Be(e,t[i],t[i+1]);return e}function Be(e,t,i){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],i),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],i)}function Ve(e,t){let i;return i=t(Lt(e)),i||(i=t(Ot(e)),i)||(i=t(Xt(e)),i)||(i=t(at(e)),i)?i:!1}function yt(e){let t=0;return Je(e)||(t=w(e)*K(e)),t}function Lt(e){return[e[0],e[1]]}function Ot(e){return[e[2],e[1]]}function ae(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function Qe(e,t){let i;if(t==="bottom-left")i=Lt(e);else if(t==="bottom-right")i=Ot(e);else if(t==="top-left")i=at(e);else if(t==="top-right")i=Xt(e);else throw new Error("Invalid corner");return i}function K(e){return e[3]-e[1]}function At(e,t,i){const n=lt();return jt(e,t)?(e[0]>t[0]?n[0]=e[0]:n[0]=t[0],e[1]>t[1]?n[1]=e[1]:n[1]=t[1],e[2]<t[2]?n[2]=e[2]:n[2]=t[2],e[3]<t[3]?n[3]=e[3]:n[3]=t[3]):Ke(n),n}function at(e){return[e[0],e[3]]}function Xt(e){return[e[2],e[3]]}function w(e){return e[2]-e[0]}function jt(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function Je(e){return e[2]<e[0]||e[3]<e[1]}function ti(e,t,i){let n=!1;const s=le(e,t),r=le(e,i);if(s===M.INTERSECTING||r===M.INTERSECTING)n=!0;else{const o=e[0],l=e[1],a=e[2],h=e[3],c=t[0],_=t[1],P=i[0],T=i[1],u=(T-_)/(P-c);let d,f;r&M.ABOVE&&!(s&M.ABOVE)&&(d=P-(T-h)/u,n=d>=o&&d<=a),!n&&r&M.RIGHT&&!(s&M.RIGHT)&&(f=T-(P-a)*u,n=f>=l&&f<=h),!n&&r&M.BELOW&&!(s&M.BELOW)&&(d=P-(T-l)/u,n=d>=o&&d<=a),!n&&r&M.LEFT&&!(s&M.LEFT)&&(f=T-(P-o)*u,n=f>=l&&f<=h)}return n}function ei(e,t){const i=t.getExtent(),n=ae(e);if(t.canWrapX()&&(n[0]<i[0]||n[0]>=i[2])){const s=w(i),r=Math.floor((n[0]-i[0])/s)*s;e[0]-=r,e[2]-=r}return e}function ii(e,t,i){if(t.canWrapX()){const n=t.getExtent();if(!isFinite(e[0])||!isFinite(e[2]))return[[n[0],e[1],n[2],e[3]]];ei(e,t);const s=w(n);if(w(e)>s,e[0]<n[0])return[[e[0]+s,e[1],n[2],e[3]],[n[0],e[1],e[2],e[3]]];if(e[2]>n[2])return[[e[0],e[1],n[2],e[3]],[n[0],e[1],e[2]-s,e[3]]]}return[e]}function zt(e,t,i){return Math.min(Math.max(e,t),i)}function ni(e){const t=e.length;for(let n=0;n<t;n++){let s=n,r=Math.abs(e[n][n]);for(let l=n+1;l<t;l++){const a=Math.abs(e[l][n]);a>r&&(r=a,s=l)}if(r===0)return null;const o=e[s];e[s]=e[n],e[n]=o;for(let l=n+1;l<t;l++){const a=-e[l][n]/e[n][n];for(let h=n;h<t+1;h++)n==h?e[l][h]=0:e[l][h]+=a*e[n][h]}}const i=new Array(t);for(let n=t-1;n>=0;n--){i[n]=e[n][t]/e[n][n];for(let s=n-1;s>=0;s--)e[s][t]-=e[s][n]*i[n]}return i}function he(e){return e*180/Math.PI}function z(e){return e*Math.PI/180}function _t(e,t){const i=e%t;return i*t<0?i+t:i}function ue(e,t){const i=Math.pow(10,t);return Math.round(e*i)/i}function pt(e,t){return Math.floor(ue(e,t))}function mt(e,t){return Math.ceil(ue(e,t))}function Yt(e,t,i){if(e>=t&&e<i)return e;const n=i-t;return((e-t)%n+n)%n+t}const ce={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let si=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||ce[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};var Wt=si;const ht=6378137,H=Math.PI*ht,ri=[-H,-H,H,H],oi=[-180,-85,180,85],Et=ht*Math.log(Math.tan(Math.PI/2));let q=class extends Wt{constructor(t){super({code:t,units:"m",extent:ri,global:!0,worldExtent:oi,getPointResolution:function(i,n){return i/Math.cosh(n[1]/ht)}})}};const ge=[new q("EPSG:3857"),new q("EPSG:102100"),new q("EPSG:102113"),new q("EPSG:900913"),new q("http://www.opengis.net/def/crs/EPSG/0/3857"),new q("http://www.opengis.net/gml/srs/epsg.xml#3857")];function li(e,t,i,n){const s=e.length;i=i>1?i:2,n=n??i,t===void 0&&(i>2?t=e.slice():t=new Array(s));for(let r=0;r<s;r+=n){t[r]=H*e[r]/180;let o=ht*Math.log(Math.tan(Math.PI*(+e[r+1]+90)/360));o>Et?o=Et:o<-Et&&(o=-Et),t[r+1]=o}return t}function ai(e,t,i,n){const s=e.length;i=i>1?i:2,n=n??i,t===void 0&&(i>2?t=e.slice():t=new Array(s));for(let r=0;r<s;r+=n)t[r]=180*e[r]/H,t[r+1]=360*Math.atan(Math.exp(e[r+1]/ht))/Math.PI-90;return t}const hi=6378137,de=[-180,-90,180,90],ui=Math.PI*hi/180;let Y=class extends Wt{constructor(t,i){super({code:t,units:"degrees",extent:de,axisOrientation:i,global:!0,metersPerUnit:ui,worldExtent:de})}};const fe=[new Y("CRS:84"),new Y("EPSG:4326","neu"),new Y("urn:ogc:def:crs:OGC:1.3:CRS84"),new Y("urn:ogc:def:crs:OGC:2:84"),new Y("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Y("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Y("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Dt={};function ci(e){return Dt[e]||Dt[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function gi(e,t){Dt[e]=t}function _e(e){for(const t in e)delete e[t]}function di(e){let t;for(t in e)return!1;return!t}let B={};function ut(e,t,i){const n=e.getCode(),s=t.getCode();n in B||(B[n]={}),B[n][s]=i}function Ut(e,t){return e in B&&t in B[e]?B[e][t]:null}const xt=.9996,G=.00669438,vt=G*G,Tt=vt*G,W=G/(1-G),pe=Math.sqrt(1-G),V=(1-pe)/(1+pe),me=V*V,Zt=me*V,Nt=Zt*V,Ee=Nt*V,xe=1-G/4-3*vt/64-5*Tt/256,fi=3*G/8+3*vt/32+45*Tt/1024,_i=15*vt/256+45*Tt/1024,pi=35*Tt/3072,mi=3/2*V-27/32*Zt+269/512*Ee,Ei=21/16*me-55/32*Nt,xi=151/96*Zt-417/128*Ee,vi=1097/512*Nt,Pt=6378137;function Ti(e,t,i){const n=e-5e5,s=(i.north?t:t-1e7)/xt/(Pt*xe),r=s+mi*Math.sin(2*s)+Ei*Math.sin(4*s)+xi*Math.sin(6*s)+vi*Math.sin(8*s),o=Math.sin(r),l=o*o,a=Math.cos(r),h=o/a,c=h*h,_=c*c,P=1-G*l,T=Math.sqrt(1-G*l),u=Pt/T,d=(1-G)/P,f=W*a**2,E=f*f,p=n/(u*xt),x=p*p,m=x*p,g=m*p,F=g*p,L=F*p,R=r-h/d*(x/2-g/24*(5+3*c+10*f-4*E-9*W))+L/720*(61+90*c+298*f+45*_-252*W-3*E);let $=(p-m/6*(1+2*c+f)+F/120*(5-2*f+28*c-3*E+8*W+24*_))/a;return $=Yt($+z(Pe(i.number)),-Math.PI,Math.PI),[he($),he(R)]}const ve=-80,Te=84,Pi=-180,Ri=180;function $i(e,t,i){e=Yt(e,Pi,Ri),t<ve?t=ve:t>Te&&(t=Te);const n=z(t),s=Math.sin(n),r=Math.cos(n),o=s/r,l=o*o,a=l*l,h=z(e),c=Pe(i.number),_=z(c),P=Pt/Math.sqrt(1-G*s**2),T=W*r**2,u=r*Yt(h-_,-Math.PI,Math.PI),d=u*u,f=d*u,E=f*u,p=E*u,x=p*u,m=Pt*(xe*n-fi*Math.sin(2*n)+_i*Math.sin(4*n)-pi*Math.sin(6*n)),g=xt*P*(u+f/6*(1-l+T)+p/120*(5-18*l+a+72*T-58*W))+5e5;let F=xt*(m+P*o*(d/2+E/24*(5-l+9*T+4*T**2)+x/720*(61-58*l+a+600*T-330*W)));return i.north||(F+=1e7),[g,F]}function Pe(e){return(e-1)*6-180+3}const Mi=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Re(e){let t=0;for(const s of Mi){const r=e.match(s);if(r){t=parseInt(r[1]);break}}if(!t)return null;let i=0,n=!1;return t>32700&&t<32761?i=t-32700:t>32600&&t<32661&&(n=!0,i=t-32600),i?{number:i,north:n}:null}function $e(e,t){return function(i,n,s,r){const o=i.length;s=s>1?s:2,r=r??s,n||(s>2?n=i.slice():n=new Array(o));for(let l=0;l<o;l+=r){const a=i[l],h=i[l+1],c=e(a,h,t);n[l]=c[0],n[l+1]=c[1]}return n}}function wi(e){return Re(e)?new Wt({code:e,units:"m"}):null}function Fi(e){const t=Re(e.getCode());return t?{forward:$e($i,t),inverse:$e(Ti,t)}:null}const Si=63710088e-1;function Me(e,t,i){i=i||Si;const n=z(e[1]),s=z(t[1]),r=(s-n)/2,o=z(t[0]-e[0])/2,l=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(s);return 2*i*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}const Ci=[Fi],Gi=[wi];function kt(e,t){if(t!==void 0){for(let i=0,n=e.length;i<n;++i)t[i]=e[i];t=t}else t=e.slice();return t}function Kt(e){gi(e.getCode(),e),ut(e,e,kt)}function Ii(e){e.forEach(Kt)}function y(e){if(typeof e!="string")return e;const t=ci(e);if(t)return t;for(const i of Gi){const n=i(e);if(n)return n}return null}function we(e,t,i,n){e=y(e);let s;const r=e.getPointResolutionFunc();if(r)s=r(t,i);else{const o=e.getUnits();if(o=="degrees"||n=="degrees")s=t;else{const l=qt(e,y("EPSG:4326"));if(!l&&o!=="degrees")s=t*e.getMetersPerUnit();else{let h=[i[0]-t/2,i[1],i[0]+t/2,i[1],i[0],i[1]-t/2,i[0],i[1]+t/2];h=l(h,h,2);const c=Me(h.slice(0,2),h.slice(2,4)),_=Me(h.slice(4,6),h.slice(6,8));s=(c+_)/2}const a=e.getMetersPerUnit();a!==void 0&&(s/=a)}}return s}function Fe(e){Ii(e),e.forEach(function(t){e.forEach(function(i){t!==i&&ut(t,i,kt)})})}function bi(e,t,i,n){e.forEach(function(s){t.forEach(function(r){ut(s,r,i),ut(r,s,n)})})}function yi(e){return function(t,i,n,s){const r=t.length;n=n!==void 0?n:2,s=s??n,i=i!==void 0?i:new Array(r);for(let o=0;o<r;o+=s){const l=e(t.slice(o,o+n)),a=l.length;for(let h=0,c=s;h<c;++h)i[o+h]=h>=a?t[o+h]:l[h]}return i}}function Ht(e,t){if(e===t)return!0;const i=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||qt(e,t)===kt)&&i}function qt(e,t){const i=e.getCode(),n=t.getCode();let s=Ut(i,n);if(s)return s;let r=null,o=null;for(const a of Ci)r||(r=a(e)),o||(o=a(t));if(!r&&!o)return null;const l="EPSG:4326";if(o)if(r)s=Bt(r.inverse,o.forward);else{const a=Ut(i,l);a&&(s=Bt(a,o.forward))}else{const a=Ut(l,n);a&&(s=Bt(r.inverse,a))}return s&&(Kt(e),Kt(t),ut(e,t,s)),s}function Bt(e,t){return function(i,n,s,r){return n=e(i,n,s,r),t(n,n,s,r)}}function Se(e,t){const i=y(e),n=y(t);return qt(i,n)}function Ce(e,t,i){const n=Se(t,i);if(!n){const s=y(t).getCode(),r=y(i).getCode();throw new Error(`No transform available between ${s} and ${r}`)}return n(e,void 0,e.length)}function Li(){Fe(ge),Fe(fe),bi(fe,ge,li,ai)}Li();function Oi(e,t,i){return i===void 0&&(i=[0,0]),i[0]=e[0]*t+.5|0,i[1]=e[1]*t+.5|0,i}function D(e,t){return Array.isArray(e)?e:(t===void 0?t=[e,e]:(t[0]=e,t[1]=e),t)}let Ge=class{constructor(t,i,n,s){this.minX=t,this.maxX=i,this.minY=n,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,i){return this.minX<=t&&t<=this.maxX&&this.minY<=i&&i<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}};function Q(e,t,i,n,s){return s!==void 0?(s.minX=e,s.maxX=t,s.minY=i,s.maxY=n,s):new Ge(e,t,i,n)}var Ai=Ge;function Xi(e,t){return e>t?1:e<t?-1:0}function ji(e,t,i){if(e[0]<=t)return 0;const n=e.length;if(t<=e[n-1])return n-1;if(typeof i=="function"){for(let s=1;s<n;++s){const r=e[s];if(r===t)return s;if(r<t)return i(t,e[s-1],r)>0?s-1:s}return n-1}if(i>0){for(let s=1;s<n;++s)if(e[s]<t)return s-1;return n-1}if(i<0){for(let s=1;s<n;++s)if(e[s]<=t)return s;return n-1}for(let s=1;s<n;++s){if(e[s]==t)return s;if(e[s]<t)return e[s-1]-t<t-e[s]?s-1:s}return n-1}function zi(e,t,i){const n=t||Xi;return e.every(function(s,r){if(r===0)return!0;const o=n(e[r-1],s);return!(o>0||o===0)})}function ct(e,t){if(!e)throw new Error(t)}function Rt(e,t,i,n,s,r){let o=0,l=e[i-n],a=e[i-n+1];for(;t<i;t+=n){const h=e[t],c=e[t+1];a<=r?c>r&&(h-l)*(r-a)-(s-l)*(c-a)>0&&o++:c<=r&&(h-l)*(r-a)-(s-l)*(c-a)<0&&o--,l=h,a=c}return o!==0}function Yi(e,t,i,n,s){let r;for(t+=n;t<i;t+=n)if(r=s(e.slice(t-n,t),e.slice(t,t+n)),r)return r;return!1}function Wi(e,t,i,n,s,r){return r=r??qe(lt(),e,t,i,n),jt(s,r)?r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:Yi(e,t,i,n,function(o,l){return ti(s,o,l)}):!1}function Di(e,t,i,n,s){return!!(Wi(e,t,i,n,s)||Rt(e,t,i,n,s[0],s[1])||Rt(e,t,i,n,s[0],s[3])||Rt(e,t,i,n,s[2],s[1])||Rt(e,t,i,n,s[2],s[3]))}function Ie(e,t,i,n){return n!==void 0?(n[0]=e,n[1]=t,n[2]=i,n):[e,t,i]}function Ui(e){return Zi(e[0],e[1],e[2])}function Zi(e,t,i){return(t<<e)+i}function Ni(e,t){const i=e[0],n=e[1],s=e[2];if(t.getMinZoom()>i||i>t.getMaxZoom())return!1;const r=t.getFullTileRange(i);return r?r.containsXY(n,s):!0}const ki=42,be=256,J=[0,0,0],X=5;let Ki=class{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,ct(zi(this.resolutions_,(s,r)=>r-s),"`resolutions` must be sorted in descending order");let i;if(!t.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!i)i=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==i){i=void 0;break}}this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,ct(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=at(n)),ct(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,ct(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:be,ct(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((s,r)=>{const o=new Ai(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(n){const l=this.getTileRangeForExtentAndZ(n,r);o.minX=Math.max(l.minX,o.minX),o.maxX=Math.min(l.maxX,o.maxX),o.minY=Math.max(l.minY,o.minY),o.maxY=Math.min(l.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,i,n){const s=this.getTileRangeForExtentAndZ(t,i);for(let r=s.minX,o=s.maxX;r<=o;++r)for(let l=s.minY,a=s.maxY;l<=a;++l)n([i,r,l])}forEachTileCoordParentTileRange(t,i,n,s){let r,o,l,a=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],l=t[2]):a=this.getTileCoordExtent(t,s);h>=this.minZoom;){if(o!==void 0&&l!==void 0?(o=Math.floor(o/2),l=Math.floor(l/2),r=Q(o,o,l,l,n)):r=this.getTileRangeForExtentAndZ(a,h,n),i(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,i,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const r=t[1]*2,o=t[2]*2;return Q(r,r+1,o,o+1,i)}const s=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,i)}return null}getTileRangeForTileCoordAndZ(t,i,n){if(i>this.maxZoom||i<this.minZoom)return null;const s=t[0],r=t[1],o=t[2];if(i===s)return Q(r,o,r,o,n);if(this.zoomFactor_){const a=Math.pow(this.zoomFactor_,i-s),h=Math.floor(r*a),c=Math.floor(o*a);if(i<s)return Q(h,h,c,c,n);const _=Math.floor(a*(r+1))-1,P=Math.floor(a*(o+1))-1;return Q(h,_,c,P,n)}const l=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,i,n)}getTileRangeForExtentAndZ(t,i,n){this.getTileCoordForXYAndZ_(t[0],t[3],i,!1,J);const s=J[1],r=J[2];this.getTileCoordForXYAndZ_(t[2],t[1],i,!0,J);const o=J[1],l=J[2];return Q(s,o,r,l,n)}getTileCoordCenter(t){const i=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=D(this.getTileSize(t[0]),this.tmpSize_);return[i[0]+(t[1]+.5)*s[0]*n,i[1]-(t[2]+.5)*s[1]*n]}getTileCoordExtent(t,i){const n=this.getOrigin(t[0]),s=this.getResolution(t[0]),r=D(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*r[0]*s,l=n[1]-(t[2]+1)*r[1]*s,a=o+r[0]*s,h=l+r[1]*s;return bt(o,l,a,h,i)}getTileCoordForCoordAndResolution(t,i,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],i,!1,n)}getTileCoordForXYAndResolution_(t,i,n,s,r){const o=this.getZForResolution(n),l=n/this.getResolution(o),a=this.getOrigin(o),h=D(this.getTileSize(o),this.tmpSize_);let c=l*(t-a[0])/n/h[0],_=l*(a[1]-i)/n/h[1];return s?(c=mt(c,X)-1,_=mt(_,X)-1):(c=pt(c,X),_=pt(_,X)),Ie(o,c,_,r)}getTileCoordForXYAndZ_(t,i,n,s,r){const o=this.getOrigin(n),l=this.getResolution(n),a=D(this.getTileSize(n),this.tmpSize_);let h=(t-o[0])/l/a[0],c=(o[1]-i)/l/a[1];return s?(h=mt(h,X)-1,c=mt(c,X)-1):(h=pt(h,X),c=pt(c,X)),Ie(n,h,c,r)}getTileCoordForCoordAndZ(t,i,n){return this.getTileCoordForXYAndZ_(t[0],t[1],i,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,i){const n=ji(this.resolutions_,t,i||0);return zt(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,i){return Di(i,0,i.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const i=this.resolutions_.length,n=new Array(i);for(let s=this.minZoom;s<i;++s)n[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=n}};var ye=Ki;function Le(e){let t=e.getDefaultTileGrid();return t||(t=Vi(e),e.setDefaultTileGrid(t)),t}function Hi(e,t,i){const n=t[0],s=e.getTileCoordCenter(t),r=Vt(i);if(!oe(r,s)){const o=w(r),l=Math.ceil((r[0]-s[0])/o);return s[0]+=o*l,e.getTileCoordForCoordAndZ(s,n)}return t}function qi(e,t,i,n){n=n!==void 0?n:"top-left";const s=Oe(e,t,i);return new ye({extent:e,origin:Qe(e,n),resolutions:s,tileSize:i})}function Bi(e){const t=e||{},i=t.extent||y("EPSG:3857").getExtent(),n={extent:i,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Oe(i,t.maxZoom,t.tileSize,t.maxResolution)};return new ye(n)}function Oe(e,t,i,n){t=t!==void 0?t:ki,i=D(i!==void 0?i:be);const s=K(e),r=w(e);n=n>0?n:Math.max(r/i[0],s/i[1]);const o=t+1,l=new Array(o);for(let a=0;a<o;++a)l[a]=n/Math.pow(2,a);return l}function Vi(e,t,i,n){const s=Vt(e);return qi(s,t,i,n)}function Vt(e){e=y(e);let t=e.getExtent();if(!t){const i=180*ce.degrees/e.getMetersPerUnit();t=bt(-i,-i,i,i)}return t}var tt={CHANGE:"change",ERROR:"error",LOAD:"load"};let Qi=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};var Ji=Qi;function Ae(){}let tn=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var Qt=tn;let en=class extends Ji{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,i){if(!t||!i)return;const n=this.listeners_||(this.listeners_={}),s=n[t]||(n[t]=[]);s.includes(i)||s.push(i)}dispatchEvent(t){const i=typeof t=="string",n=i?t:t.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const r=i?new Qt(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,l[n]=0),++o[n];let a;for(let h=0,c=s.length;h<c;++h)if("handleEvent"in s[h]?a=s[h].handleEvent(r):a=s[h].call(this,r),a===!1||r.propagationStopped){a=!1;break}if(--o[n]===0){let h=l[n];for(delete l[n];h--;)this.removeEventListener(n,Ae);delete o[n]}return a}disposeInternal(){this.listeners_&&_e(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,i){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const s=n.indexOf(i);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[s]=Ae,++this.pendingRemovals_[t]):(n.splice(s,1),n.length===0&&delete this.listeners_[t]))}};var Xe=en;function $t(e,t,i,n,s){if(s){const o=i;i=function(l){return e.removeEventListener(t,i),o.call(this,l)}}const r={target:e,type:t,listener:i};return e.addEventListener(t,i),r}function Mt(e,t,i,n){return $t(e,t,i,n,!0)}function gt(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),_e(e))}const U=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",nn=U.includes("safari")&&!U.includes("chrom");nn&&(U.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(U)),U.includes("webkit")&&U.includes("edge"),U.includes("macintosh");const sn=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,rn=typeof Image<"u"&&Image.prototype.decode;(function(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e})();function on(e,t,i){const n=e;let s=!0,r=!1,o=!1;const l=[Mt(n,tt.LOAD,function(){o=!0,r||t()})];return n.src&&rn?(r=!0,n.decode().then(function(){s&&t()}).catch(function(a){s&&(o?t():i())})):l.push(Mt(n,tt.ERROR,i)),function(){s=!1,l.forEach(gt)}}var v={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function ln(e){return Math.pow(e,3)}function je(){throw new Error("Unimplemented abstract method.")}let an=0;function dt(e){return e.ol_uid||(e.ol_uid=String(++an))}let hn=class extends Xe{constructor(t,i,n){super(),n=n||{},this.tileCoord=t,this.state=i,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(tt.CHANGE)}release(){this.setState(v.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==v.EMPTY){if(this.state!==v.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){je()}getAlpha(t,i){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=i,this.transitionStarts_[t]=n;else if(n===-1)return 1;const s=i-n+1e3/60;return s>=this.transition_?1:ln(s/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}};var ze=hn;function wt(e,t,i,n){let s;return i&&i.length?s=i.shift():sn?s=new OffscreenCanvas(e||300,t||300):s=document.createElement("canvas"),e&&(s.width=e),t&&(s.height=t),s.getContext("2d",n)}function Jt(e){const t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}let un=class extends ze{constructor(t,i,n,s,r,o){super(t,i,o),this.crossOrigin_=s,this.src_=n,this.key=n,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=v.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=v.ERROR,this.unlistenImage_(),this.image_=cn(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=v.LOADED:this.state=v.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==v.ERROR&&(this.state=v.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==v.IDLE&&(this.state=v.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=on(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};function cn(){const e=wt(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}var gn=un;let te;const et=[];function Ye(e,t,i,n,s){e.beginPath(),e.moveTo(0,0),e.lineTo(t,i),e.lineTo(n,s),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,n)+1,Math.max(i,s)),e.restore()}function ee(e,t){return Math.abs(e[t*4]-210)>2||Math.abs(e[t*4+3]-.75*255)>2}function dn(){if(te===void 0){const e=wt(6,6,et);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",Ye(e,4,5,4,0),Ye(e,4,5,0,5);const t=e.getImageData(0,0,3,3).data;te=ee(t,0)||ee(t,4)||ee(t,8),Jt(e),et.push(e.canvas)}return te}function We(e,t,i,n){const s=Ce(i,t,e);let r=we(t,n,i);const o=t.getMetersPerUnit();o!==void 0&&(r*=o);const l=e.getMetersPerUnit();l!==void 0&&(r/=l);const a=e.getExtent();if(!a||oe(a,s)){const h=we(e,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}function fn(e,t,i,n){const s=ae(i);let r=We(e,t,s,n);return(!isFinite(r)||r<=0)&&Ve(i,function(o){return r=We(e,t,o,n),isFinite(r)&&r>0}),r}function _n(e,t,i,n,s,r,o,l,a,h,c,_,P,T){const u=wt(Math.round(i*e),Math.round(i*t),et);if(_||(u.imageSmoothingEnabled=!1),a.length===0)return u.canvas;u.scale(i,i);function d(g){return Math.round(g*i)/i}u.globalCompositeOperation="lighter";const f=lt();a.forEach(function(g,F,L){He(f,g.extent)});let E;const p=i/n,x=(_?1:1+Math.pow(2,-24))/p;E=wt(Math.round(w(f)*p),Math.round(K(f)*p),et),_||(E.imageSmoothingEnabled=!1),a.forEach(function(g,F,L){if(g.image.width>0&&g.image.height>0){if(g.clipExtent){E.save();const S=(g.clipExtent[0]-f[0])*p,C=-(g.clipExtent[3]-f[3])*p,A=w(g.clipExtent)*p,Z=K(g.clipExtent)*p;E.rect(_?S:Math.round(S),_?C:Math.round(C),_?A:Math.round(S+A)-Math.round(S),_?Z:Math.round(C+Z)-Math.round(C)),E.clip()}const R=(g.extent[0]-f[0])*p,$=-(g.extent[3]-f[3])*p,I=w(g.extent)*p,b=K(g.extent)*p;E.drawImage(g.image,h,h,g.image.width-2*h,g.image.height-2*h,_?R:Math.round(R),_?$:Math.round($),_?I:Math.round(R+I)-Math.round(R),_?b:Math.round($+b)-Math.round($)),g.clipExtent&&E.restore()}});const m=at(o);return l.getTriangles().forEach(function(g,F,L){const R=g.source,$=g.target;let I=R[0][0],b=R[0][1],S=R[1][0],C=R[1][1],A=R[2][0],Z=R[2][1];const it=d(($[0][0]-m[0])/r),nt=d(-($[0][1]-m[1])/r),N=d(($[1][0]-m[0])/r),k=d(-($[1][1]-m[1])/r),St=d(($[2][0]-m[0])/r),Ct=d(-($[2][1]-m[1])/r),Gt=I,It=b;I=0,b=0,S-=Gt,C-=It,A-=Gt,Z-=It;const Ne=[[S,C,0,0,N-it],[A,Z,0,0,St-it],[0,0,S,C,k-nt],[0,0,A,Z,Ct-nt]],st=ni(Ne);if(!st)return;if(u.save(),u.beginPath(),dn()||!_){u.moveTo(N,k);const O=4,ot=it-N,se=nt-k;for(let j=0;j<O;j++)u.lineTo(N+d((j+1)*ot/O),k+d(j*se/(O-1))),j!=O-1&&u.lineTo(N+d((j+1)*ot/O),k+d((j+1)*se/(O-1)));u.lineTo(St,Ct)}else u.moveTo(N,k),u.lineTo(it,nt),u.lineTo(St,Ct);u.clip(),u.transform(st[0],st[2],st[1],st[3],it,nt),u.translate(f[0]-Gt,f[3]-It);let rt;if(E)rt=E.canvas,u.scale(x,-x);else{const O=a[0],ot=O.extent;rt=O.image,u.scale(w(ot)/rt.width,-K(ot)/rt.height)}u.drawImage(rt,0,0),u.restore()}),E&&(Jt(E),et.push(E.canvas)),c&&(u.save(),u.globalCompositeOperation="source-over",u.strokeStyle="black",u.lineWidth=1,l.getTriangles().forEach(function(g,F,L){const R=g.target,$=(R[0][0]-m[0])/r,I=-(R[0][1]-m[1])/r,b=(R[1][0]-m[0])/r,S=-(R[1][1]-m[1])/r,C=(R[2][0]-m[0])/r,A=-(R[2][1]-m[1])/r;u.beginPath(),u.moveTo(b,S),u.lineTo($,I),u.lineTo(C,A),u.closePath(),u.stroke()}),u.restore()),u.canvas}new Array(6);function pn(e,t){const i=t[0],n=t[1];return t[0]=e[0]*i+e[2]*n+e[4],t[1]=e[1]*i+e[3]*n+e[5],t}const mn=10,De=.25;class En{constructor(t,i,n,s,r,o,l){this.sourceProj_=t,this.targetProj_=i;let a={};const h=l?yi(x=>pn(l,Ce(x,this.targetProj_,this.sourceProj_))):Se(this.targetProj_,this.sourceProj_);this.transformInv_=function(x){const m=x[0]+"/"+x[1];return a[m]||(a[m]=h(x)),a[m]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&w(s)>=w(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?w(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?w(this.targetProj_.getExtent()):null;const c=at(n),_=Xt(n),P=Ot(n),T=Lt(n),u=this.transformInv_(c),d=this.transformInv_(_),f=this.transformInv_(P),E=this.transformInv_(T),p=mn+(o?Math.max(0,Math.ceil(Math.log2(yt(n)/(o*o*256*256)))):0);if(this.addQuad_(c,_,P,T,u,d,f,E,p),this.wrapsXInSource_){let x=1/0;this.triangles_.forEach(function(m,g,F){x=Math.min(x,m.source[0][0],m.source[1][0],m.source[2][0])}),this.triangles_.forEach(m=>{if(Math.max(m.source[0][0],m.source[1][0],m.source[2][0])-x>this.sourceWorldWidth_/2){const g=[[m.source[0][0],m.source[0][1]],[m.source[1][0],m.source[1][1]],[m.source[2][0],m.source[2][1]]];g[0][0]-x>this.sourceWorldWidth_/2&&(g[0][0]-=this.sourceWorldWidth_),g[1][0]-x>this.sourceWorldWidth_/2&&(g[1][0]-=this.sourceWorldWidth_),g[2][0]-x>this.sourceWorldWidth_/2&&(g[2][0]-=this.sourceWorldWidth_);const F=Math.min(g[0][0],g[1][0],g[2][0]);Math.max(g[0][0],g[1][0],g[2][0])-F<this.sourceWorldWidth_/2&&(m.source=g)}})}a={}}addTriangle_(t,i,n,s,r,o){this.triangles_.push({source:[s,r,o],target:[t,i,n]})}addQuad_(t,i,n,s,r,o,l,a,h){const c=re([r,o,l,a]),_=this.sourceWorldWidth_?w(c)/this.sourceWorldWidth_:null,P=this.sourceWorldWidth_,T=this.sourceProj_.canWrapX()&&_>.5&&_<1;let u=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const f=re([t,i,n,s]);u=w(f)/this.targetWorldWidth_>De||u}!T&&this.sourceProj_.isGlobal()&&_&&(u=_>De||u)}if(!u&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!jt(c,this.maxSourceExtent_))return;let d=0;if(!u&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(a[0])||!isFinite(a[1]))){if(h>0)u=!0;else if(d=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(l[0])||!isFinite(l[1])?2:0)+(!isFinite(a[0])||!isFinite(a[1])?1:0),d!=1&&d!=2&&d!=4&&d!=8)return}if(h>0){if(!u){const f=[(t[0]+n[0])/2,(t[1]+n[1])/2],E=this.transformInv_(f);let p;T?p=(_t(r[0],P)+_t(l[0],P))/2-_t(E[0],P):p=(r[0]+l[0])/2-E[0];const x=(r[1]+l[1])/2-E[1];u=p*p+x*x>this.errorThresholdSquared_}if(u){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const f=[(i[0]+n[0])/2,(i[1]+n[1])/2],E=this.transformInv_(f),p=[(s[0]+t[0])/2,(s[1]+t[1])/2],x=this.transformInv_(p);this.addQuad_(t,i,f,p,r,o,E,x,h-1),this.addQuad_(p,f,n,s,x,E,l,a,h-1)}else{const f=[(t[0]+i[0])/2,(t[1]+i[1])/2],E=this.transformInv_(f),p=[(n[0]+s[0])/2,(n[1]+s[1])/2],x=this.transformInv_(p);this.addQuad_(t,f,p,s,r,E,x,a,h-1),this.addQuad_(f,i,n,p,E,o,l,x,h-1)}return}}if(T){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}d&11||this.addTriangle_(t,n,s,r,l,a),d&14||this.addTriangle_(t,n,i,r,l,o),d&&(d&13||this.addTriangle_(i,s,t,o,a,r),d&7||this.addTriangle_(i,s,n,o,a,l))}calculateSourceExtent(){const t=lt();return this.triangles_.forEach(function(i,n,s){const r=i.source;ft(t,r[0]),ft(t,r[1]),ft(t,r[2])}),t}getTriangles(){return this.triangles_}}var xn=En;const vn=.5;let Tn=class extends ze{constructor(t,i,n,s,r,o,l,a,h,c,_,P){super(r,v.IDLE,P),this.renderEdges_=_!==void 0?_:!1,this.pixelRatio_=l,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=i,this.targetTileGrid_=s,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const T=s.getTileCoordExtent(this.wrappedTileCoord_),u=this.targetTileGrid_.getExtent();let d=this.sourceTileGrid_.getExtent();const f=u?At(T,u):T;if(yt(f)===0){this.state=v.EMPTY;return}const E=t.getExtent();E&&(d?d=At(d,E):d=E);const p=s.getResolution(this.wrappedTileCoord_[0]),x=fn(t,n,f,p);if(!isFinite(x)||x<=0){this.state=v.EMPTY;return}const m=c!==void 0?c:vn;if(this.triangulation_=new xn(t,n,f,d,x*m,p),this.triangulation_.getTriangles().length===0){this.state=v.EMPTY;return}this.sourceZ_=i.getZForResolution(x);let g=this.triangulation_.calculateSourceExtent();if(d&&(t.canWrapX()?(g[1]=zt(g[1],d[1],d[3]),g[3]=zt(g[3],d[1],d[3])):g=At(g,d)),!yt(g))this.state=v.EMPTY;else{let F=0,L=0;t.canWrapX()&&(F=w(E),L=Math.floor((g[0]-E[0])/F)),ii(g.slice(),t).forEach(R=>{const $=i.getTileRangeForExtentAndZ(R,this.sourceZ_);for(let I=$.minX;I<=$.maxX;I++)for(let b=$.minY;b<=$.maxY;b++){const S=h(this.sourceZ_,I,b,l);if(S){const C=L*F;this.sourceTiles_.push({tile:S,offset:C})}}++L}),this.sourceTiles_.length===0&&(this.state=v.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(i=>{const n=i.tile;if(n&&n.getState()==v.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);s[0]+=i.offset,s[2]+=i.offset;const r=this.clipExtent_?.slice();r&&(r[0]+=i.offset,r[2]+=i.offset),t.push({extent:s,clipExtent:r,image:n.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=v.ERROR;else{const i=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(i),s=typeof n=="number"?n:n[0],r=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(i),l=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=_n(s,r,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),o,a,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=v.LOADED}this.changed()}load(){if(this.state==v.IDLE){this.state=v.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:i})=>{const n=i.getState();if(n==v.IDLE||n==v.LOADING){t++;const s=$t(i,tt.CHANGE,r=>{const o=i.getState();(o==v.LOADED||o==v.ERROR||o==v.EMPTY)&&(gt(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:i},n,s){i.getState()==v.IDLE&&i.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(gt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Jt(this.canvas_.getContext("2d")),et.push(this.canvas_),this.canvas_=null),super.release()}};var Pn=Tn;const Rn=/\{z\}/g,$n=/\{x\}/g,Mn=/\{y\}/g,wn=/\{-y\}/g;function Fn(e,t,i,n,s){return e.replace(Rn,t.toString()).replace($n,i.toString()).replace(Mn,n.toString()).replace(wn,function(){if(s===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(s-n).toString()})}function Sn(e){const t=[];let i=/\{([a-z])-([a-z])\}/.exec(e);if(i){const n=i[1].charCodeAt(0),s=i[2].charCodeAt(0);let r;for(r=n;r<=s;++r)t.push(e.replace(i[0],String.fromCharCode(r)));return t}if(i=/\{(\d+)-(\d+)\}/.exec(e),i){const n=parseInt(i[2],10);for(let s=parseInt(i[1],10);s<=n;s++)t.push(e.replace(i[0],s.toString()));return t}return t.push(e),t}function Cn(e,t){return function(i,n,s){if(!i)return;let r;const o=i[0];if(t){const l=t.getFullTileRange(o);l&&(r=l.getHeight()-1)}return Fn(e,o,i[1],i[2],r)}}function Gn(e,t){const i=e.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=Cn(e[s],t);return In(n)}function In(e){return e.length===1?e[0]:function(t,i,n){if(!t)return;const s=Ui(t),r=_t(s,e.length);return e[r](t,i,n)}}var bn={PROPERTYCHANGE:"propertychange"};let Ft=class extends Xe{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(tt.CHANGE)}getRevision(){return this.revision_}onInternal(t,i){if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=$t(this,t[r],i);return s}return $t(this,t,i)}onceInternal(t,i){let n;if(Array.isArray(t)){const s=t.length;n=new Array(s);for(let r=0;r<s;++r)n[r]=Mt(this,t[r],i)}else n=Mt(this,t,i);return i.ol_key=n,n}unInternal(t,i){const n=i.ol_key;if(n)yn(n);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],i);else this.removeEventListener(t,i)}};Ft.prototype.on,Ft.prototype.once,Ft.prototype.un;function yn(e){if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)gt(e[t]);else gt(e)}var Ln=Ft;class Ue extends Qt{constructor(t,i,n){super(t),this.key=i,this.oldValue=n}}class On extends Ln{constructor(t){super(),this.on,this.once,this.un,dt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let i;return this.values_&&this.values_.hasOwnProperty(t)&&(i=this.values_[t]),i}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,i){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new Ue(n,t,i)),n=bn.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new Ue(n,t,i))}addChangeListener(t,i){this.addEventListener(`change:${t}`,i)}removeChangeListener(t,i){this.removeEventListener(`change:${t}`,i)}set(t,i,n){const s=this.values_||(this.values_={});if(n)s[t]=i;else{const r=s[t];s[t]=i,r!==i&&this.notify(t,r)}}setProperties(t,i){for(const n in t)this.set(n,t[n],i)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,i){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],di(this.values_)&&(this.values_=null),i||this.notify(t,n)}}}var An=On;class Xn extends An{constructor(t){super(),this.projection=y(t.projection),this.attributions_=Ze(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const i=this;this.viewPromise_=new Promise(function(n,s){i.viewResolver=n,i.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Ze(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Ze(e){return e?typeof e=="function"?e:(Array.isArray(e)||(e=[e]),t=>e):null}var jn=Xn;class zn extends jn{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const i=[256,256];this.tileGrid&&D(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),i),this.tmpSize=[0,0],this.key_=t.key||dt(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const i=t?this.getTileGridForProjection(t):this.tileGrid;return i?i.getResolutions():null}getTile(t,i,n,s,r){return je()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Le(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,i,n){const s=this.getTileGridForProjection(n),r=this.getTilePixelRatio(i),o=D(s.getTileSize(t),this.tmpSize);return r==1?o:Oi(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,i){const n=i!==void 0?i:this.getProjection(),s=i!==void 0?this.getTileGridForProjection(n):this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=Hi(s,t,n)),Ni(t,s)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class Yn extends Qt{constructor(t,i){super(t),this.tile=i}}var Wn=zn,ie={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class ne extends Wn{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===ne.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const i=t.target,n=dt(i),s=i.getState();let r;s==v.LOADING?(this.tileLoadingKeys_[n]=!0,r=ie.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],r=s==v.ERROR?ie.TILELOADERROR:s==v.LOADED?ie.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new Yn(r,i))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,i){this.tileUrlFunction=t,typeof i<"u"?this.setKey(i):this.changed()}setUrl(t){const i=Sn(t);this.urls=i,this.setUrls(i)}setUrls(t){this.urls=t;const i=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Gn(t,this.tileGrid),i):this.setKey(i)}tileUrlFunction(t,i,n){}}var Dn=ne;class Un extends Dn{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Zn,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:gn,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!Ht(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){const i=this.getProjection();if(this.tileGrid&&(!i||Ht(i,t)))return this.tileGrid;const n=dt(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Le(t)),this.tileGridForProjection[n]}createTile_(t,i,n,s,r,o){const l=[t,i,n],a=this.getTileCoordForTileUrlFunction(l,r),h=a?this.tileUrlFunction(a,s,r):void 0,c=new this.tileClass(l,h!==void 0?v.IDLE:v.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(tt.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,i,n,s,r){const o=this.getProjection();if(!o||!r||Ht(o,r))return this.getTileInternal(t,i,n,s,o||r);const l=[t,i,n],a=this.getKey(),h=this.getTileGridForProjection(o),c=this.getTileGridForProjection(r),_=this.getTileCoordForTileUrlFunction(l,r),P=new Pn(o,h,r,c,l,_,this.getTilePixelRatio(s),this.getGutter(),(T,u,d,f)=>this.getTileInternal(T,u,d,f,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return P.key=a,P}getTileInternal(t,i,n,s,r){const o=this.getKey();return this.createTile_(t,i,n,s,r,o)}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,i){const n=y(t);if(n){const s=dt(n);s in this.tileGridForProjection||(this.tileGridForProjection[s]=i)}}}function Zn(e,t){e.getImage().src=t}var Nn=Un;class kn extends Nn{constructor(t){t=t||{};const i=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:Bi({extent:Vt(i),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:i,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}var Kn=kn;export{Kn as default};
