import Zi from"../../rbush@4.0.1/index.6a49fb2b.js";import"../../earcut@3.0.1/index.8b5fc318.js";var Q={ANIMATING:0,INTERACTING:1};function j(r,t){if(!r)throw new Error(t)}function be(r){for(const t in r)delete r[t]}function jr(r){let t;for(t in r)return!1;return!t}function tt(r,t,e,n,i){if(i){const o=e;e=function(a){return r.removeEventListener(t,e),o.call(n??this,a)}}else n&&n!==r&&(e=e.bind(n));const s={target:r,type:t,listener:e};return r.addEventListener(t,e),s}function Wr(r,t,e,n){return tt(r,t,e,n,!0)}function Rt(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),be(r))}var B={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Hi(r,t,e){return[r[0]-t,r[1]-t,r[2]+t,r[3]+t]}function Vr(r,t,e){let n,i;return t<r[0]?n=r[0]-t:r[2]<t?n=t-r[2]:n=0,e<r[1]?i=r[1]-e:r[3]<e?i=e-r[3]:i=0,n*n+i*i}function qi(r,t,e){return r[0]<=t&&t<=r[2]&&r[1]<=e&&e<=r[3]}function Xr(r,t){const e=r[0],n=r[1],i=r[2],s=r[3],o=t[0],a=t[1];let l=B.UNKNOWN;return o<e?l=l|B.LEFT:o>i&&(l=l|B.RIGHT),a<n?l=l|B.BELOW:a>s&&(l=l|B.ABOVE),l===B.UNKNOWN&&(l=B.INTERSECTING),l}function Yt(){return[1/0,1/0,-1/0,-1/0]}function we(r,t,e,n,i){return i?(i[0]=r,i[1]=t,i[2]=e,i[3]=n,i):[r,t,e,n]}function Zr(r){return we(1/0,1/0,-1/0,-1/0,r)}function Hr(r,t){const e=r[0],n=r[1];return we(e,n,e,n,t)}function Ce(r,t,e,n,i){const s=Zr(i);return qr(s,r,t,e,n)}function Yi(r,t){return r[0]==t[0]&&r[2]==t[2]&&r[1]==t[1]&&r[3]==t[3]}function qr(r,t,e,n,i){for(;e<n;e+=i)Ki(r,t[e],t[e+1]);return r}function Ki(r,t,e){r[0]=Math.min(r[0],t),r[1]=Math.min(r[1],e),r[2]=Math.max(r[2],t),r[3]=Math.max(r[3],e)}function Ji(r,t){let e;return e=t(Qi(r)),e||(e=t(ts(r)),e)||(e=t(is(r)),e)||(e=t(ns(r)),e)?e:!1}function Qi(r){return[r[0],r[1]]}function ts(r){return[r[2],r[1]]}function Nt(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function es(r,t,e,n,i){const[s,o,a,l,h,c,u,f]=rs(r,t,e,n);return we(Math.min(s,a,h,u),Math.min(o,l,c,f),Math.max(s,a,h,u),Math.max(o,l,c,f),i)}function rs(r,t,e,n){const i=t*n[0]/2,s=t*n[1]/2,o=Math.cos(e),a=Math.sin(e),l=i*o,h=i*a,c=s*o,u=s*a,f=r[0],g=r[1];return[f-l+u,g-h-c,f-l-u,g-h+c,f+l-u,g+h+c,f+l+u,g+h-c,f-l+u,g-h-c]}function pt(r){return r[3]-r[1]}function ns(r){return[r[0],r[3]]}function is(r){return[r[2],r[3]]}function Kt(r){return r[2]-r[0]}function Yr(r,t){return r[0]<=t[2]&&r[2]>=t[0]&&r[1]<=t[3]&&r[3]>=t[1]}function Kr(r){return r[2]<r[0]||r[3]<r[1]}function ss(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r}function os(r,t,e){let n=!1;const i=Xr(r,t),s=Xr(r,e);if(i===B.INTERSECTING||s===B.INTERSECTING)n=!0;else{const o=r[0],a=r[1],l=r[2],h=r[3],c=t[0],u=t[1],f=e[0],g=e[1],p=(g-u)/(f-c);let _,m;s&B.ABOVE&&!(i&B.ABOVE)&&(_=f-(g-h)/p,n=_>=o&&_<=l),!n&&s&B.RIGHT&&!(i&B.RIGHT)&&(m=g-(f-l)*p,n=m>=a&&m<=h),!n&&s&B.BELOW&&!(i&B.BELOW)&&(_=f-(g-a)/p,n=_>=o&&_<=l),!n&&s&B.LEFT&&!(i&B.LEFT)&&(m=g-(f-o)*p,n=m>=a&&m<=h)}return n}const _t=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",as=_t.includes("safari")&&!_t.includes("chrom"),ls=as&&(_t.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(_t));_t.includes("webkit")&&_t.includes("edge"),_t.includes("macintosh");const hs=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,cs=typeof Image<"u"&&Image.prototype.decode;(function(){let r=!1;try{const t=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return r})();function ut(r,t,e,n){let i;return hs?i=new OffscreenCanvas(r||300,t||300):i=document.createElement("canvas"),r&&(i.width=r),t&&(i.height=t),i.getContext("2d",n)}let Pe;function Jr(){return Pe||(Pe=ut(1,1)),Pe}function z(r,t,e){return Math.min(Math.max(r,t),e)}function us(r,t,e,n,i,s){const o=i-e,a=s-n;if(o!==0||a!==0){const l=((r-e)*o+(t-n)*a)/(o*o+a*a);l>1?(e=i,n=s):l>0&&(e+=o*l,n+=a*l)}return St(r,t,e,n)}function St(r,t,e,n){const i=e-r,s=n-t;return i*i+s*s}function Qr(r){return r*180/Math.PI}function kt(r){return r*Math.PI/180}function tn(r,t){const e=r%t;return e*t<0?e+t:e}function en(r,t,e){return r+e*(t-r)}function fs(r,t){const e=Math.pow(10,t);return Math.round(r*e)/e}function Ae(r,t,e){if(r>=t&&r<e)return r;const n=e-t;return((r-t)%n+n)%n+t}const Ie=[NaN,NaN,NaN,0];let Me;function ds(){return Me||(Me=ut(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),Me}const gs=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,ps=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,_s=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,ms=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function Jt(r,t){return r.endsWith("%")?Number(r.substring(0,r.length-1))/t:Number(r)}function Bt(r){throw new Error('failed to parse "'+r+'" as color')}function rn(r){if(r.toLowerCase().startsWith("rgb")){const s=r.match(ps)||r.match(gs)||r.match(_s);if(s){const o=s[4],a=100/255;return[z(Jt(s[1],a)+.5|0,0,255),z(Jt(s[2],a)+.5|0,0,255),z(Jt(s[3],a)+.5|0,0,255),o!==void 0?z(Jt(o,100),0,1):1]}Bt(r)}if(r.startsWith("#")){if(ms.test(r)){const s=r.substring(1),o=s.length<=4?1:2,a=[0,0,0,255];for(let l=0,h=s.length;l<h;l+=o){let c=parseInt(s.substring(l,l+o),16);o===1&&(c+=c<<4),a[l/o]=c}return a[3]=a[3]/255,a}Bt(r)}const t=ds();t.fillStyle="#abcdef";let e=t.fillStyle;t.fillStyle=r,t.fillStyle===e&&(t.fillStyle="#fedcba",e=t.fillStyle,t.fillStyle=r,t.fillStyle===e&&Bt(r));const n=t.fillStyle;if(n.startsWith("#")||n.startsWith("rgba"))return rn(n);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);const i=Array.from(t.getImageData(0,0,1,1).data);return i[3]=fs(i[3]/255,3),i}function xs(r){return typeof r=="string"?r:Be(r)}const ys=1024,zt={};let Fe=0;function vs(r){if(r.length===4)return r;const t=r.slice();return t[3]=1,t}function Oe(r){return r>.0031308?Math.pow(r,1/2.4)*269.025-14.025:r*3294.6}function De(r){return r>.2068965?Math.pow(r,3):(r-4/29)*(108/841)}function Le(r){return r>10.314724?Math.pow((r+14.025)/269.025,2.4):r/3294.6}function Ne(r){return r>.0088564?Math.pow(r,1/3):r/(108/841)+4/29}function nn(r){const t=Le(r[0]),e=Le(r[1]),n=Le(r[2]),i=Ne(t*.222488403+e*.716873169+n*.06060791),s=500*(Ne(t*.452247074+e*.399439023+n*.148375274)-i),o=200*(i-Ne(t*.016863605+e*.117638439+n*.865350722)),a=Math.atan2(o,s)*(180/Math.PI);return[116*i-16,Math.sqrt(s*s+o*o),a<0?a+360:a,r[3]]}function Es(r){const t=(r[0]+16)/116,e=r[1],n=r[2]*Math.PI/180,i=De(t),s=De(t+e/500*Math.cos(n)),o=De(t-e/200*Math.sin(n)),a=Oe(s*3.021973625-i*1.617392459-o*.404875592),l=Oe(s*-.943766287+i*1.916279586+o*.027607165),h=Oe(s*.069407491-i*.22898585+o*1.159737864);return[z(a+.5|0,0,255),z(l+.5|0,0,255),z(h+.5|0,0,255),r[3]]}function ke(r){if(r==="none")return Ie;if(zt.hasOwnProperty(r))return zt[r];if(Fe>=ys){let e=0;for(const n in zt)e++&3||(delete zt[n],--Fe)}const t=rn(r);t.length!==4&&Bt(r);for(const e of t)isNaN(e)&&Bt(r);return zt[r]=t,++Fe,t}function ot(r){return Array.isArray(r)?r:ke(r)}function Be(r){let t=r[0];t!=(t|0)&&(t=t+.5|0);let e=r[1];e!=(e|0)&&(e=e+.5|0);let n=r[2];n!=(n|0)&&(n=n+.5|0);const i=r[3]===void 0?1:Math.round(r[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+i+")"}function $s(r,t,e){let n,i;e=e||ze;let s=0,o=r.length,a=!1;for(;s<o;)n=s+(o-s>>1),i=+e(r[n],t),i<0?s=n+1:(o=n,a=!i);return a?s:~s}function ze(r,t){return r>t?1:r<t?-1:0}function sn(r,t,e){if(r[0]<=t)return 0;const n=r.length;if(t<=r[n-1])return n-1;if(typeof e=="function"){for(let i=1;i<n;++i){const s=r[i];if(s===t)return i;if(s<t)return e(t,r[i-1],s)>0?i-1:i}return n-1}if(e>0){for(let i=1;i<n;++i)if(r[i]<t)return i-1;return n-1}if(e<0){for(let i=1;i<n;++i)if(r[i]<=t)return i;return n-1}for(let i=1;i<n;++i){if(r[i]==t)return i;if(r[i]<t)return r[i-1]-t<t-r[i]?i-1:i}return n-1}function on(r,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let i=0;i<n;i++)r[r.length]=e[i]}function an(r,t){const e=r.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(r[n]!==t[n])return!1;return!0}function mt(r,t){return Array.isArray(r)?r:(t===void 0?t=[r,r]:(t[0]=r,t[1]=r),t)}let xt=0;const N=1<<xt++,x=1<<xt++,O=1<<xt++,A=1<<xt++,W=1<<xt++,q=1<<xt++,Qt=Math.pow(2,xt)-1,Ue={[N]:"boolean",[x]:"number",[O]:"string",[A]:"color",[W]:"number[]",[q]:"size"},Rs=Object.keys(Ue).map(Number).sort(ze);function Ss(r){return r in Ue}function Tt(r){const t=[];for(const e of Rs)Ut(r,e)&&t.push(Ue[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Ut(r,t){return(r&t)===t}function ft(r,t){return r===t}let D=class{constructor(t,e){if(!Ss(t))throw new Error(`literal expressions must have a specific type, got ${Tt(t)}`);this.type=t,this.value=e}},ln=class{constructor(t,e,...n){this.type=t,this.operator=e,this.args=n}};function te(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function k(r,t,e){switch(typeof r){case"boolean":{if(ft(t,O))return new D(O,r?"true":"false");if(!Ut(t,N))throw new Error(`got a boolean, but expected ${Tt(t)}`);return new D(N,r)}case"number":{if(ft(t,q))return new D(q,mt(r));if(ft(t,N))return new D(N,!!r);if(ft(t,O))return new D(O,r.toString());if(!Ut(t,x))throw new Error(`got a number, but expected ${Tt(t)}`);return new D(x,r)}case"string":{if(ft(t,A))return new D(A,ke(r));if(ft(t,N))return new D(N,!!r);if(!Ut(t,O))throw new Error(`got a string, but expected ${Tt(t)}`);return new D(O,r)}}if(!Array.isArray(r))throw new Error("expression must be an array or a primitive value");if(r.length===0)throw new Error("empty expression");if(typeof r[0]=="string")return Ds(r,t,e);for(const n of r)if(typeof n!="number")throw new Error("expected an array of numbers");if(ft(t,q)){if(r.length!==2)throw new Error(`expected an array of two values for a size, got ${r.length}`);return new D(q,r)}if(ft(t,A)){if(r.length===3)return new D(A,[...r,1]);if(r.length===4)return new D(A,r);throw new Error(`expected an array of 3 or 4 values for a color, got ${r.length}`)}if(!Ut(t,W))throw new Error(`got an array of numbers, but expected ${Tt(t)}`);return new D(W,r)}const d={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},Ts={[d.Get]:y($(1,1/0),hn),[d.Var]:y($(1,1),bs),[d.Has]:y($(1,1/0),hn),[d.Id]:y(ws,bt),[d.Concat]:y($(2,1/0),b(O)),[d.GeometryType]:y(Cs,bt),[d.LineMetric]:y(bt),[d.Resolution]:y(Ge,bt),[d.Zoom]:y(Ge,bt),[d.Time]:y(Ge,bt),[d.Any]:y($(2,1/0),b(N)),[d.All]:y($(2,1/0),b(N)),[d.Not]:y($(1,1),b(N)),[d.Equal]:y($(2,2),b(Qt)),[d.NotEqual]:y($(2,2),b(Qt)),[d.GreaterThan]:y($(2,2),b(x)),[d.GreaterThanOrEqualTo]:y($(2,2),b(x)),[d.LessThan]:y($(2,2),b(x)),[d.LessThanOrEqualTo]:y($(2,2),b(x)),[d.Multiply]:y($(2,1/0),cn),[d.Coalesce]:y($(2,1/0),cn),[d.Divide]:y($(2,2),b(x)),[d.Add]:y($(2,1/0),b(x)),[d.Subtract]:y($(2,2),b(x)),[d.Clamp]:y($(3,3),b(x)),[d.Mod]:y($(2,2),b(x)),[d.Pow]:y($(2,2),b(x)),[d.Abs]:y($(1,1),b(x)),[d.Floor]:y($(1,1),b(x)),[d.Ceil]:y($(1,1),b(x)),[d.Round]:y($(1,1),b(x)),[d.Sin]:y($(1,1),b(x)),[d.Cos]:y($(1,1),b(x)),[d.Atan]:y($(1,2),b(x)),[d.Sqrt]:y($(1,1),b(x)),[d.Match]:y($(4,1/0),un,As),[d.Between]:y($(3,3),b(x)),[d.Interpolate]:y($(6,1/0),un,Is),[d.Case]:y($(3,1/0),Ps,Ms),[d.In]:y($(2,2),Fs),[d.Number]:y($(1,1/0),b(Qt)),[d.String]:y($(1,1/0),b(Qt)),[d.Array]:y($(1,1/0),b(x)),[d.Color]:y($(1,4),b(x)),[d.Band]:y($(1,3),b(x)),[d.Palette]:y($(2,2),Os),[d.ToString]:y($(1,1),b(N|x|O|A))};function hn(r,t,e){const n=r.length-1,i=new Array(n);for(let s=0;s<n;++s){const o=r[s+1];switch(typeof o){case"number":{i[s]=new D(x,o);break}case"string":{i[s]=new D(O,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}s===0&&e.properties.add(String(o))}return i}function bs(r,t,e){const n=r[1];if(typeof n!="string")throw new Error("expected a string argument for var operation");return e.variables.add(n),[new D(O,n)]}function ws(r,t,e){e.featureId=!0}function Cs(r,t,e){e.geometryType=!0}function Ge(r,t,e){e.mapState=!0}function bt(r,t,e){const n=r[0];if(r.length!==1)throw new Error(`expected no arguments for ${n} operation`);return[]}function $(r,t){return function(e,n,i){const s=e[0],o=e.length-1;if(r===t){if(o!==r){const a=r===1?"":"s";throw new Error(`expected ${r} argument${a} for ${s}, got ${o}`)}}else if(o<r||o>t){const a=t===1/0?`${r} or more`:`${r} to ${t}`;throw new Error(`expected ${a} arguments for ${s}, got ${o}`)}}}function cn(r,t,e){const n=r.length-1,i=new Array(n);for(let s=0;s<n;++s){const o=k(r[s+1],t,e);i[s]=o}return i}function b(r){return function(t,e,n){const i=t.length-1,s=new Array(i);for(let o=0;o<i;++o){const a=k(t[o+1],r,n);s[o]=a}return s}}function Ps(r,t,e){const n=r[0],i=r.length-1;if(i%2===0)throw new Error(`expected an odd number of arguments for ${n}, got ${i} instead`)}function un(r,t,e){const n=r[0],i=r.length-1;if(i%2===1)throw new Error(`expected an even number of arguments for operation ${n}, got ${i} instead`)}function As(r,t,e){const n=r.length-1,i=O|x|N,s=k(r[1],i,e),o=k(r[r.length-1],t,e),a=new Array(n-2);for(let l=0;l<n-2;l+=2){try{const h=k(r[l+2],s.type,e);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+1} of match expression: ${h.message}`)}try{const h=k(r[l+3],o.type,e);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+2} of match expression: ${h.message}`)}}return[s,...a,o]}function Is(r,t,e){const n=r[1];let i;switch(n[0]){case"linear":i=1;break;case"exponential":const l=n[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);i=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(n)}`)}const s=new D(x,i);let o;try{o=k(r[2],x,e)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const a=new Array(r.length-3);for(let l=0;l<a.length;l+=2){try{const h=k(r[l+3],x,e);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${h.message}`)}try{const h=k(r[l+4],t,e);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${h.message}`)}}return[s,o,...a]}function Ms(r,t,e){const n=k(r[r.length-1],t,e),i=new Array(r.length-1);for(let s=0;s<i.length-1;s+=2){try{const o=k(r[s+1],N,e);i[s]=o}catch(o){throw new Error(`failed to parse argument ${s} of case expression: ${o.message}`)}try{const o=k(r[s+2],n.type,e);i[s+1]=o}catch(o){throw new Error(`failed to parse argument ${s+1} of case expression: ${o.message}`)}}return i[i.length-1]=n,i}function Fs(r,t,e){let n=r[2];if(!Array.isArray(n))throw new Error('the second argument for the "in" operator must be an array');let i;if(typeof n[0]=="string"){if(n[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(n[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');n=n[1],i=O}else i=x;const s=new Array(n.length);for(let o=0;o<s.length;o++)try{const a=k(n[o],i,e);s[o]=a}catch(a){throw new Error(`failed to parse haystack item ${o} for "in" expression: ${a.message}`)}return[k(r[1],i,e),...s]}function Os(r,t,e){let n;try{n=k(r[1],x,e)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const i=r[2];if(!Array.isArray(i))throw new Error("the second argument of palette must be an array");const s=new Array(i.length);for(let o=0;o<s.length;o++){let a;try{a=k(i[o],A,e)}catch(l){throw new Error(`failed to parse color at index ${o} in palette expression: ${l.message}`)}if(!(a instanceof D))throw new Error(`the palette color at index ${o} must be a literal value`);s[o]=a}return[n,...s]}function y(...r){return function(t,e,n){const i=t[0];let s;for(let o=0;o<r.length;o++){const a=r[o](t,e,n);if(o==r.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");s=a}}return new ln(e,i,...s)}}function Ds(r,t,e){const n=r[0],i=Ts[n];if(!i)throw new Error(`unknown operator: ${n}`);return i(r,t,e)}function ee(r){if(!r)return"";const t=r.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return ee(r.getGeometries()[0]);default:return""}}function je(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function et(r,t,e){const n=k(r,t,e);return Y(n)}function Y(r,t){if(r instanceof D){if(r.type===A&&typeof r.value=="string"){const n=ke(r.value);return function(){return n}}return function(){return r.value}}const e=r.operator;switch(e){case d.Number:case d.String:case d.Coalesce:return Ls(r);case d.Get:case d.Var:case d.Has:return Ns(r);case d.Id:return n=>n.featureId;case d.GeometryType:return n=>n.geometryType;case d.Concat:{const n=r.args.map(i=>Y(i));return i=>"".concat(...n.map(s=>s(i).toString()))}case d.Resolution:return n=>n.resolution;case d.Any:case d.All:case d.Between:case d.In:case d.Not:return Bs(r);case d.Equal:case d.NotEqual:case d.LessThan:case d.LessThanOrEqualTo:case d.GreaterThan:case d.GreaterThanOrEqualTo:return ks(r);case d.Multiply:case d.Divide:case d.Add:case d.Subtract:case d.Clamp:case d.Mod:case d.Pow:case d.Abs:case d.Floor:case d.Ceil:case d.Round:case d.Sin:case d.Cos:case d.Atan:case d.Sqrt:return zs(r);case d.Case:return Us(r);case d.Match:return Gs(r);case d.Interpolate:return js(r);case d.ToString:return Ws(r);default:throw new Error(`Unsupported operator ${e}`)}}function Ls(r,t){const e=r.operator,n=r.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=Y(r.args[s]);switch(e){case d.Coalesce:return s=>{for(let o=0;o<n;++o){const a=i[o](s);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case d.Number:case d.String:return s=>{for(let o=0;o<n;++o){const a=i[o](s);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function Ns(r,t){const e=r.args[0].value;switch(r.operator){case d.Get:return n=>{const i=r.args;let s=n.properties[e];for(let o=1,a=i.length;o<a;++o){const l=i[o].value;s=s[l]}return s};case d.Var:return n=>n.variables[e];case d.Has:return n=>{const i=r.args;if(!(e in n.properties))return!1;let s=n.properties[e];for(let o=1,a=i.length;o<a;++o){const l=i[o].value;if(!s||!Object.hasOwn(s,l))return!1;s=s[l]}return!0};default:throw new Error(`Unsupported accessor operator ${r.operator}`)}}function ks(r,t){const e=r.operator,n=Y(r.args[0]),i=Y(r.args[1]);switch(e){case d.Equal:return s=>n(s)===i(s);case d.NotEqual:return s=>n(s)!==i(s);case d.LessThan:return s=>n(s)<i(s);case d.LessThanOrEqualTo:return s=>n(s)<=i(s);case d.GreaterThan:return s=>n(s)>i(s);case d.GreaterThanOrEqualTo:return s=>n(s)>=i(s);default:throw new Error(`Unsupported comparison operator ${e}`)}}function Bs(r,t){const e=r.operator,n=r.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=Y(r.args[s]);switch(e){case d.Any:return s=>{for(let o=0;o<n;++o)if(i[o](s))return!0;return!1};case d.All:return s=>{for(let o=0;o<n;++o)if(!i[o](s))return!1;return!0};case d.Between:return s=>{const o=i[0](s),a=i[1](s),l=i[2](s);return o>=a&&o<=l};case d.In:return s=>{const o=i[0](s);for(let a=1;a<n;++a)if(o===i[a](s))return!0;return!1};case d.Not:return s=>!i[0](s);default:throw new Error(`Unsupported logical operator ${e}`)}}function zs(r,t){const e=r.operator,n=r.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=Y(r.args[s]);switch(e){case d.Multiply:return s=>{let o=1;for(let a=0;a<n;++a)o*=i[a](s);return o};case d.Divide:return s=>i[0](s)/i[1](s);case d.Add:return s=>{let o=0;for(let a=0;a<n;++a)o+=i[a](s);return o};case d.Subtract:return s=>i[0](s)-i[1](s);case d.Clamp:return s=>{const o=i[0](s),a=i[1](s);if(o<a)return a;const l=i[2](s);return o>l?l:o};case d.Mod:return s=>i[0](s)%i[1](s);case d.Pow:return s=>Math.pow(i[0](s),i[1](s));case d.Abs:return s=>Math.abs(i[0](s));case d.Floor:return s=>Math.floor(i[0](s));case d.Ceil:return s=>Math.ceil(i[0](s));case d.Round:return s=>Math.round(i[0](s));case d.Sin:return s=>Math.sin(i[0](s));case d.Cos:return s=>Math.cos(i[0](s));case d.Atan:return n===2?s=>Math.atan2(i[0](s),i[1](s)):s=>Math.atan(i[0](s));case d.Sqrt:return s=>Math.sqrt(i[0](s));default:throw new Error(`Unsupported numeric operator ${e}`)}}function Us(r,t){const e=r.args.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=Y(r.args[i]);return i=>{for(let s=0;s<e-1;s+=2)if(n[s](i))return n[s+1](i);return n[e-1](i)}}function Gs(r,t){const e=r.args.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=Y(r.args[i]);return i=>{const s=n[0](i);for(let o=1;o<e-1;o+=2)if(s===n[o](i))return n[o+1](i);return n[e-1](i)}}function js(r,t){const e=r.args.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=Y(r.args[i]);return i=>{const s=n[0](i),o=n[1](i);let a,l;for(let h=2;h<e;h+=2){const c=n[h](i);let u=n[h+1](i);const f=Array.isArray(u);if(f&&(u=vs(u)),c>=o)return h===2?u:f?Vs(s,o,a,l,c,u):Gt(s,o,a,l,c,u);a=c,l=u}return l}}function Ws(r,t){const e=r.operator,n=r.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=Y(r.args[s]);switch(e){case d.ToString:return s=>{const o=i[0](s);return r.args[0].type===A?Be(o):o.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function Gt(r,t,e,n,i,s){const o=i-e;if(o===0)return n;const a=t-e,l=r===1?a/o:(Math.pow(r,a)-1)/(Math.pow(r,o)-1);return n+l*(s-n)}function Vs(r,t,e,n,i,s){if(i-e===0)return n;const o=nn(n),a=nn(s);let l=a[2]-o[2];l>180?l-=360:l<-180&&(l+=360);const h=[Gt(r,t,e,o[0],i,a[0]),Gt(r,t,e,o[1],i,a[1]),o[2]+Gt(r,t,e,0,i,l),Gt(r,t,e,n[3],i,s[3])];return Es(h)}var S={IDLE:0,LOADING:1,LOADED:2,ERROR:3},at={CHANGE:"change"};let Xs=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};var fn=Xs;function We(){}function dn(r){let t,e,n;return function(){const i=Array.prototype.slice.call(arguments);return(!e||this!==n||!an(i,e))&&(n=this,e=i,t=r.apply(this,arguments)),t}}let Zs=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var Ve=Zs;let Hs=class extends fn{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),i=n[t]||(n[t]=[]);i.includes(e)||i.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,i=this.listeners_&&this.listeners_[n];if(!i)return;const s=e?new Ve(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=i.length;h<c;++h)if("handleEvent"in i[h]?l=i[h].handleEvent(s):l=i[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,We);delete o[n]}return l}disposeInternal(){this.listeners_&&be(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const i=n.indexOf(e);i!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[i]=We,++this.pendingRemovals_[t]):(n.splice(i,1),n.length===0&&delete this.listeners_[t]))}};var gn=Hs;function qs(r,t){return new Promise((e,n)=>{function i(){o(),e(r)}function s(){o(),n(new Error("Image load error"))}function o(){r.removeEventListener("load",i),r.removeEventListener("error",s)}r.addEventListener("load",i),r.addEventListener("error",s)})}function Ys(r,t){return t&&(r.src=t),r.src&&cs?new Promise((e,n)=>r.decode().then(()=>e(r)).catch(i=>r.complete&&r.width?e(r):n(i))):qs(r)}let Ks=class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const i=Xe(t,e,n);return i in this.cache_?this.cache_[i]:null}getPattern(t,e,n){const i=Xe(t,e,n);return i in this.patternCache_?this.patternCache_[i]:null}set(t,e,n,i,s){const o=Xe(t,e,n),a=o in this.cache_;this.cache_[o]=i,s&&(i.getImageState()===S.IDLE&&i.load(),i.getImageState()===S.LOADING?i.ready().then(()=>{this.patternCache_[o]=Jr().createPattern(i.getImage(1),"repeat")}):this.patternCache_[o]=Jr().createPattern(i.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};function Xe(r,t,e){const n=e?ot(e):"null";return t+":"+r+":"+n}const rt=new Ks;let jt=null,pn=class extends gn{constructor(t,e,n,i,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=s,this.imageState_=i===void 0?S.IDLE:i,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===S.LOADED){jt||(jt=ut(1,1,void 0,{willReadFrequently:!0})),jt.drawImage(this.image_,0,0);try{jt.getImageData(0,0,1,1),this.tainted_=!1}catch{jt=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(at.CHANGE)}handleImageError_(){this.imageState_=S.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=S.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=ut(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===S.IDLE){this.image_||this.initializeImage_(),this.imageState_=S.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Ys(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==S.LOADED)return;const e=this.image_,n=ut(Math.ceil(e.width*t),Math.ceil(e.height*t)),i=n.canvas;n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=xs(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=i}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===S.LOADED||this.imageState_===S.ERROR)t();else{const e=()=>{(this.imageState_===S.LOADED||this.imageState_===S.ERROR)&&(this.removeEventListener(at.CHANGE,e),t())};this.addEventListener(at.CHANGE,e)}})),this.ready_}};function Ze(r,t,e,n,i,s){let o=t===void 0?void 0:rt.get(t,e,i);return o||(o=new pn(r,r&&"src"in r?r.src||void 0:t,e,n,i),rt.set(t,e,i,o,s)),s&&o&&!rt.getPattern(t,e,i)&&rt.set(t,e,i,o,s),o}var Js=pn;function _n(r){return r?Array.isArray(r)?Be(r):typeof r=="object"&&"src"in r?Qs(r):r:null}function Qs(r){if(!r.offset||!r.size)return rt.getPattern(r.src,"anonymous",r.color);const t=r.src+":"+r.offset,e=rt.getPattern(t,void 0,r.color);if(e)return e;const n=rt.get(r.src,"anonymous",null);if(n.getImageState()!==S.LOADED)return null;const i=ut(r.size[0],r.size[1]);return i.drawImage(n.getImage(1),r.offset[0],r.offset[1],r.size[0],r.size[1],0,0,r.size[0],r.size[1]),Ze(i.canvas,t,void 0,S.LOADED,r.color,!0),rt.getPattern(t,void 0,r.color)}var to={PROPERTYCHANGE:"propertychange"};let re=class extends gn{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(at.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=tt(this,t[s],e);return i}return tt(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const i=t.length;n=new Array(i);for(let s=0;s<i;++s)n[s]=Wr(this,t[s],e)}else n=Wr(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)eo(n);else if(Array.isArray(t))for(let i=0,s=t.length;i<s;++i)this.removeEventListener(t[i],e);else this.removeEventListener(t,e)}};re.prototype.on,re.prototype.once,re.prototype.un;function eo(r){if(Array.isArray(r))for(let t=0,e=r.length;t<e;++t)Rt(r[t]);else Rt(r)}var mn=re;function C(){throw new Error("Unimplemented abstract method.")}let ro=0;function L(r){return r.ol_uid||(r.ol_uid=String(++ro))}let xn=class extends Ve{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}},no=class extends mn{constructor(t){super(),this.on,this.once,this.un,L(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new xn(n,t,e)),n=to.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new xn(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const i=this.values_||(this.values_={});if(n)i[t]=e;else{const s=i[t];i[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],jr(this.values_)&&(this.values_=null),e||this.notify(t,n)}}};var ne=no;const yn="#000",vn="round",En="round",io=10,so="#000",oo=1;new ne;let ao=class ki{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=mt(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new ki({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return C()}getImage(t){return C()}getHitDetectionImage(){return C()}getPixelRatio(t){return 1}getImageState(){return C()}getImageSize(){return C()}getOrigin(){return C()}getSize(){return C()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=mt(t)}listenImageChange(t){C()}load(){C()}unlistenImageChange(t){C()}ready(){return Promise.resolve()}};var $n=ao;let lo=class Bi extends $n{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?S.LOADING:S.LOADED,this.imageState_===S.LOADING&&this.ready().then(()=>this.imageState_=S.LOADED),this.render()}clone(){const t=this.getScale(),e=new Bi({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){const e=this.fill_?.getKey(),n=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${e}`+Object.values(this.renderOptions_).join(",");let i=rt.get(n,null,null)?.getImage(1);if(!i){const s=this.renderOptions_,o=Math.ceil(s.size*t),a=ut(o,o);this.draw_(s,a,t),i=a.canvas,rt.set(n,null,null,new Js(i,void 0,null,S.LOADED,null))}return i}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let i=this.radius,s=this.radius2_===void 0?i:this.radius2_;if(i<s){const F=i;i=s,s=F}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),h=Math.sqrt(s*s-l*l),c=i-h,u=Math.sqrt(l*l+c*c),f=u/l;if(t==="miter"&&f<=n)return f*e;const g=e/2/f,p=e/2*(c/u),_=Math.sqrt((i+g)*(i+g)+p*p)-i;if(this.radius2_===void 0||t==="bevel")return _*2;const m=i*Math.sin(a),R=Math.sqrt(i*i-m*m),v=s-R,U=Math.sqrt(m*m+v*v)/m;if(U<=n){const F=U*e/2-s-i;return 2*Math.max(_,F)}return _*2}createRenderOptions(){let t=vn,e=En,n=0,i=null,s=0,o,a=0;this.stroke_&&(o=_n(this.stroke_.getColor()??so),a=this.stroke_.getWidth()??oo,i=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??En,t=this.stroke_.getLineCap()??vn,n=this.stroke_.getMiterLimit()??io);const l=this.calculateLineJoinSize_(e,a,n),h=Math.max(this.radius,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:t,lineDash:i,lineDashOffset:s,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let i=this.fill_.getColor();i===null&&(i=yn),e.fillStyle=_n(i),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let n=this.fill_.getColor(),i=0;typeof n=="string"&&(n=ot(n)),n===null?i=1:Array.isArray(n)&&(i=n.length===4?n[3]:1),i===0&&(e=ut(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const n=this.radius;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const i=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=s+a*o,h=a%2===0?n:i;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=yn,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}};var Rn=lo;let ho=class zi extends Rn{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new zi({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}};var Sn=ho;let co=class Ui{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Ui({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=Ze(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===S.IDLE&&e.load(),e.getImageState()===S.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?L(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:ot(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}};var He=co;function Tn(r,t,e,n){return e!==void 0&&n!==void 0?[e/r,n/t]:e!==void 0?e/r:n!==void 0?n/t:1}let uo=class Gi extends $n{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,i=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:n,scale:i,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;j(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||L(o)),j(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),j(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=S.IDLE:o!==void 0&&("complete"in o?o.complete?l=o.src?S.LOADED:S.IDLE:l=S.LOADING:l=S.LOADED),this.color_=t.color!==void 0?ot(t.color):null,this.iconImage_=Ze(o,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const f=()=>{if(this.unlistenImageChange(f),!this.initialOptions_)return;const g=this.iconImage_.getSize();this.setScale(Tn(g[0],g[1],t.width,t.height))};this.listenImageChange(f);return}}h!==void 0&&this.setScale(Tn(h,c,t.width,t.height))}}clone(){let t,e,n;return this.initialOptions_?(e=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Gi({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const i=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!i)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=i[0]),this.anchorYUnits_=="fraction"&&(t[1]*=i[1])}if(this.anchorOrigin_!="top-left"){if(!i)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+i[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+i[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==S.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==S.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(at.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(at.CHANGE,t)}ready(){return this.iconImage_.ready()}};var fo=uo;let go=class ji{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new ji({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}};var bn=go;let wn=class Wi{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Pn,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Wi({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Pn,this.geometry_=t}setZIndex(t){this.zIndex_=t}};function po(r){let t;if(typeof r=="function")t=r;else{let e;Array.isArray(r)?e=r:(j(typeof r.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[r]),t=function(){return e}}return t}let qe=null;function Cn(r,t){if(!qe){const e=new He({color:"rgba(255,255,255,0.4)"}),n=new bn({color:"#3399CC",width:1.25});qe=[new wn({image:new Sn({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return qe}function Pn(r){return r.getGeometry()}var ie=wn;const _o="#333";let mo=class Vi{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=mt(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new He({color:_o}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Vi({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=mt(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}};var xo=mo;function yo(r){return!0}function vo(r){const t=te(),e=Eo(r,t),n=je();return function(i,s){if(n.properties=i.getPropertiesInternal(),n.resolution=s,t.featureId){const o=i.getId();o!==void 0?n.featureId=o:n.featureId=null}return t.geometryType&&(n.geometryType=ee(i.getGeometry())),e(n)}}function An(r){const t=te(),e=r.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=Ye(r[o],t);const i=je(),s=new Array(e);return function(o,a){if(i.properties=o.getPropertiesInternal(),i.resolution=a,t.featureId){const h=o.getId();h!==void 0?i.featureId=h:i.featureId=null}let l=0;for(let h=0;h<e;++h){const c=n[h](i);c&&(s[l]=c,l+=1)}return s.length=l,s}}function Eo(r,t){const e=r.length,n=new Array(e);for(let i=0;i<e;++i){const s=r[i],o="filter"in s?et(s.filter,N,t):yo;let a;if(Array.isArray(s.style)){const l=s.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=Ye(s.style[h],t)}else a=[Ye(s.style,t)];n[i]={filter:o,styles:a}}return function(i){const s=[];let o=!1;for(let a=0;a<e;++a){const l=n[a].filter;if(l(i)&&!(r[a].else&&o)){o=!0;for(const h of n[a].styles){const c=h(i);c&&s.push(c)}}}return s}}function Ye(r,t){const e=Wt(r,"",t),n=Vt(r,"",t),i=$o(r,t),s=Ro(r,t),o=X(r,"z-index",t);if(!e&&!n&&!i&&!s&&!jr(r))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(r));const a=new ie;return function(l){let h=!0;if(e){const c=e(l);c&&(h=!1),a.setFill(c)}if(n){const c=n(l);c&&(h=!1),a.setStroke(c)}if(i){const c=i(l);c&&(h=!1),a.setText(c)}if(s){const c=s(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function Wt(r,t,e){let n;if(t+"fill-pattern-src"in r)n=wo(r,t+"fill-",e);else{if(r[t+"fill-color"]==="none")return s=>null;n=Ke(r,t+"fill-color",e)}if(!n)return null;const i=new He;return function(s){const o=n(s);return o===Ie?null:(i.setColor(o),i)}}function Vt(r,t,e){const n=X(r,t+"stroke-width",e),i=Ke(r,t+"stroke-color",e);if(!n&&!i)return null;const s=lt(r,t+"stroke-line-cap",e),o=lt(r,t+"stroke-line-join",e),a=In(r,t+"stroke-line-dash",e),l=X(r,t+"stroke-line-dash-offset",e),h=X(r,t+"stroke-miter-limit",e),c=new bn;return function(u){if(i){const f=i(u);if(f===Ie)return null;c.setColor(f)}if(n&&c.setWidth(n(u)),s){const f=s(u);if(f!=="butt"&&f!=="round"&&f!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(f)}if(o){const f=o(u);if(f!=="bevel"&&f!=="round"&&f!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(f)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function $o(r,t){const e="text-",n=lt(r,e+"value",t);if(!n)return null;const i=Wt(r,e,t),s=Wt(r,e+"background-",t),o=Vt(r,e,t),a=Vt(r,e+"background-",t),l=lt(r,e+"font",t),h=X(r,e+"max-angle",t),c=X(r,e+"offset-x",t),u=X(r,e+"offset-y",t),f=wt(r,e+"overflow",t),g=lt(r,e+"placement",t),p=X(r,e+"repeat",t),_=oe(r,e+"scale",t),m=wt(r,e+"rotate-with-view",t),R=X(r,e+"rotation",t),v=lt(r,e+"align",t),U=lt(r,e+"justify",t),F=lt(r,e+"baseline",t),Z=wt(r,e+"keep-upright",t),G=In(r,e+"padding",t),J=le(r,e+"declutter-mode"),I=new xo({declutterMode:J});return function(P){if(I.setText(n(P)),i&&I.setFill(i(P)),s&&I.setBackgroundFill(s(P)),o&&I.setStroke(o(P)),a&&I.setBackgroundStroke(a(P)),l&&I.setFont(l(P)),h&&I.setMaxAngle(h(P)),c&&I.setOffsetX(c(P)),u&&I.setOffsetY(u(P)),f&&I.setOverflow(f(P)),g){const M=g(P);if(M!=="point"&&M!=="line")throw new Error("Expected point or line for text-placement");I.setPlacement(M)}if(p&&I.setRepeat(p(P)),_&&I.setScale(_(P)),m&&I.setRotateWithView(m(P)),R&&I.setRotation(R(P)),v){const M=v(P);if(M!=="left"&&M!=="center"&&M!=="right"&&M!=="end"&&M!=="start")throw new Error("Expected left, right, center, start, or end for text-align");I.setTextAlign(M)}if(U){const M=U(P);if(M!=="left"&&M!=="right"&&M!=="center")throw new Error("Expected left, right, or center for text-justify");I.setJustify(M)}if(F){const M=F(P);if(M!=="bottom"&&M!=="top"&&M!=="middle"&&M!=="alphabetic"&&M!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");I.setTextBaseline(M)}return G&&I.setPadding(G(P)),Z&&I.setKeepUpright(Z(P)),I}}function Ro(r,t){return"icon-src"in r?So(r,t):"shape-points"in r?To(r,t):"circle-radius"in r?bo(r,t):null}function So(r,t){const e="icon-",n=e+"src",i=Dn(r[n],n),s=se(r,e+"anchor",t),o=oe(r,e+"scale",t),a=X(r,e+"opacity",t),l=se(r,e+"displacement",t),h=X(r,e+"rotation",t),c=wt(r,e+"rotate-with-view",t),u=Fn(r,e+"anchor-origin"),f=On(r,e+"anchor-x-units"),g=On(r,e+"anchor-y-units"),p=Io(r,e+"color"),_=Po(r,e+"cross-origin"),m=Ao(r,e+"offset"),R=Fn(r,e+"offset-origin"),v=ae(r,e+"width"),U=ae(r,e+"height"),F=Co(r,e+"size"),Z=le(r,e+"declutter-mode"),G=new fo({src:i,anchorOrigin:u,anchorXUnits:f,anchorYUnits:g,color:p,crossOrigin:_,offset:m,offsetOrigin:R,height:U,width:v,size:F,declutterMode:Z});return function(J){return a&&G.setOpacity(a(J)),l&&G.setDisplacement(l(J)),h&&G.setRotation(h(J)),c&&G.setRotateWithView(c(J)),o&&G.setScale(o(J)),s&&G.setAnchor(s(J)),G}}function To(r,t){const e="shape-",n=e+"points",i=e+"radius",s=Je(r[n],n),o=Je(r[i],i),a=Wt(r,e,t),l=Vt(r,e,t),h=oe(r,e+"scale",t),c=se(r,e+"displacement",t),u=X(r,e+"rotation",t),f=wt(r,e+"rotate-with-view",t),g=ae(r,e+"radius2"),p=ae(r,e+"angle"),_=le(r,e+"declutter-mode"),m=new Rn({points:s,radius:o,radius2:g,angle:p,declutterMode:_});return function(R){return a&&m.setFill(a(R)),l&&m.setStroke(l(R)),c&&m.setDisplacement(c(R)),u&&m.setRotation(u(R)),f&&m.setRotateWithView(f(R)),h&&m.setScale(h(R)),m}}function bo(r,t){const e="circle-",n=Wt(r,e,t),i=Vt(r,e,t),s=X(r,e+"radius",t),o=oe(r,e+"scale",t),a=se(r,e+"displacement",t),l=X(r,e+"rotation",t),h=wt(r,e+"rotate-with-view",t),c=le(r,e+"declutter-mode"),u=new Sn({radius:5,declutterMode:c});return function(f){return s&&u.setRadius(s(f)),n&&u.setFill(n(f)),i&&u.setStroke(i(f)),a&&u.setDisplacement(a(f)),l&&u.setRotation(l(f)),h&&u.setRotateWithView(h(f)),o&&u.setScale(o(f)),u}}function X(r,t,e){if(!(t in r))return;const n=et(r[t],x,e);return function(i){return Je(n(i),t)}}function lt(r,t,e){if(!(t in r))return null;const n=et(r[t],O,e);return function(i){return Dn(n(i),t)}}function wo(r,t,e){const n=lt(r,t+"pattern-src",e),i=Mn(r,t+"pattern-offset",e),s=Mn(r,t+"pattern-size",e),o=Ke(r,t+"color",e);return function(a){return{src:n(a),offset:i&&i(a),size:s&&s(a),color:o&&o(a)}}}function wt(r,t,e){if(!(t in r))return null;const n=et(r[t],N,e);return function(i){const s=n(i);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${t}`);return s}}function Ke(r,t,e){if(!(t in r))return null;const n=et(r[t],A,e);return function(i){return Ln(n(i),t)}}function In(r,t,e){if(!(t in r))return null;const n=et(r[t],W,e);return function(i){return Xt(n(i),t)}}function se(r,t,e){if(!(t in r))return null;const n=et(r[t],W,e);return function(i){const s=Xt(n(i),t);if(s.length!==2)throw new Error(`Expected two numbers for ${t}`);return s}}function Mn(r,t,e){if(!(t in r))return null;const n=et(r[t],W,e);return function(i){return Nn(n(i),t)}}function oe(r,t,e){if(!(t in r))return null;const n=et(r[t],W|x,e);return function(i){return Mo(n(i),t)}}function ae(r,t){const e=r[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function Co(r,t){const e=r[t];if(e!==void 0){if(typeof e=="number")return mt(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function Po(r,t){const e=r[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function Fn(r,t){const e=r[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function On(r,t){const e=r[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function Ao(r,t){const e=r[t];if(e!==void 0)return Xt(e,t)}function le(r,t){const e=r[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Io(r,t){const e=r[t];if(e!==void 0)return Ln(e,t)}function Xt(r,t){if(!Array.isArray(r))throw new Error(`Expected an array for ${t}`);const e=r.length;for(let n=0;n<e;++n)if(typeof r[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return r}function Dn(r,t){if(typeof r!="string")throw new Error(`Expected a string for ${t}`);return r}function Je(r,t){if(typeof r!="number")throw new Error(`Expected a number for ${t}`);return r}function Ln(r,t){if(typeof r=="string")return r;const e=Xt(r,t),n=e.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function Nn(r,t){const e=Xt(r,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function Mo(r,t){return typeof r=="number"?r:Nn(r,t)}var K={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function kn(r,t,e){return function(n,i,s,o,a){if(!n)return;if(!i&&!t)return n;const l=t?0:s[0]*i,h=t?0:s[1]*i,c=a?a[0]:0,u=a?a[1]:0;let f=r[0]+l/2+c,g=r[2]-l/2+c,p=r[1]+h/2+u,_=r[3]-h/2+u;f>g&&(f=(g+f)/2,g=f),p>_&&(p=(_+p)/2,_=p);let m=z(n[0],f,g),R=z(n[1],p,_);if(o&&e&&i){const v=30*i;m+=-v*Math.log(1+Math.max(0,f-n[0])/v)+v*Math.log(1+Math.max(0,n[0]-g)/v),R+=-v*Math.log(1+Math.max(0,p-n[1])/v)+v*Math.log(1+Math.max(0,n[1]-_)/v)}return[m,R]}}function Fo(r){return r}function Oo(r,t){return r[0]+=+t[0],r[1]+=+t[1],r}function he(r,t){let e=!0;for(let n=r.length-1;n>=0;--n)if(r[n]!=t[n]){e=!1;break}return e}function Do(r,t){const e=Math.cos(t),n=Math.sin(t),i=r[0]*e-r[1]*n,s=r[1]*e+r[0]*n;return r[0]=i,r[1]=s,r}function Lo(r){return Math.pow(r,3)}function No(r){return 1-Lo(1-r)}function ko(r){return 3*r*r-2*r*r*r}function Bo(...r){console.warn(...r)}const Bn={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let zo=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Bn[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};var Qe=zo;const Zt=6378137,Ct=Math.PI*Zt,Uo=[-Ct,-Ct,Ct,Ct],Go=[-180,-85,180,85],ce=Zt*Math.log(Math.tan(Math.PI/2));let Pt=class extends Qe{constructor(t){super({code:t,units:"m",extent:Uo,global:!0,worldExtent:Go,getPointResolution:function(e,n){return e/Math.cosh(n[1]/Zt)}})}};const zn=[new Pt("EPSG:3857"),new Pt("EPSG:102100"),new Pt("EPSG:102113"),new Pt("EPSG:900913"),new Pt("http://www.opengis.net/def/crs/EPSG/0/3857"),new Pt("http://www.opengis.net/gml/srs/epsg.xml#3857")];function jo(r,t,e,n){const i=r.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=r.slice():t=new Array(i));for(let s=0;s<i;s+=n){t[s]=Ct*r[s]/180;let o=Zt*Math.log(Math.tan(Math.PI*(+r[s+1]+90)/360));o>ce?o=ce:o<-ce&&(o=-ce),t[s+1]=o}return t}function Wo(r,t,e,n){const i=r.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=r.slice():t=new Array(i));for(let s=0;s<i;s+=n)t[s]=180*r[s]/Ct,t[s+1]=360*Math.atan(Math.exp(r[s+1]/Zt))/Math.PI-90;return t}const Vo=6378137,Un=[-180,-90,180,90],Xo=Math.PI*Vo/180;let yt=class extends Qe{constructor(t,e){super({code:t,units:"degrees",extent:Un,axisOrientation:e,global:!0,metersPerUnit:Xo,worldExtent:Un})}};const Gn=[new yt("CRS:84"),new yt("EPSG:4326","neu"),new yt("urn:ogc:def:crs:OGC:1.3:CRS84"),new yt("urn:ogc:def:crs:OGC:2:84"),new yt("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new yt("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new yt("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let tr={};function Zo(r){return tr[r]||tr[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Ho(r,t){tr[r]=t}let At={};function Ht(r,t,e){const n=r.getCode(),i=t.getCode();n in At||(At[n]={}),At[n][i]=e}function er(r,t){return r in At&&t in At[r]?At[r][t]:null}const ue=.9996,H=.00669438,fe=H*H,de=fe*H,vt=H/(1-H),jn=Math.sqrt(1-H),It=(1-jn)/(1+jn),Wn=It*It,rr=Wn*It,nr=rr*It,Vn=nr*It,Xn=1-H/4-3*fe/64-5*de/256,qo=3*H/8+3*fe/32+45*de/1024,Yo=15*fe/256+45*de/1024,Ko=35*de/3072,Jo=3/2*It-27/32*rr+269/512*Vn,Qo=21/16*Wn-55/32*nr,ta=151/96*rr-417/128*Vn,ea=1097/512*nr,ge=6378137;function ra(r,t,e){const n=r-5e5,i=(e.north?t:t-1e7)/ue/(ge*Xn),s=i+Jo*Math.sin(2*i)+Qo*Math.sin(4*i)+ta*Math.sin(6*i)+ea*Math.sin(8*i),o=Math.sin(s),a=o*o,l=Math.cos(s),h=o/l,c=h*h,u=c*c,f=1-H*a,g=Math.sqrt(1-H*a),p=ge/g,_=(1-H)/f,m=vt*l**2,R=m*m,v=n/(p*ue),U=v*v,F=U*v,Z=F*v,G=Z*v,J=G*v,I=s-h/_*(U/2-Z/24*(5+3*c+10*m-4*R-9*vt))+J/720*(61+90*c+298*m+45*u-252*vt-3*R);let P=(v-F/6*(1+2*c+m)+G/120*(5-2*m+28*c-3*R+8*vt+24*u))/l;return P=Ae(P+kt(qn(e.number)),-Math.PI,Math.PI),[Qr(P),Qr(I)]}const Zn=-80,Hn=84,na=-180,ia=180;function sa(r,t,e){r=Ae(r,na,ia),t<Zn?t=Zn:t>Hn&&(t=Hn);const n=kt(t),i=Math.sin(n),s=Math.cos(n),o=i/s,a=o*o,l=a*a,h=kt(r),c=qn(e.number),u=kt(c),f=ge/Math.sqrt(1-H*i**2),g=vt*s**2,p=s*Ae(h-u,-Math.PI,Math.PI),_=p*p,m=_*p,R=m*p,v=R*p,U=v*p,F=ge*(Xn*n-qo*Math.sin(2*n)+Yo*Math.sin(4*n)-Ko*Math.sin(6*n)),Z=ue*f*(p+m/6*(1-a+g)+v/120*(5-18*a+l+72*g-58*vt))+5e5;let G=ue*(F+f*o*(_/2+R/24*(5-a+9*g+4*g**2)+U/720*(61-58*a+l+600*g-330*vt)));return e.north||(G+=1e7),[Z,G]}function qn(r){return(r-1)*6-180+3}const oa=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Yn(r){let t=0;for(const i of oa){const s=r.match(i);if(s){t=parseInt(s[1]);break}}if(!t)return null;let e=0,n=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(n=!0,e=t-32600),e?{number:e,north:n}:null}function Kn(r,t){return function(e,n,i,s){const o=e.length;i=i>1?i:2,s=s??i,n||(i>2?n=e.slice():n=new Array(o));for(let a=0;a<o;a+=s){const l=e[a],h=e[a+1],c=r(l,h,t);n[a]=c[0],n[a+1]=c[1]}return n}}function aa(r){return Yn(r)?new Qe({code:r,units:"m"}):null}function la(r){const t=Yn(r.getCode());return t?{forward:Kn(sa,t),inverse:Kn(ra,t)}:null}const ha=[la],ca=[aa];let ir=!0;function ua(r){ir=!1}function Jn(r,t){if(t!==void 0){for(let e=0,n=r.length;e<n;++e)t[e]=r[e];t=t}else t=r.slice();return t}function sr(r){Ho(r.getCode(),r),Ht(r,r,Jn)}function fa(r){r.forEach(sr)}function Mt(r){if(typeof r!="string")return r;const t=Zo(r);if(t)return t;for(const e of ca){const n=e(r);if(n)return n}return null}function Qn(r){fa(r),r.forEach(function(t){r.forEach(function(e){t!==e&&Ht(t,e,Jn)})})}function da(r,t,e,n){r.forEach(function(i){t.forEach(function(s){Ht(i,s,e),Ht(s,i,n)})})}function or(r,t){return r?typeof r=="string"?Mt(r):r:Mt(t)}function ga(r,t){const e=r.getCode(),n=t.getCode();let i=er(e,n);if(i)return i;let s=null,o=null;for(const l of ha)s||(s=l(r)),o||(o=l(t));if(!s&&!o)return null;const a="EPSG:4326";if(o)if(s)i=ar(s.inverse,o.forward);else{const l=er(e,a);l&&(i=ar(l,o.forward))}else{const l=er(a,n);l&&(i=ar(s.inverse,l))}return i&&(sr(r),sr(t),Ht(r,t,i)),i}function ar(r,t){return function(e,n,i,s){return n=r(e,n,i,s),t(n,n,i,s)}}function ti(r,t){const e=Mt(r),n=Mt(t);return ga(e,n)}function ei(r,t){return r}function dt(r,t){return ir&&!he(r,[0,0])&&r[0]>=-180&&r[0]<=180&&r[1]>=-90&&r[1]<=90&&(ir=!1,Bo("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),r}function pa(r,t){return r}function pe(r,t){return r}function _a(){Qn(zn),Qn(Gn),da(Gn,zn,jo,Wo)}_a();const ma=new Array(6);function nt(){return[1,0,0,1,0,0]}function ri(r,t){const e=r[0],n=r[1],i=r[2],s=r[3],o=r[4],a=r[5],l=t[0],h=t[1],c=t[2],u=t[3],f=t[4],g=t[5];return r[0]=e*l+i*h,r[1]=n*l+s*h,r[2]=e*c+i*u,r[3]=n*c+s*u,r[4]=e*f+i*g+o,r[5]=n*f+s*g+a,r}function xa(r,t,e,n,i,s,o){return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r[4]=s,r[5]=o,r}function ya(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function lr(r,t){const e=t[0],n=t[1];return t[0]=r[0]*e+r[2]*n+r[4],t[1]=r[1]*e+r[3]*n+r[5],t}function va(r,t,e){return ri(r,xa(ma,1,0,0,1,t,e))}function _e(r,t,e,n,i,s,o,a){const l=Math.sin(s),h=Math.cos(s);return r[0]=n*h,r[1]=i*l,r[2]=-n*l,r[3]=i*h,r[4]=o*n*h-a*n*l+t,r[5]=o*i*l+a*i*h+e,r}function hr(r,t){const e=Ea(t);j(e!==0,"Transformation matrix cannot be inverted");const n=t[0],i=t[1],s=t[2],o=t[3],a=t[4],l=t[5];return r[0]=o/e,r[1]=-i/e,r[2]=-s/e,r[3]=n/e,r[4]=(s*l-o*a)/e,r[5]=-(n*l-i*a)/e,r}function Ea(r){return r[0]*r[3]-r[1]*r[2]}function me(r,t,e,n,i,s,o){s=s||[],o=o||2;let a=0;for(let l=t;l<e;l+=n){const h=r[l],c=r[l+1];s[a++]=i[0]*h+i[2]*c+i[4],s[a++]=i[1]*h+i[3]*c+i[5];for(let u=2;u<o;u++)s[a++]=r[l+u]}return s&&s.length!=a&&(s.length=a),s}function $a(r,t,e,n,i,s,o){o=o||[];const a=Math.cos(i),l=Math.sin(i),h=s[0],c=s[1];let u=0;for(let f=t;f<e;f+=n){const g=r[f]-h,p=r[f+1]-c;o[u++]=h+g*a-p*l,o[u++]=c+g*l+p*a;for(let _=f+2;_<f+n;++_)o[u++]=r[_]}return o&&o.length!=u&&(o.length=u),o}function Ra(r,t,e,n,i,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<e;u+=n){const f=r[u]-l,g=r[u+1]-h;a[c++]=l+i*f,a[c++]=h+s*g;for(let p=u+2;p<u+n;++p)a[c++]=r[p]}return a&&a.length!=c&&(a.length=c),a}function Sa(r,t,e,n,i,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=n){o[a++]=r[l]+i,o[a++]=r[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=r[h]}return o&&o.length!=a&&(o.length=a),o}const ni=nt(),Ta=[NaN,NaN];let ba=class extends ne{constructor(){super(),this.extent_=Yt(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=dn((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const i=this.clone();return i.applyTransform(n),i.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return C()}closestPointXY(t,e,n,i){return C()}containsXY(t,e){return this.closestPointXY(t,e,Ta,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return C()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Zr(e),this.extentRevision_=this.getRevision()}return ss(this.extent_,t)}rotate(t,e){C()}scale(t,e,n){C()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return C()}getType(){return C()}applyTransform(t){C()}intersectsExtent(t){return C()}translate(t,e){C()}transform(t,e){const n=Mt(t),i=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=pt(h)/pt(l);_e(ni,h[0],h[3],c,-c,0,0,0);const u=me(s,0,s.length,a,ni,o),f=ti(n,e);return f?f(u,u,a):u}:ti(n,e);return this.applyTransform(i),this}};var wa=ba;let Ca=class extends wa{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Ce(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return C()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=ii(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){C()}setLayout(t,e,n){let i;if(t)i=ii(t);else{for(let s=0;s<n;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}i=e.length,t=Pa(i)}this.layout=t,this.stride=i}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const i=this.getStride();$a(n,0,n.length,i,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=Nt(this.getExtent()));const i=this.getFlatCoordinates();if(i){const s=this.getStride();Ra(i,0,i.length,s,t,e,n,i),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const i=this.getStride();Sa(n,0,n.length,i,t,e,n),this.changed()}}};function Pa(r){let t;return r==2?t="XY":r==3?t="XYZ":r==4&&(t="XYZM"),t}function ii(r){let t;return r=="XY"?t=2:r=="XYZ"||r=="XYM"?t=3:r=="XYZM"&&(t=4),t}var cr=Ca;function si(r,t,e,n){let i=0;const s=r[e-n],o=r[e-n+1];let a=0,l=0;for(;t<e;t+=n){const h=r[t]-s,c=r[t+1]-o;i+=l*h-a*c,a=h,l=c}return i/2}function Aa(r,t,e,n){let i=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];i+=si(r,t,a,n),t=a}return i}function oi(r,t,e,n,i,s,o){const a=r[t],l=r[t+1],h=r[e]-a,c=r[e+1]-l;let u;if(h===0&&c===0)u=t;else{const f=((i-a)*h+(s-l)*c)/(h*h+c*c);if(f>1)u=e;else if(f>0){for(let g=0;g<n;++g)o[g]=en(r[t+g],r[e+g],f);o.length=n;return}else u=t}for(let f=0;f<n;++f)o[f]=r[u+f];o.length=n}function ai(r,t,e,n,i){let s=r[t],o=r[t+1];for(t+=n;t<e;t+=n){const a=r[t],l=r[t+1],h=St(s,o,a,l);h>i&&(i=h),s=a,o=l}return i}function Ia(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];i=ai(r,t,a,n,i),t=a}return i}function li(r,t,e,n,i,s,o,a,l,h,c){if(t==e)return h;let u,f;if(i===0){if(f=St(o,a,r[t],r[t+1]),f<h){for(u=0;u<n;++u)l[u]=r[t+u];return l.length=n,f}return h}c=c||[NaN,NaN];let g=t+n;for(;g<e;)if(oi(r,g-n,g,n,o,a,c),f=St(o,a,c[0],c[1]),f<h){for(h=f,u=0;u<n;++u)l[u]=c[u];l.length=n,g+=n}else g+=n*Math.max((Math.sqrt(f)-Math.sqrt(h))/i|0,1);if(oi(r,e-n,t,n,o,a,c),f=St(o,a,c[0],c[1]),f<h){for(h=f,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function Ma(r,t,e,n,i,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,f=e.length;u<f;++u){const g=e[u];h=li(r,t,g,n,i,s,o,a,l,h,c),t=g}return h}function Fa(r,t,e,n){for(let i=0,s=e.length;i<s;++i)r[t++]=e[i];return t}function hi(r,t,e,n){for(let i=0,s=e.length;i<s;++i){const o=e[i];for(let a=0;a<n;++a)r[t++]=o[a]}return t}function Oa(r,t,e,n,i){i=i||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=hi(r,t,e[o],n);i[s++]=l,t=l}return i.length=s,i}function ci(r,t,e,n,i){i=i!==void 0?i:[];let s=0;for(let o=t;o<e;o+=n)i[s++]=r.slice(o,o+n);return i.length=s,i}function Da(r,t,e,n,i){i=i!==void 0?i:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];i[s++]=ci(r,t,l,n,i[s]),t=l}return i.length=s,i}function ur(r,t,e,n,i,s,o){const a=(e-t)/n;if(a<3){for(;t<e;t+=n)s[o++]=r[t],s[o++]=r[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-n];let c=0;for(;h.length>0;){const u=h.pop(),f=h.pop();let g=0;const p=r[f],_=r[f+1],m=r[u],R=r[u+1];for(let v=f+n;v<u;v+=n){const U=r[v],F=r[v+1],Z=us(U,F,p,_,m,R);Z>g&&(c=v,g=Z)}g>i&&(l[(c-t)/n]=1,f+n<c&&h.push(f,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=r[t+u*n],s[o++]=r[t+u*n+1]);return o}function La(r,t,e,n,i,s,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=ur(r,t,c,n,i,s,o),a.push(o),t=c}return o}function Ft(r,t){return t*Math.round(r/t)}function Na(r,t,e,n,i,s,o){if(t==e)return o;let a=Ft(r[t],i),l=Ft(r[t+1],i);t+=n,s[o++]=a,s[o++]=l;let h,c;do if(h=Ft(r[t],i),c=Ft(r[t+1],i),t+=n,t==e)return s[o++]=h,s[o++]=c,o;while(h==a&&c==l);for(;t<e;){const u=Ft(r[t],i),f=Ft(r[t+1],i);if(t+=n,u==h&&f==c)continue;const g=h-a,p=c-l,_=u-a,m=f-l;if(g*m==p*_&&(g<0&&_<g||g==_||g>0&&_>g)&&(p<0&&m<p||p==m||p>0&&m>p)){h=u,c=f;continue}s[o++]=h,s[o++]=c,a=h,l=c,h=u,c=f}return s[o++]=h,s[o++]=c,o}function ui(r,t,e,n,i,s,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=Na(r,t,c,n,i,s,o),a.push(o),t=c}return o}let ka=class kr extends cr{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new kr(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,i){return i<Vr(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ai(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),li(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,i))}getArea(){return si(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return ci(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=ur(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new kr(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=hi(this.flatCoordinates,0,t,this.stride),this.changed()}};var fi=ka;let Ba=class Xi extends cr{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Xi(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,i){const s=this.flatCoordinates,o=St(t,e,s[0],s[1]);if(o<i){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return i}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return Hr(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return qi(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Fa(this.flatCoordinates,0,t,this.stride),this.changed()}};var za=Ba;function Ua(r,t,e,n,i){return!Ji(i,function(s){return!Et(r,t,e,n,s[0],s[1])})}function Et(r,t,e,n,i,s){let o=0,a=r[e-n],l=r[e-n+1];for(;t<e;t+=n){const h=r[t],c=r[t+1];l<=s?c>s&&(h-a)*(s-l)-(i-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(i-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function di(r,t,e,n,i,s){if(e.length===0||!Et(r,t,e[0],n,i,s))return!1;for(let o=1,a=e.length;o<a;++o)if(Et(r,e[o-1],e[o],n,i,s))return!1;return!0}function fr(r,t,e,n,i,s,o){let a,l,h,c,u,f,g;const p=i[s+1],_=[];for(let v=0,U=e.length;v<U;++v){const F=e[v];for(c=r[F-n],f=r[F-n+1],a=t;a<F;a+=n)u=r[a],g=r[a+1],(p<=f&&g<=p||f<=p&&p<=g)&&(h=(p-f)/(g-f)*(u-c)+c,_.push(h)),c=u,f=g}let m=NaN,R=-1/0;for(_.sort(ze),c=_[0],a=1,l=_.length;a<l;++a){u=_[a];const v=Math.abs(u-c);v>R&&(h=(c+u)/2,di(r,t,e,n,h,p)&&(m=h,R=v)),c=u}return isNaN(m)&&(m=i[s]),o?(o.push(m,p,R),o):[m,p,R]}function Ga(r,t,e,n,i){let s=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];s=fr(r,t,l,n,i,2*o,s),t=l[l.length-1]}return s}function ja(r,t,e,n,i){let s;for(t+=n;t<e;t+=n)if(s=i(r.slice(t-n,t),r.slice(t,t+n)),s)return s;return!1}function gi(r,t,e,n,i,s){return s=s??qr(Yt(),r,t,e,n),Yr(i,s)?s[0]>=i[0]&&s[2]<=i[2]||s[1]>=i[1]&&s[3]<=i[3]?!0:ja(r,t,e,n,function(o,a){return os(i,o,a)}):!1}function Wa(r,t,e,n,i){return!!(gi(r,t,e,n,i)||Et(r,t,e,n,i[0],i[1])||Et(r,t,e,n,i[0],i[3])||Et(r,t,e,n,i[2],i[1])||Et(r,t,e,n,i[2],i[3]))}function Va(r,t,e,n,i){if(!Wa(r,t,e[0],n,i))return!1;if(e.length===1)return!0;for(let s=1,o=e.length;s<o;++s)if(Ua(r,e[s-1],e[s],n,i)&&!gi(r,e[s-1],e[s],n,i))return!1;return!0}function Xa(r,t,e,n){for(;t<e-n;){for(let i=0;i<n;++i){const s=r[t+i];r[t+i]=r[e-n+i],r[e-n+i]=s}t+=n,e-=n}}function dr(r,t,e,n){let i=0,s=r[e-n],o=r[e-n+1];for(;t<e;t+=n){const a=r[t],l=r[t+1];i+=(a-s)*(l+o),s=a,o=l}return i===0?void 0:i>0}function Za(r,t,e,n,i){i=i!==void 0?i:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=dr(r,t,a,n);if(s===0){if(i&&l||!i&&!l)return!1}else if(i&&!l||!i&&l)return!1;t=a}return!0}function pi(r,t,e,n,i){i=i!==void 0?i:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=dr(r,t,a,n);(s===0?i&&l||!i&&!l:i&&!l||!i&&l)&&Xa(r,t,a,n),t=a}return t}function _i(r,t){const e=[];let n=0,i=0,s;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=dr(r,n,l,2);if(s===void 0&&(s=h),h===s)e.push(t.slice(i,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[i])}i=o+1,n=l}return e}let Ha=class Br extends cr{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?on(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Br(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,i){return i<Vr(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ia(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ma(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,i))}containsXY(t,e){return di(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Aa(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),pi(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Da(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Nt(this.getExtent());this.flatInteriorPoint_=fr(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new za(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new fi(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,i=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new fi(e.slice(s,l),t);i.push(h),s=l}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Za(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=pi(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=ui(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new Br(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return Va(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Oa(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}};function mi(r){if(Kr(r))throw new Error("Cannot create polygon from empty extent");const t=r[0],e=r[1],n=r[2],i=r[3],s=[t,e,t,i,n,i,n,e,t,e];return new Ha(s,"XY",[s.length])}function gr(r,t,e,n){const i=Kt(t)/e[0],s=pt(t)/e[1];return n?Math.min(r,Math.max(i,s)):Math.min(r,Math.min(i,s))}function pr(r,t,e){let n=Math.min(r,t);const i=50;return n*=Math.log(1+i*Math.max(0,r/t-1))/i+1,e&&(n=Math.max(n,e),n/=Math.log(1+i*Math.max(0,e/r-1))/i+1),z(n,e/2,t*2)}function qa(r,t,e,n){return t=t!==void 0?t:!0,function(i,s,o,a){if(i!==void 0){const l=r[0],h=r[r.length-1],c=e?gr(l,e,o,n):l;if(a)return t?pr(i,c,h):z(i,h,c);const u=Math.min(c,i),f=Math.floor(sn(r,u,s));return r[f]>c&&f<r.length-1?r[f+1]:r[f]}}}function Ya(r,t,e,n,i,s){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const c=i?gr(t,i,l,s):t;if(h)return n?pr(o,c,e):z(o,e,c);const u=1e-9,f=Math.ceil(Math.log(t/c)/Math.log(r)-u),g=-a*(.5-u)+.5,p=Math.min(c,o),_=Math.floor(Math.log(t/p)/Math.log(r)+g),m=Math.max(f,_),R=t/Math.pow(r,m);return z(R,e,c)}}}function xi(r,t,e,n,i){return e=e!==void 0?e:!0,function(s,o,a,l){if(s!==void 0){const h=n?gr(r,n,a,i):r;return!e||!l?z(s,t,h):pr(s,h,t)}}}function Ka(r){if(r!==void 0)return 0}function yi(r){if(r!==void 0)return r}function Ja(r){const t=2*Math.PI/r;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function Qa(r){const t=kt(5);return function(e,n){return n||e===void 0?e:Math.abs(e)<=t?0:e}}const tl=256,_r=0;class el extends ne{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=or(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&ua(),t.center&&(t.center=dt(t.center,this.projection_)),t.extent&&(t.extent=pe(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in K)delete e[a];this.setProperties(e,!0);const n=nl(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const i=rl(t),s=n.constraint,o=il(t);this.constraints_={center:i,resolution:s,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const i=t||[0,0,0,0];e=e||[0,0,0,0];const s=this.getResolution(),o=s/2*(i[3]-e[3]+e[1]-i[1]),a=s/2*(i[0]-e[0]+e[2]-i[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let i=arguments[n];i.center&&(i=Object.assign({},i),i.center=dt(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=dt(i.anchor,this.getProjection())),e[n]=i}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let i=0;for(;i<e&&!this.isDef();++i){const c=arguments[i];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(i===e){n&&xe(n,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;i<e;++i){const c=arguments[i],u={start:s,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||ko,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const f=tn(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+f,l=u.targetRotation}sl(u)?u.complete=!0:s+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(Q.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Q.ANIMATING]>0}getInteracting(){return this.hints_[Q.INTERACTING]>0}cancelAnimations(){this.setHint(Q.ANIMATING,-this.hints_[Q.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const i=this.animations_[e];if(i[0].callback&&xe(i[0].callback,!1),!t)for(let s=0,o=i.length;s<o;++s){const a=i[s];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const i=this.animations_[n];let s=!0;for(let o=0,a=i.length;o<a;++o){const l=i[o];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):s=!1;const u=l.easing(c);if(l.sourceCenter){const f=l.sourceCenter[0],g=l.sourceCenter[1],p=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=f+u*(p-f),R=g+u*(_-g);this.targetCenter_=[m,R]}if(l.sourceResolution&&l.targetResolution){const f=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),p=this.constraints_.resolution(f,0,g,!0);this.targetCenter_=this.calculateCenterZoom(p,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=f,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const f=u===1?tn(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(f,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=f}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(s){this.animations_[n]=null,this.setHint(Q.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=i[0].callback;o&&xe(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const i=this.getCenterInternal();return i!==void 0&&(n=[i[0]-e[0],i[1]-e[1]],Do(n,t-this.getRotation()),Oo(n,e)),n}calculateCenterZoom(t,e){let n;const i=this.getCenterInternal(),s=this.getResolution();if(i!==void 0&&s!==void 0){const o=e[0]-t*(e[0]-i[0])/s,a=e[1]-t*(e[1]-i[1])/s;n=[o,a]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],i=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(i*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(i*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&ei(t,this.getProjection())}getCenterInternal(){return this.get(K.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return pa(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();j(e,"The view center is not defined");const n=this.getResolution();j(n!==void 0,"The view resolution is not defined");const i=this.getRotation();return j(i!==void 0,"The view rotation is not defined"),es(e,n,i,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(K.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(pe(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=Kt(t)/e[0],i=pt(t)/e[1];return Math.max(n,i)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(e/n)/Math.log(t);return function(s){return e/Math.pow(t,s*i)}}getRotation(){return this.get(K.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(n/i)/e;return function(o){return Math.log(n/o)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let i=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();i=mr(i,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],e,n)}return{center:i.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,i;if(this.resolutions_){const s=sn(this.resolutions_,t,1);e=s,n=this.resolutions_[s],s==this.resolutions_.length-1?i=2:i=n/this.resolutions_[s+1]}else n=this.maxResolution_,i=this.zoomFactor_;return e+Math.log(n/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];const e=z(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,z(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(j(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){j(!Kr(t),"Cannot fit empty extent provided as `geometry`");const i=pe(t,this.getProjection());n=mi(i)}else if(t.getType()==="Circle"){const i=pe(t.getExtent(),this.getProjection());n=mi(i),n.rotate(this.getRotation(),Nt(i))}else n=t;this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),i=Math.sin(-e),s=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,f=s.length;u<f;u+=o){const g=s[u]*n-s[u+1]*i,p=s[u]*i+s[u+1]*n;a=Math.min(a,g),l=Math.min(l,p),h=Math.max(h,g),c=Math.max(c,p)}return[a,l,h,c]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const i=e.padding!==void 0?e.padding:[0,0,0,0],s=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),f=Nt(a);f[0]+=(i[1]-i[3])/2*l,f[1]+=(i[0]-i[2])/2*l;const g=f[0]*u-f[1]*c,p=f[1]*u+f[0]*c,_=this.getConstrainedCenter([g,p],l),m=e.callback?e.callback:We;e.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:e.duration,easing:e.easing},m):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),xe(m,!0))}centerOn(t,e,n){this.centerOnInternal(dt(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(mr(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,i){let s;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-n),l=mr(t,i,[a[0]/2+o[3],a[1]/2+o[0]],e,n);s=[t[0]-l[0],t[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=ei(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&dt(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,i,n);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=dt(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(i,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&dt(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,i=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(i),o=this.constraints_.resolution(this.targetResolution_,0,s,n),a=this.constraints_.center(this.targetCenter_,o,s,n,this.calculateCenterShift(this.targetCenter_,o,i,s));this.get(K.ROTATION)!==i&&this.set(K.ROTATION,i),this.get(K.RESOLUTION)!==o&&(this.set(K.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(K.CENTER)||!he(this.get(K.CENTER),a))&&this.set(K.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const i=e||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,i,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!he(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:t,easing:No,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Q.INTERACTING,1)}endInteraction(t,e,n){n=n&&dt(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.getInteracting()&&(this.setHint(Q.INTERACTING,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function xe(r,t){setTimeout(function(){r(t)},0)}function rl(r){if(r.extent!==void 0){const e=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return kn(r.extent,r.constrainOnlyCenter,e)}const t=or(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,kn(e,!1,!1)}return Fo}function nl(r){let t,e,n,i=r.minZoom!==void 0?r.minZoom:_r,s=r.maxZoom!==void 0?r.maxZoom:28;const o=r.zoomFactor!==void 0?r.zoomFactor:2,a=r.multiWorld!==void 0?r.multiWorld:!1,l=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,h=r.showFullExtent!==void 0?r.showFullExtent:!1,c=or(r.projection,"EPSG:3857"),u=c.getExtent();let f=r.constrainOnlyCenter,g=r.extent;if(!a&&!g&&c.isGlobal()&&(f=!1,g=u),r.resolutions!==void 0){const p=r.resolutions;e=p[i],n=p[s]!==void 0?p[s]:p[p.length-1],r.constrainResolution?t=qa(p,l,!f&&g,h):t=xi(e,n,l,!f&&g,h)}else{const p=(u?Math.max(Kt(u),pt(u)):360*Bn.degrees/c.getMetersPerUnit())/tl/Math.pow(2,_r),_=p/Math.pow(2,28-_r);e=r.maxResolution,e!==void 0?i=0:e=p/Math.pow(o,i),n=r.minResolution,n===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?n=e/Math.pow(o,s):n=p/Math.pow(o,s):n=_),s=i+Math.floor(Math.log(e/n)/Math.log(o)),n=e/Math.pow(o,s-i),r.constrainResolution?t=Ya(o,e,n,l,!f&&g,h):t=xi(e,n,l,!f&&g,h)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:i,zoomFactor:o}}function il(r){if(r.enableRotation===void 0||r.enableRotation){const t=r.constrainRotation;return t===void 0||t===!0?Qa():t===!1?yi:typeof t=="number"?Ja(t):yi}return Ka}function sl(r){return!(r.sourceCenter&&r.targetCenter&&!he(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function mr(r,t,e,n,i){const s=Math.cos(-i);let o=Math.sin(-i),a=r[0]*s-r[1]*o,l=r[1]*s+r[0]*o;a+=(t[0]/2-e[0])*n,l+=(e[1]-t[1]/2)*n,o=-o;const h=a*s-l*o,c=l*s+a*o;return[h,c]}var vi=el,$t={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose"},w={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};let ol=class extends ne{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[w.OPACITY]=t.opacity!==void 0?t.opacity:1,j(typeof e[w.OPACITY]=="number","Layer opacity must be a number"),e[w.VISIBLE]=t.visible!==void 0?t.visible:!0,e[w.Z_INDEX]=t.zIndex,e[w.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[w.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[w.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[w.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=z(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return C()}getLayerStatesArray(t){return C()}getExtent(){return this.get(w.EXTENT)}getMaxResolution(){return this.get(w.MAX_RESOLUTION)}getMinResolution(){return this.get(w.MIN_RESOLUTION)}getMinZoom(){return this.get(w.MIN_ZOOM)}getMaxZoom(){return this.get(w.MAX_ZOOM)}getOpacity(){return this.get(w.OPACITY)}getSourceState(){return C()}getVisible(){return this.get(w.VISIBLE)}getZIndex(){return this.get(w.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(w.EXTENT,t)}setMaxResolution(t){this.set(w.MAX_RESOLUTION,t)}setMinResolution(t){this.set(w.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(w.MAX_ZOOM,t)}setMinZoom(t){this.set(w.MIN_ZOOM,t)}setOpacity(t){j(typeof t=="number","Layer opacity must be a number"),this.set(w.OPACITY,t)}setVisible(t){this.set(w.VISIBLE,t)}setZIndex(t){this.set(w.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}};var al=ol;let ll=class extends al{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(w.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(w.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Rt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=tt(t,at.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof vi?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&n&&(e.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let i;if(e.layerStatesArray){if(i=e.layerStatesArray.find(o=>o.layer===this),!i)return!1}else i=this.getLayerState();const s=this.getExtent();return hl(i,e.viewState)&&(!s||Yr(s,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];const e=this.getSource()?.getAttributions();if(!e)return[];const n=t instanceof vi?t.getViewStateAndExtent():t;let i=e(n);return Array.isArray(i)||(i=[i]),i}render(t,e){const n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(w.MAP,t)}getMapInternal(){return this.get(w.MAP)}setMap(t){this.mapPrecomposeKey_&&(Rt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Rt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=tt(t,$t.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=tt(this,at.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){const e=t.frameState.layerStatesArray,n=this.getLayerState(!1);j(!e.some(i=>i.layer===n.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),e.push(n)}setSource(t){this.set(w.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}};function hl(r,t){if(!r.visible)return!1;const e=t.resolution;if(e<r.minResolution||e>=r.maxResolution)return!1;const n=t.zoom;return n>r.minZoom&&n<=r.maxZoom}var Ei=ll;const $i={RENDER_ORDER:"renderOrder"};let cl=class extends Ei{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get($i.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new Zi(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set($i.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?Cn:t;const e=ul(t);this.styleFunction_=t===null?void 0:po(e),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}};function ul(r){if(r===void 0)return Cn;if(!r)return null;if(typeof r=="function"||r instanceof ie)return r;if(!Array.isArray(r))return An([r]);if(r.length===0)return[];const t=r.length,e=r[0];if(e instanceof ie){const n=new Array(t);for(let i=0;i<t;++i){const s=r[i];if(!(s instanceof ie))throw new Error("Expected a list of style instances");n[i]=s}return n}if("style"in e){const n=new Array(t);for(let i=0;i<t;++i){const s=r[i];if(!("style"in s))throw new Error("Expected a list of rules with a style property");n[i]=s}return vo(n)}return An(r)}var fl=cl;function dl(r,t,e,n){const i=[];let s=Yt();for(let o=0,a=e.length;o<a;++o){const l=e[o];s=Ce(r,t,l[0],n),i.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return i}function Ri(r,t,e,n,i,s,o){let a,l;const h=(e-t)/n;if(h===1)a=t;else if(h===2)a=t,l=i;else if(h!==0){let c=r[t],u=r[t+1],f=0;const g=[0];for(let m=t+n;m<e;m+=n){const R=r[m],v=r[m+1];f+=Math.sqrt((R-c)*(R-c)+(v-u)*(v-u)),g.push(f),c=R,u=v}const p=i*f,_=$s(g,p);_<0?(l=(p-g[-_-2])/(g[-_-1]-g[-_-2]),a=t+(-_-2)*n):a=t+_*n}o=o>1?o:2,s=s||new Array(o);for(let c=0;c<o;++c)s[c]=a===void 0?NaN:l===void 0?r[a+c]:en(r[a+c],r[a+n+c],l);return s}const Si=nt();let xr=class zr{constructor(t,e,n,i,s,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=s,this.squaredTolerance_,this.stride_=i,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Hr(this.flatCoordinates_):Ce(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=Nt(this.getExtent());this.flatInteriorPoints_=fr(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=_i(this.flatCoordinates_,this.ends_),e=dl(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Ga(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Ri(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const n=this.ends_;for(let i=0,s=n.length;i<s;++i){const o=n[i],a=Ri(t,e,o,2,.5);on(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Mt(t);const e=t.getExtent(),n=t.getWorldExtent();if(e&&n){const i=pt(n)/pt(e);_e(Si,n[0],n[3],i,-i,0,0,0),me(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Si,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new zr(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=dn((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const n=this.simplifiedGeometry_.getFlatCoordinates();let i;switch(this.type_){case"LineString":n.length=ur(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),i=[n.length];break;case"MultiLineString":i=[],n.length=La(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,i);break;case"Polygon":i=[],n.length=ui(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,i);break}return i&&(this.simplifiedGeometry_=new zr(this.type_,n,i,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}};xr.prototype.getFlatCoordinates=xr.prototype.getOrientedFlatCoordinates;var gl=xr;let pl=class Ur{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(t,e){for(let n=0;n<t.length;n++)this.addFeature(t[n],e)}addFeature(t,e){let n=t.getGeometry();n&&(e&&(n=n.clone(),n.applyTransform(e)),this.addGeometry_(n,t))}clearFeatureEntryInPointBatch_(t){const e=L(t),n=this.pointBatch.entries[e];if(n)return this.pointBatch.geometriesCount-=n.flatCoordss.length,delete this.pointBatch.entries[e],n}clearFeatureEntryInLineStringBatch_(t){const e=L(t),n=this.lineStringBatch.entries[e];if(n)return this.lineStringBatch.verticesCount-=n.verticesCount,this.lineStringBatch.geometriesCount-=n.flatCoordss.length,delete this.lineStringBatch.entries[e],n}clearFeatureEntryInPolygonBatch_(t){const e=L(t),n=this.polygonBatch.entries[e];if(n)return this.polygonBatch.verticesCount-=n.verticesCount,this.polygonBatch.ringsCount-=n.ringsCount,this.polygonBatch.geometriesCount-=n.flatCoordss.length,delete this.polygonBatch.entries[e],n}addGeometry_(t,e){const n=t.getType();switch(n){case"GeometryCollection":{const i=t.getGeometriesArray();for(const s of i)this.addGeometry_(s,e);break}case"MultiPolygon":{const i=t;this.addCoordinates_(n,i.getFlatCoordinates(),i.getEndss(),e,L(e),i.getStride());break}case"MultiLineString":{const i=t;this.addCoordinates_(n,i.getFlatCoordinates(),i.getEnds(),e,L(e),i.getStride());break}case"MultiPoint":{const i=t;this.addCoordinates_(n,i.getFlatCoordinates(),null,e,L(e),i.getStride());break}case"Polygon":{const i=t;this.addCoordinates_(n,i.getFlatCoordinates(),i.getEnds(),e,L(e),i.getStride());break}case"Point":{const i=t;this.addCoordinates_(n,i.getFlatCoordinates(),null,e,L(e),i.getStride());break}case"LineString":case"LinearRing":{const i=t,s=i.getStride();this.addCoordinates_(n,i.getFlatCoordinates(),null,e,L(e),s,i.getLayout?.());break}}}addCoordinates_(t,e,n,i,s,o,a){let l;switch(t){case"MultiPolygon":{const h=n;for(let c=0,u=h.length;c<u;c++){let f=h[c];const g=c>0?h[c-1]:null,p=g?g[g.length-1]:0,_=f[f.length-1];f=p>0?f.map(m=>m-p):f,this.addCoordinates_("Polygon",e.slice(p,_),f,i,s,o,a)}break}case"MultiLineString":{const h=n;for(let c=0,u=h.length;c<u;c++){const f=c>0?h[c-1]:0;this.addCoordinates_("LineString",e.slice(f,h[c]),null,i,s,o,a)}break}case"MultiPoint":for(let h=0,c=e.length;h<c;h+=o)this.addCoordinates_("Point",e.slice(h,h+2),null,i,s,null,null);break;case"Polygon":{const h=n;if(i instanceof gl){const f=_i(e,h);if(f.length>1){this.addCoordinates_("MultiPolygon",e,f,i,s,o,a);return}}this.polygonBatch.entries[s]||(this.polygonBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),l=e.length/o;const c=n.length,u=n.map((f,g,p)=>g>0?(f-p[g-1])/o:f/o);this.polygonBatch.verticesCount+=l,this.polygonBatch.ringsCount+=c,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[s].flatCoordss.push(_l(e,o)),this.polygonBatch.entries[s].ringsVerticesCounts.push(u),this.polygonBatch.entries[s].verticesCount+=l,this.polygonBatch.entries[s].ringsCount+=c;for(let f=0,g=h.length;f<g;f++){const p=f>0?h[f-1]:0;this.addCoordinates_("LinearRing",e.slice(p,h[f]),null,i,s,o,a)}break}case"Point":this.pointBatch.entries[s]||(this.pointBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[s].flatCoordss.push(e);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[s]||(this.lineStringBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0})),l=e.length/o,this.lineStringBatch.verticesCount+=l,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[s].flatCoordss.push(ml(e,o,a)),this.lineStringBatch.entries[s].verticesCount+=l;break}}addRefToEntry_(t,e){const n=this.uidToRef_.get(t),i=n||this.freeGlobalRef_.pop()||++this.globalCounter_;return e.ref=i,n||(this.refToFeature_.set(i,e.feature),this.uidToRef_.set(t,i)),e}removeRef_(t,e){if(!t)throw new Error("This feature has no ref: "+e);this.refToFeature_.delete(t),this.uidToRef_.delete(e),this.freeGlobalRef_.push(t)}changeFeature(t){if(!this.uidToRef_.get(L(t)))return;this.removeFeature(t);const e=t.getGeometry();e&&this.addGeometry_(e,t)}removeFeature(t){let e=this.clearFeatureEntryInPointBatch_(t);e=this.clearFeatureEntryInPolygonBatch_(t)||e,e=this.clearFeatureEntryInLineStringBatch_(t)||e,e&&this.removeRef_(e.ref,L(e.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(t){return this.refToFeature_.get(t)}isEmpty(){return this.globalCounter_===0}filter(t){const e=new Ur;e.globalCounter_=this.globalCounter_,e.uidToRef_=this.uidToRef_,e.refToFeature_=this.refToFeature_;let n=!0;for(const i of this.refToFeature_.values())t(i)&&(e.addFeature(i),n=!1);return n?new Ur:e}};function _l(r,t){return t===2?r:r.filter((e,n)=>n%t<2)}function ml(r,t,e){return t===3&&e==="XYM"?r:t===4?r.filter((n,i)=>i%t!==2):t===3?r.map((n,i)=>i%t!==2?n:0):new Array(r.length*1.5).fill(0).map((n,i)=>i%3===2?0:r[Math.round(i/1.5)])}var xl=pl;const yr=34962,vr=34963,yl=35044,Ti=35048,vl=5121,El=5123,$l=5125,bi=5126,wi=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Rl(r,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!ls},t);const e=wi.length;for(let n=0;n<e;++n)try{const i=r.getContext(wi[n],t);if(i)return i}catch{}return null}const Sl={STATIC_DRAW:yl};let Tl=class{constructor(t,e){this.array_=null,this.type_=t,j(t===yr||t===vr,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=e!==void 0?e:Sl.STATIC_DRAW}ofSize(t){return this.array_=new(ye(this.type_))(t),this}fromArray(t){return this.array_=ye(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(ye(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}setArray(t){const e=ye(this.type_);if(!(t instanceof e))throw new Error(`Expected ${e}`);this.array_=t}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}};function ye(r){switch(r){case yr:return Float32Array;case vr:return Uint32Array;default:return Float32Array}}var Ci=Tl;function Pi(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Er(r,t){return r[0]=t[0],r[1]=t[1],r[4]=t[2],r[5]=t[3],r[12]=t[4],r[13]=t[5],r}var ve={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"};const bl=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,wl=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;let Cl=class{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer(),this.depthBuffer_=e.createRenderbuffer();const n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t.vertexShader||bl),e.compileShader(n);const i=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(i,t.fragmentShader||wl),e.compileShader(i),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,n),e.attachShader(this.renderTargetProgram_,i),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(o=>{this.uniforms_.push({value:t.uniforms[o],location:e.getUniformLocation(this.renderTargetProgram_,o)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(t){const e=this.getGL(),n=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.bindRenderbuffer(e.RENDERBUFFER,this.getDepthBuffer()),e.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const i=0,s=e.RGBA,o=0,a=e.RGBA,l=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,i,s,n[0],n[1],o,a,l,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n[0],n[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer_)}}apply(t,e,n,i){const s=this.getGL(),o=t.size;if(s.bindFramebuffer(s.FRAMEBUFFER,e?e.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!e){const l=L(s.canvas);if(!t.renderTargets[l]){const h=s.getContextAttributes();h&&h.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=t.layerStatesArray[t.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),n&&n(s,t),s.drawArrays(s.TRIANGLES,0,6),i&&i(s,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){const e=this.getGL();let n,i=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(t):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${i}`]),e.bindTexture(e.TEXTURE_2D,s.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,n.width,n.height,0,e.UNSIGNED_BYTE,new Uint8Array(n.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.uniform1i(s.location,i++);else if(Array.isArray(n))switch(n.length){case 2:e.uniform2f(s.location,n[0],n[1]);return;case 3:e.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:e.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(s.location,n)})}};var Ai=Cl;const ht={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},V={UNSIGNED_BYTE:vl,UNSIGNED_SHORT:El,UNSIGNED_INT:$l,FLOAT:bi},Ee={};function Ii(r){return"shared/"+r}let Mi=0;function Pl(){const r="unique/"+Mi;return Mi+=1,r}function Al(r){let t=Ee[r];if(!t){const e=document.createElement("canvas");e.width=1,e.height=1,e.style.position="absolute",e.style.left="0",t={users:0,context:Rl(e)},Ee[r]=t}return t.users+=1,t.context}function Il(r){const t=Ee[r];if(!t||(t.users-=1,t.users>0))return;const e=t.context,n=e.getExtension("WEBGL_lose_context");n&&n.loseContext();const i=e.canvas;i.width=1,i.height=1,delete Ee[r]}class Ml extends fn{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?Ii(t.canvasCacheKey):Pl(),this.gl_=Al(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const e=this.gl_.canvas;e.addEventListener(ve.LOST,this.boundHandleWebGLContextLost_),e.addEventListener(ve.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=nt(),this.offsetScaleMatrix_=nt(),this.tmpMat4_=Pi(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(n=>new Ai({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new Ai({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(const e in t)this.uniforms_.push({name:e,value:t[e]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===Ii(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.gl_,n=L(t);let i=this.bufferCache_[n];if(!i){const s=e.createBuffer();i={buffer:t,webGlBuffer:s},this.bufferCache_[n]=i}e.bindBuffer(t.getType(),i.webGlBuffer)}flushBufferData(t){const e=this.gl_;this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=L(t);delete this.bufferCache_[e]}disposeInternal(){const t=this.gl_.canvas;t.removeEventListener(ve.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(ve.RESTORED,this.boundHandleWebGLContextRestored_),Il(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,e,n){const i=this.gl_,s=this.getCanvas(),o=t.size,a=t.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,e?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindFrameBuffer(t,e){const n=this.getGL();n.bindFramebuffer(n.FRAMEBUFFER,t),e&&n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0)}bindInitialFrameBuffer(){const t=this.getGL(),e=this.postProcessPasses_[0].getFrameBuffer();t.bindFramebuffer(t.FRAMEBUFFER,e);const n=this.postProcessPasses_[0].getRenderTargetTexture();t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}bindTexture(t,e,n){const i=this.gl_;i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,t),i.uniform1i(this.getUniformLocation(n),e)}bindAttribute(t,e,n){const i=this.getGL();this.bindBuffer(t);const s=this.getAttributeLocation(e);i.enableVertexAttribArray(s),i.vertexAttribPointer(s,n,i.FLOAT,!1,0,0)}prepareDrawToRenderTarget(t,e,n,i){const s=this.gl_,o=e.getSize();s.bindFramebuffer(s.FRAMEBUFFER,e.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,e.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,e.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(t,e){const n=this.gl_;this.getExtension("OES_element_index_uint");const i=n.UNSIGNED_INT,s=4,o=e-t,a=t*s;n.drawElements(n.TRIANGLES,o,i,a)}finalizeDraw(t,e,n){for(let i=0,s=this.postProcessPasses_.length;i<s;i++)i===s-1?this.postProcessPasses_[i].apply(t,null,e,n):this.postProcessPasses_[i].apply(t,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){const e=t.size,n=t.viewState.rotation,i=t.pixelRatio;this.setUniformFloatValue(ht.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(ht.ZOOM,t.viewState.zoom),this.setUniformFloatValue(ht.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(ht.PIXEL_RATIO,i),this.setUniformFloatVec2(ht.VIEWPORT_SIZE_PX,[e[0],e[1]]),this.setUniformFloatValue(ht.ROTATION,n)}applyHitDetectionUniform(t){const e=this.getUniformLocation(ht.HIT_DETECTION);this.getGL().uniform1i(e,t?1:0),t&&this.setUniformFloatValue(ht.PIXEL_RATIO,.5)}applyUniforms(t){const e=this.gl_;let n,i=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(t):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=n):s.texture||(s.prevValue=void 0,s.texture=e.createTexture()),this.bindTexture(s.texture,i,s.name),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const o=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&o&&s.prevValue!==n&&(s.prevValue=n,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),i++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,Er(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:e.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:e.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:e.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(t,e){this.gl_.useProgram(t),this.currentProgram_=t,e&&(this.applyFrameState(e),this.applyUniforms(e))}compileShader(t,e){const n=this.gl_,i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}getProgram(t,e){const n=this.gl_,i=this.compileShader(t,n.FRAGMENT_SHADER),s=this.compileShader(e,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,i),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(i,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(a)}if(n.deleteShader(i),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(t){const e=L(this.currentProgram_);return this.uniformLocationsByProgram_[e]===void 0&&(this.uniformLocationsByProgram_[e]={}),this.uniformLocationsByProgram_[e][t]===void 0&&(this.uniformLocationsByProgram_[e][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[e][t]}getAttributeLocation(t){const e=L(this.currentProgram_);return this.attribLocationsByProgram_[e]===void 0&&(this.attribLocationsByProgram_[e]={}),this.attribLocationsByProgram_[e][t]===void 0&&(this.attribLocationsByProgram_[e][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[e][t]}makeProjectionTransform(t,e){const n=t.size,i=t.viewState.rotation,s=t.viewState.resolution,o=t.viewState.center;return _e(e,0,0,2/(s*n[0]),2/(s*n[1]),-i,-o[0],-o[1]),e}setUniformFloatValue(t,e){this.gl_.uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.gl_.uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.gl_.uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}enableAttributeArray_(t,e,n,i,s){const o=this.getAttributeLocation(t);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,e,n,!1,i,s))}enableAttributes(t){const e=Fl(t);let n=0;for(let i=0;i<t.length;i++){const s=t[i];this.enableAttributeArray_(s.name,s.size,s.type||bi,e,n),n+=s.size*Fi(s.type)}}handleWebGLContextLost(t){be(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,e,n,i){const s=this.gl_;n=n||s.createTexture();const o=i?s.NEAREST:s.LINEAR;s.bindTexture(s.TEXTURE_2D,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);const a=0,l=s.RGBA,h=0,c=s.RGBA,u=s.UNSIGNED_BYTE;return e instanceof Uint8Array?s.texImage2D(s.TEXTURE_2D,a,l,t[0],t[1],h,c,u,e):e?s.texImage2D(s.TEXTURE_2D,a,l,c,u,e):s.texImage2D(s.TEXTURE_2D,a,l,t[0],t[1],h,c,u,null),n}}function Fl(r){let t=0;for(let e=0;e<r.length;e++){const n=r[e];t+=n.size*Fi(n.type)}return t}function Fi(r){switch(r){case V.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case V.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case V.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case V.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var Ol=Ml;function Dl(){const r='function t(t,n,x=2){const o=n&&n.length,i=o?n[0]*x:t.length;let u=e(t,0,i,x,!0);const l=[];if(!u||u.next===u.prev)return l;let c,h,y;if(o&&(u=function(t,n,r,x){const o=[];for(let r=0,i=n.length;r<i;r++){const u=e(t,n[r]*x,r<i-1?n[r+1]*x:t.length,x,!1);u===u.next&&(u.steiner=!0),o.push(a(u))}o.sort(f);for(let t=0;t<o.length;t++)r=s(o[t],r);return r}(t,n,u,x)),t.length>80*x){c=1/0,h=1/0;let e=-1/0,n=-1/0;for(let r=x;r<i;r+=x){const x=t[r],o=t[r+1];x<c&&(c=x),o<h&&(h=o),x>e&&(e=x),o>n&&(n=o)}y=Math.max(e-c,n-h),y=0!==y?32767/y:0}return r(u,l,x,c,h,y,0),l}function e(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,i=n-r;o<n;o+=r)x+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=w(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=w(x/r|0,t[x],t[x+1],o);return o&&g(o,o.next)&&(A(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!g(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(A(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function r(t,e,f,s,l,a,h){if(!t)return;!h&&a&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=c(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let i=x,u=0;for(let t=0;t<n&&(u++,i=i.nextZ,i);t++);let f=n;for(;u>0||f>0&&i;)0!==u&&(0===f||!i||x.z<=i.z)?(r=x,x=x.nextZ,u--):(r=i,i=i.nextZ,f--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(e>1)}(x)}(t,s,l,a);let y=t;for(;t.prev!==t.next;){const c=t.prev,p=t.next;if(a?o(t,s,l,a):x(t))e.push(c.i,t.i,p.i),A(t),t=p.next,y=p.next;else if((t=p)===y){h?1===h?r(t=i(n(t),e),e,f,s,l,a,2):2===h&&u(t,e,f,s,l,a):r(n(t),e,f,s,l,a,1);break}}}function x(t){const e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;const x=e.x,o=n.x,i=r.x,u=e.y,f=n.y,s=r.y,l=Math.min(x,o,i),c=Math.min(u,f,s),a=Math.max(x,o,i),h=Math.max(u,f,s);let p=r.next;for(;p!==e;){if(p.x>=l&&p.x<=a&&p.y>=c&&p.y<=h&&y(x,u,o,f,i,s,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function o(t,e,n,r){const x=t.prev,o=t,i=t.next;if(v(x,o,i)>=0)return!1;const u=x.x,f=o.x,s=i.x,l=x.y,a=o.y,h=i.y,p=Math.min(u,f,s),g=Math.min(l,a,h),b=Math.max(u,f,s),M=Math.max(l,a,h),m=c(p,g,e,n,r),Z=c(b,M,e,n,r);let d=t.prevZ,w=t.nextZ;for(;d&&d.z>=m&&w&&w.z<=Z;){if(d.x>=p&&d.x<=b&&d.y>=g&&d.y<=M&&d!==x&&d!==i&&y(u,l,f,a,s,h,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,w.x>=p&&w.x<=b&&w.y>=g&&w.y<=M&&w!==x&&w!==i&&y(u,l,f,a,s,h,w.x,w.y)&&v(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;d&&d.z>=m;){if(d.x>=p&&d.x<=b&&d.y>=g&&d.y<=M&&d!==x&&d!==i&&y(u,l,f,a,s,h,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;w&&w.z<=Z;){if(w.x>=p&&w.x<=b&&w.y>=g&&w.y<=M&&w!==x&&w!==i&&y(u,l,f,a,s,h,w.x,w.y)&&v(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function i(t,e){let r=t;do{const n=r.prev,x=r.next.next;!g(n,x)&&b(n,r,r.next,x)&&Z(n,x)&&Z(x,n)&&(e.push(n.i,r.i,x.i),A(r),A(r.next),r=t=x),r=r.next}while(r!==t);return n(r)}function u(t,e,x,o,i,u){let f=t;do{let t=f.next.next;for(;t!==f.prev;){if(f.i!==t.i&&p(f,t)){let s=d(f,t);return f=n(f,f.next),s=n(s,s.next),r(f,e,x,o,i,u,0),void r(s,e,x,o,i,u,0)}t=t.next}f=f.next}while(f!==t)}function f(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function s(t,e){const r=function(t,e){let n=e;const r=t.x,x=t.y;let o,i=-1/0;if(g(t,n))return n;do{if(g(t,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>i&&(i=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const u=o,f=o.x,s=o.y;let c=1/0;n=o;do{if(r>=n.x&&n.x>=f&&r!==n.x&&h(x<s?r:i,x,f,s,x<s?i:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);Z(n,t)&&(e<c||e===c&&(n.x>o.x||n.x===o.x&&l(o,n)))&&(o=n,c=e)}n=n.next}while(n!==u);return o}(t,e);if(!r)return e;const x=d(r,t);return n(x,x.next),n(r,r.next)}function l(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function c(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function h(t,e,n,r,x,o,i,u){return(x-i)*(e-u)>=(t-i)*(o-u)&&(t-i)*(r-u)>=(n-i)*(e-u)&&(n-i)*(o-u)>=(x-i)*(r-u)}function y(t,e,n,r,x,o,i,u){return!(t===i&&e===u)&&h(t,e,n,r,x,o,i,u)}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Z(t,e)&&Z(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||g(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function g(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,r){const x=m(v(t,e,n)),o=m(v(t,e,r)),i=m(v(n,r,t)),u=m(v(n,r,e));return x!==o&&i!==u||(!(0!==x||!M(t,n,e))||(!(0!==o||!M(t,r,e))||(!(0!==i||!M(n,t,r))||!(0!==u||!M(n,e,r)))))}function M(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function m(t){return t>0?1:t<0?-1:0}function Z(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function d(t,e){const n=E(t.i,t.x,t.y),r=E(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function w(t,e,n,r){const x=E(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function E(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function I(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function z(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],i=e[2],u=e[3],f=e[4],s=e[5];return t[0]=u/n,t[1]=-o/n,t[2]=-i/n,t[3]=x/n,t[4]=(i*s-u*f)/n,t[5]=-(x*s-o*f)/n,t}new Array(6);const F=[],P={vertexPosition:0,indexPosition:0};function B(t,e,n,r,x){t[e+0]=n,t[e+1]=r,t[e+2]=x}function N(t,e,n,r,x,o){const i=3+x,u=t[e+0],f=t[e+1],s=F;s.length=x;for(let n=0;n<s.length;n++)s[n]=t[e+2+n];let l=o?o.vertexPosition:0,c=o?o.indexPosition:0;const a=l/i;return B(n,l,u,f,0),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,1),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,2),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,3),s.length&&n.set(s,l+3),l+=i,r[c++]=a,r[c++]=a+1,r[c++]=a+3,r[c++]=a+1,r[c++]=a+2,r[c++]=a+3,P.vertexPosition=l,P.indexPosition=c,P}function R(t,e,n,r,x,o,i,u,f,s,l){const c=10+u.length,a=o.length/c,h=[t[e+0],t[e+1]],y=[t[n],t[n+1]],p=t[e+2],v=t[n+2],g=I(f,[...h]),b=I(f,[...y]);function M(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),u=[(n[0]-t[0])/i,(n[1]-t[1])/i],f=0===r||0===i?0:Math.acos((s=u[0]*x[0]+u[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;return u[0]*o[0]+u[1]*o[1]>0?f:2*Math.PI-f}let m=-1,Z=-1,d=l;const w=null!==x;if(null!==r){m=M(g,b,I(f,[...[t[r],t[r+1]]])),Math.cos(m)<=.985&&(d+=Math.tan((m-Math.PI)/2))}if(w){Z=M(b,g,I(f,[...[t[x],t[x+1]]])),Math.cos(Z)<=.985&&(d+=Math.tan((Math.PI-Z)/2))}function A(t,e){return 0===e?1e4*t:Math.sign(e)*(1e4*t+Math.abs(e))}return o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(0,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(1,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(2,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(3,l)),o.push(...u),i.push(a,a+1,a+2,a+1,a+3,a+2),{length:s+Math.sqrt((b[0]-g[0])*(b[0]-g[0])+(b[1]-g[1])*(b[1]-g[1])),angle:d}}function S(e,n,r,x,o){const i=2+o;let u=n;const f=e.slice(u,u+o);u+=o;const s=e[u++];let l=0;const c=new Array(s-1);for(let t=0;t<s;t++)l+=e[u++],t<s-1&&(c[t]=l);const a=e.slice(u,u+2*l),h=t(a,c,2);for(let t=0;t<h.length;t++)x.push(h[t]+r.length/i);for(let t=0;t<a.length;t+=2)r.push(a[t],a[t+1],...f);return u+2*l}const T="GENERATE_POLYGON_BUFFERS",_="GENERATE_POINT_BUFFERS",O="GENERATE_LINE_STRING_BUFFERS",U=self;U.onmessage=t=>{const e=t.data;switch(e.type){case _:{const t=3,n=2,r=e.customAttributesSize,x=n+r,o=new Float32Array(e.renderInstructions),i=o.length/x,u=4*i*(r+t),f=new Uint32Array(6*i),s=new Float32Array(u);let l;for(let t=0;t<o.length;t+=x)l=N(o,t,s,f,r,l);const c=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:o.buffer},e);U.postMessage(c,[s.buffer,f.buffer,o.buffer]);break}case O:{const t=[],n=[],r=e.customAttributesSize,x=3,o=new Float32Array(e.renderInstructions);let i=0;const u=[1,0,0,1,0,0];let f,s;for(z(u,e.renderInstructionsTransform);i<o.length;){s=Array.from(o.slice(i,i+r)),i+=r,f=o[i++];const e=i,l=i+(f-1)*x,c=o[e]===o[l]&&o[e+1]===o[l+1];let a=0,h=0;for(let r=0;r<f-1;r++){let y=null;r>0?y=i+(r-1)*x:c&&(y=l-x);let p=null;r<f-2?p=i+(r+2)*x:c&&(p=e+x);const v=R(o,i+r*x,i+(r+1)*x,y,p,t,n,s,u,a,h);a=v.length,h=v.angle}i+=f*x}const l=Uint32Array.from(n),c=Float32Array.from(t),a=Object.assign({vertexBuffer:c.buffer,indexBuffer:l.buffer,renderInstructions:o.buffer},e);U.postMessage(a,[c.buffer,l.buffer,o.buffer]);break}case T:{const t=[],n=[],r=e.customAttributesSize,x=new Float32Array(e.renderInstructions);let o=0;for(;o<x.length;)o=S(x,o,t,n,r);const i=Uint32Array.from(n),u=Float32Array.from(t),f=Object.assign({vertexBuffer:u.buffer,indexBuffer:i.buffer,renderInstructions:x.buffer},e);U.postMessage(f,[u.buffer,i.buffer,x.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(r,"binary").toString("base64"):URL.createObjectURL(new Blob([r],{type:"application/javascript"})))}const $r={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};function Ll(r,t){t=t||[];const e=256,n=e-1;return t[0]=Math.floor(r/e/e/e)/n,t[1]=Math.floor(r/e/e)%e/n,t[2]=Math.floor(r/e)%e/n,t[3]=r%e/n,t}function Nl(r){let t=0;const e=256,n=e-1;return t+=Math.round(r[0]*e*e*e*n),t+=Math.round(r[1]*e*e*n),t+=Math.round(r[2]*e*n),t+=Math.round(r[3]*n),t}let kl=class extends Ve{constructor(t,e,n,i){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=i}};var Rr=kl;const Bl=5;let zl=class extends mn{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=Bl}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return C()}getData(t){return null}prepareFrame(t){return C()}renderFrame(t,e){return C()}forEachFeatureAtCoordinate(t,e,n,i,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===S.LOADED||e.getState()===S.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=S.LOADED&&e!=S.ERROR&&t.addEventListener(at.CHANGE,this.boundHandleImageChange_),e==S.IDLE&&(t.load(),e=t.getState()),e==S.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}};var Ul=zl;class Gr extends Ul{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=nt(),this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},t.addChangeListener(w.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const n=this.getLayer();if(n.hasListener($t.PRECOMPOSE)){const i=new Rr($t.PRECOMPOSE,void 0,e,t);n.dispatchEvent(i)}}dispatchPostComposeEvent(t,e){const n=this.getLayer();if(n.hasListener($t.POSTCOMPOSE)){const i=new Rr($t.POSTCOMPOSE,void 0,e,t);n.dispatchEvent(i)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let e=!0,n=-1,i;for(let o=0,a=t.layerStatesArray.length;o<a;o++){const l=t.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof Gr)){e=!0;continue}const c=l.getClassName();if((e||c!==i)&&(n+=1,e=!1),i=c,h===this)break}const s="map/"+t.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new Ol({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}clearCache(){}disposeInternal(){this.clearCache(),this.removeHelper(),this.getLayer()?.removeChangeListener(w.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(t,e,n){const i=this.getLayer();if(i.hasListener(t)){_e(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new Rr(t,this.inversePixelTransform_,n,e);i.dispatchEvent(s)}}preRender(t,e){this.dispatchRenderEvent_($t.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_($t.POSTRENDER,t,e)}}var Gl=Gr;const Sr={TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight"};let jl=class{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}delete(t){this.texture_&&t.deleteTexture(this.texture_),this.texture_=null}};var Wl=jl;function Vl(r,t){return`operator_${r}_${Object.keys(t.functions).length}`}function gt(r){const t=r.toString();return t.includes(".")?t:t+".0"}function Tr(r){if(r.length<2||r.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${r.length}(${r.map(gt).join(", ")})`}function $e(r){const t=ot(r),e=t.length>3?t[3]:1;return Tr([t[0]/255,t[1]/255,t[2]/255,e])}function Xl(r){const t=mt(r);return Tr(t)}const br={};let Zl=0;function qt(r){return r in br||(br[r]=Zl++),br[r]}function ct(r){return gt(qt(r))}function wr(r){return"u_var_"+r}function Hl(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}const Cr="getBandValue",ql="u_paletteTextures",Oi="featureId",Di="geometryType",Pr=-9999999;function Yl(r,t,e,n){const i=k(r,t,e);return Ar(i,t,n)}function T(r){return(t,e,n)=>{const i=e.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=Ar(e.args[o],n,t);return r(s,t)}}const Kl={[d.Get]:(r,t)=>{const e=t.args[0].value;return e in r.properties||(r.properties[e]={name:e,type:t.type}),"a_prop_"+e},[d.Id]:r=>(r.featureId=!0,"a_"+Oi),[d.GeometryType]:r=>(r.geometryType=!0,"a_"+Di),[d.LineMetric]:()=>"currentLineMetric",[d.Var]:(r,t)=>{const e=t.args[0].value;return e in r.variables||(r.variables[e]={name:e,type:t.type}),wr(e)},[d.Has]:(r,t)=>{const e=t.args[0].value;return e in r.properties||(r.properties[e]={name:e,type:t.type}),`(a_prop_${e} != ${gt(Pr)})`},[d.Resolution]:()=>"u_resolution",[d.Zoom]:()=>"u_zoom",[d.Time]:()=>"u_time",[d.Any]:T(r=>`(${r.join(" || ")})`),[d.All]:T(r=>`(${r.join(" && ")})`),[d.Not]:T(([r])=>`(!${r})`),[d.Equal]:T(([r,t])=>`(${r} == ${t})`),[d.NotEqual]:T(([r,t])=>`(${r} != ${t})`),[d.GreaterThan]:T(([r,t])=>`(${r} > ${t})`),[d.GreaterThanOrEqualTo]:T(([r,t])=>`(${r} >= ${t})`),[d.LessThan]:T(([r,t])=>`(${r} < ${t})`),[d.LessThanOrEqualTo]:T(([r,t])=>`(${r} <= ${t})`),[d.Multiply]:T(r=>`(${r.join(" * ")})`),[d.Divide]:T(([r,t])=>`(${r} / ${t})`),[d.Add]:T(r=>`(${r.join(" + ")})`),[d.Subtract]:T(([r,t])=>`(${r} - ${t})`),[d.Clamp]:T(([r,t,e])=>`clamp(${r}, ${t}, ${e})`),[d.Mod]:T(([r,t])=>`mod(${r}, ${t})`),[d.Pow]:T(([r,t])=>`pow(${r}, ${t})`),[d.Abs]:T(([r])=>`abs(${r})`),[d.Floor]:T(([r])=>`floor(${r})`),[d.Ceil]:T(([r])=>`ceil(${r})`),[d.Round]:T(([r])=>`floor(${r} + 0.5)`),[d.Sin]:T(([r])=>`sin(${r})`),[d.Cos]:T(([r])=>`cos(${r})`),[d.Atan]:T(([r,t])=>t!==void 0?`atan(${r}, ${t})`:`atan(${r})`),[d.Sqrt]:T(([r])=>`sqrt(${r})`),[d.Match]:T(r=>{const t=r[0],e=r[r.length-1];let n=null;for(let i=r.length-3;i>=1;i-=2){const s=r[i],o=r[i+1];n=`(${t} == ${s} ? ${o} : ${n||e})`}return n}),[d.Between]:T(([r,t,e])=>`(${r} >= ${t} && ${r} <= ${e})`),[d.Interpolate]:T(([r,t,...e])=>{let n="";for(let i=0;i<e.length-2;i+=2){const s=e[i],o=n||e[i+1],a=e[i+2],l=e[i+3];let h;r===gt(1)?h=`(${t} - ${s}) / (${a} - ${s})`:h=`(pow(${r}, (${t} - ${s})) - 1.0) / (pow(${r}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[d.Case]:T(r=>{const t=r[r.length-1];let e=null;for(let n=r.length-3;n>=0;n-=2){const i=r[n],s=r[n+1];e=`(${i} ? ${s} : ${e||t})`}return e}),[d.In]:T(([r,...t],e)=>{const n=Vl("in",e),i=[];for(let s=0;s<t.length;s+=1)i.push(`  if (inputValue == ${t[s]}) { return true; }`);return e.functions[n]=`bool ${n}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${n}(${r})`}),[d.Array]:T(r=>`vec${r.length}(${r.join(", ")})`),[d.Color]:T(r=>{if(r.length===1)return`vec4(vec3(${r[0]} / 255.0), 1.0)`;if(r.length===2)return`vec4(vec3(${r[0]} / 255.0), ${r[1]})`;const t=r.slice(0,3).map(n=>`${n} / 255.0`);if(r.length===3)return`vec4(${t.join(", ")}, 1.0)`;const e=r[3];return`vec4(${t.join(", ")}, ${e})`}),[d.Band]:T(([r,t,e],n)=>{if(!(Cr in n.functions)){let i="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const h=`${Sr.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${o+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[Cr]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${Sr.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${Sr.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${Cr}(${r}, ${t??"0.0"}, ${e??"0.0"})`}),[d.Palette]:(r,t)=>{const[e,...n]=t.args,i=n.length,s=new Uint8Array(i*4);for(let h=0;h<n.length;h++){const c=n[h].value,u=ot(c),f=h*4;s[f]=u[0],s[f+1]=u[1],s[f+2]=u[2],s[f+3]=u[3]*255}r.paletteTextures||(r.paletteTextures=[]);const o=`${ql}[${r.paletteTextures.length}]`,a=new Wl(o,s);r.paletteTextures.push(a);const l=Ar(e,x,r);return`texture2D(${o}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function Ar(r,t,e){if(r instanceof ln){const n=Kl[r.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(r.operator)}`);return n(e,r,t)}if((r.type&x)>0)return gt(r.value);if((r.type&N)>0)return r.value.toString();if((r.type&O)>0)return ct(r.value.toString());if((r.type&A)>0)return $e(r.value);if((r.type&W)>0)return Tr(r.value);if((r.type&q)>0)return Xl(r.value);throw new Error(`Unexpected expression ${r.value} (expected type ${Tt(t)})`)}function Ir(r,t,e,n){let i=0;for(const s in t){const o=t[s],a=o.callback.call(e,e.feature);let l=a?.[0]??a;l===Pr&&console.warn('The "has" operator might return false positives.'),l===void 0?l=Pr:l===null&&(l=0),r[n+i++]=l,!(!o.size||o.size===1)&&(r[n+i++]=a[1],!(o.size<3)&&(r[n+i++]=a[2],!(o.size<4)&&(r[n+i++]=a[3])))}return i}function Re(r){return Object.keys(r).reduce((t,e)=>t+(r[e].size||1),0)}function Jl(r,t,e,n){const i=(2+Re(e))*r.geometriesCount;(!t||t.length!==i)&&(t=new Float32Array(i));const s=[];let o=0;for(const a in r.entries){const l=r.entries[a];for(let h=0,c=l.flatCoordss.length;h<c;h++)s[0]=l.flatCoordss[h][0],s[1]=l.flatCoordss[h][1],lr(n,s),t[o++]=s[0],t[o++]=s[1],o+=Ir(t,e,l,o)}return t}function Ql(r,t,e,n){const i=3*r.verticesCount+(1+Re(e))*r.geometriesCount;(!t||t.length!==i)&&(t=new Float32Array(i));const s=[];let o=0;for(const a in r.entries){const l=r.entries[a];for(let h=0,c=l.flatCoordss.length;h<c;h++){s.length=l.flatCoordss[h].length,me(l.flatCoordss[h],0,s.length,3,n,s,3),o+=Ir(t,e,l,o),t[o++]=s.length/3;for(let u=0,f=s.length;u<f;u+=3)t[o++]=s[u],t[o++]=s[u+1],t[o++]=s[u+2]}}return t}function th(r,t,e,n){const i=2*r.verticesCount+(1+Re(e))*r.geometriesCount+r.ringsCount;(!t||t.length!==i)&&(t=new Float32Array(i));const s=[];let o=0;for(const a in r.entries){const l=r.entries[a];for(let h=0,c=l.flatCoordss.length;h<c;h++){s.length=l.flatCoordss[h].length,me(l.flatCoordss[h],0,s.length,2,n,s),o+=Ir(t,e,l,o),t[o++]=l.ringsVerticesCounts[h].length;for(let u=0,f=l.ringsVerticesCounts[h].length;u<f;u++)t[o++]=l.ringsVerticesCounts[h][u];for(let u=0,f=s.length;u<f;u+=2)t[o++]=s[u],t[o++]=s[u+1]}}return t}function eh(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const Li=.985,Ot=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;
float currentLineMetric = 0.; // an actual value will be used in the stroke shaders
`,Dt=eh();let rh=class{constructor(){this.uniforms_=[],this.attributes_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${gt(Dt["circle-radius"])} + ${gt(Dt["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=$e(Dt["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=gt(Dt["stroke-width"]),this.strokeColorExpression_=$e(Dt["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=ct("round"),this.strokeJoinExpression_=ct("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=$e(Dt["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(t){return this.uniforms_.push(t),this}addAttribute(t,e,n,i){return this.attributes_.push({name:t,type:e,varyingName:t.replace(/^a_/,"v_"),varyingType:i??e,varyingExpression:n??t}),this}setSymbolSizeExpression(t){return this.hasSymbol_=!0,this.symbolSizeExpression_=t,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(t){return this.symbolRotationExpression_=t,this}setSymbolOffsetExpression(t){return this.symbolOffsetExpression_=t,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(t){return this.hasSymbol_=!0,this.symbolColorExpression_=t,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(t){return this.texCoordExpression_=t,this}setFragmentDiscardExpression(t){return this.discardExpression_=t,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(t){return this.symbolRotateWithView_=t,this}setStrokeWidthExpression(t){return this.hasStroke_=!0,this.strokeWidthExpression_=t,this}setStrokeColorExpression(t){return this.hasStroke_=!0,this.strokeColorExpression_=t,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(t){return this.strokeOffsetExpression_=t,this}setStrokeCapExpression(t){return this.strokeCapExpression_=t,this}setStrokeJoinExpression(t){return this.strokeJoinExpression_=t,this}setStrokeMiterLimitExpression(t){return this.strokeMiterLimitExpression_=t,this}setStrokeDistanceFieldExpression(t){return this.strokeDistanceFieldExpression_=t,this}setFillColorExpression(t){return this.hasFill_=!0,this.fillColorExpression_=t,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(t){return this.vertexShaderFunctions_.includes(t)?this:(this.vertexShaderFunctions_.push(t),this)}addFragmentShaderFunction(t){return this.fragmentShaderFunctions_.includes(t)?this:(this.fragmentShaderFunctions_.push(t),this)}getSymbolVertexShader(){return this.hasSymbol_?`${Ot}
${this.uniforms_.map(t=>`uniform ${t};`).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_hitColor;

varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_hitColor = a_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${Ot}
${this.uniforms_.map(t=>`uniform ${t};`).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${Ot}
${this.uniforms_.map(t=>`uniform ${t};`).join(`
`)}
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_measureStart;
attribute float a_measureEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_hitColor;

varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
varying float v_measureStart;
varying float v_measureEnd;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  currentLineMetric = vertexNumber < 1.5 ? a_measureStart : a_measureEnd;
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${Li} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = a_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
  v_measureStart = a_measureStart;
  v_measureEnd = a_measureEnd;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${Ot}
${this.uniforms_.map(t=>`uniform ${t};`).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
varying float v_measureStart;
varying float v_measureEnd;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${Li}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${ct("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${ct("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${ct("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${ct("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

float distanceFromSegment(vec2 point, vec2 start, vec2 end) {
  vec2 tangent = end - start;
  vec2 startToPoint = point - start;
  // inspire by capsule fn in https://iquilezles.org/articles/distfunctions/
  float h = clamp(dot(startToPoint, tangent) / dot(tangent, tangent), 0.0, 1.0);
  return length(startToPoint - tangent * h);
}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}
      
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float lengthToPoint = max(0., min(dot(segmentTangent, startToPoint), segmentLength));
  float currentLengthPx = lengthToPoint + v_distanceOffsetPx;
  float currentRadiusPx = distanceFromSegment(currentPoint, v_segmentStart, v_segmentEnd);
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  currentLineMetric = mix(v_measureStart, v_measureEnd, lengthToPoint / segmentLength);

  if (${this.discardExpression_}) { discard; }

  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distanceField = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distanceField = max(distanceField, ${this.strokeDistanceFieldExpression_});

  vec4 color = ${this.strokeColorExpression_};
  color.a *= smoothstep(0.5, -0.5, distanceField);
  gl_FragColor = color;
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${Ot}
${this.uniforms_.map(t=>`uniform ${t};`).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_hitColor;

varying vec4 v_hitColor;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = a_hitColor;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${Ot}
${this.uniforms_.map(t=>`uniform ${t};`).join(`
`)}
varying vec4 v_hitColor;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_};
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}};function E(r,t,e){const n=te();return Yl(t,e,n,r)}function nh(r){const t=ot(r),e=t[0]*256,n=t[1],i=t[2]*256,s=Math.round(t[3]*255);return[e+n,i+s]}const ih=`vec4 unpackColor(vec2 packedColor) {
  return vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    fract(packedColor[1] / 256.0)
  );
}`;function Mr(r){return r===A||r===q?2:r===W?4:1}function Fr(r){const t=Mr(r);return t>1?`vec${t}`:"float"}function sh(r,t){for(const e in t.variables){const n=t.variables[e],i=wr(n.name);let s=Fr(n.type);n.type===A&&(s="vec4"),r.addUniform(`${s} ${i}`)}for(const e in t.properties){const n=t.properties[e],i=Fr(n.type),s=`a_prop_${n.name}`;n.type===A?(r.addAttribute(s,i,`unpackColor(${s})`,"vec4"),r.addVertexShaderFunction(ih)):r.addAttribute(s,i)}for(const e in t.functions)r.addVertexShaderFunction(t.functions[e]),r.addFragmentShaderFunction(t.functions[e])}function oh(r,t){const e={};for(const n in r.variables){const i=r.variables[n],s=wr(i.name);e[s]=()=>{const o=t[i.name];return typeof o=="number"?o:typeof o=="boolean"?o?1:0:i.type===A?ot(o||"#eee"):typeof o=="string"?qt(o):o}}return e}function ah(r){const t={};for(const e in r.properties){const n=r.properties[e],i=s=>{const o=s.get(n.name);return n.type===A?nh([...ot(o||"#eee")]):typeof o=="string"?qt(o):typeof o=="boolean"?o?1:0:o};t[`prop_${n.name}`]={size:Mr(n.type),callback:i}}return t}function Se(r){return(JSON.stringify(r).split("").reduce((t,e)=>(t<<5)-t+e.charCodeAt(0),0)>>>0).toString()}function Or(r,t,e,n){if(`${n}radius`in r&&n!=="icon-"){let i=E(e,r[`${n}radius`],x);if(`${n}radius2`in r){const s=E(e,r[`${n}radius2`],x);i=`max(${i}, ${s})`}`${n}stroke-width`in r&&(i=`(${i} + ${E(e,r[`${n}stroke-width`],x)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${n}scale`in r){const i=E(e,r[`${n}scale`],q);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${i}`)}`${n}displacement`in r&&t.setSymbolOffsetExpression(E(e,r[`${n}displacement`],W)),`${n}rotation`in r&&t.setSymbolRotationExpression(E(e,r[`${n}rotation`],x)),`${n}rotate-with-view`in r&&t.setSymbolRotateWithView(!!r[`${n}rotate-with-view`])}function Ni(r,t,e,n,i){let s="vec4(0.)";if(t!==null&&(s=t),e!==null&&n!==null){const l=`smoothstep(-${n} + 0.63, -${n} - 0.58, ${r})`;s=`mix(${e}, ${s}, ${l})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${r}))`;let a=`${s} * vec4(1.0, 1.0, 1.0, ${o})`;return i!==null&&(a=`${a} * vec4(1.0, 1.0, 1.0, ${i})`),a}function Dr(r,t,e,n,i){const s=new Image;s.crossOrigin=r[`${n}cross-origin`]===void 0?"anonymous":r[`${n}cross-origin`],j(typeof r[`${n}src`]=="string",`WebGL layers do not support expressions for the ${n}src style property`),s.src=r[`${n}src`],e[`u_texture${i}_size`]=()=>s.complete?[s.width,s.height]:[0,0],t.addUniform(`vec2 u_texture${i}_size`);const o=`u_texture${i}_size`;return e[`u_texture${i}`]=s,t.addUniform(`sampler2D u_texture${i}`),o}function Lr(r,t,e,n,i){let s=E(e,r[`${t}offset`],W);if(`${t}offset-origin`in r)switch(r[`${t}offset-origin`]){case"top-right":s=`vec2(${n}.x, 0.) + ${i} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${n}.y) + ${i} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${n} - ${i} - ${s}`;break}return s}function lh(r,t,e,n){n.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,Or(r,t,n,"circle-");let i=null;"circle-opacity"in r&&(i=E(n,r["circle-opacity"],x));let s="coordsPx";"circle-scale"in r&&(s=`coordsPx / ${E(n,r["circle-scale"],q)}`);let o=null;"circle-fill-color"in r&&(o=E(n,r["circle-fill-color"],A));let a=null;"circle-stroke-color"in r&&(a=E(n,r["circle-stroke-color"],A));let l=E(n,r["circle-radius"],x),h=null;"circle-stroke-width"in r&&(h=E(n,r["circle-stroke-width"],x),l=`(${l} + ${h} * 0.5)`);const c=`circleDistanceField(${s}, ${l})`,u=Ni(c,o,a,h,i);t.setSymbolColorExpression(u)}function hh(r,t,e,n){n.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,n.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,n.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,Or(r,t,n,"shape-");let i=null;"shape-opacity"in r&&(i=E(n,r["shape-opacity"],x));let s="coordsPx";"shape-scale"in r&&(s=`coordsPx / ${E(n,r["shape-scale"],q)}`);let o=null;"shape-fill-color"in r&&(o=E(n,r["shape-fill-color"],A));let a=null;"shape-stroke-color"in r&&(a=E(n,r["shape-stroke-color"],A));let l=null;"shape-stroke-width"in r&&(l=E(n,r["shape-stroke-width"],x));const h=E(n,r["shape-points"],x);let c="0.";"shape-angle"in r&&(c=E(n,r["shape-angle"],x));let u,f=E(n,r["shape-radius"],x);if(l!==null&&(f=`${f} + ${l} * 0.5`),"shape-radius2"in r){let p=E(n,r["shape-radius2"],x);l!==null&&(p=`${p} + ${l} * 0.5`),u=`starDistanceField(${s}, ${h}, ${f}, ${p}, ${c})`}else u=`regularDistanceField(${s}, ${h}, ${f}, ${c})`;const g=Ni(u,o,a,l,i);t.setSymbolColorExpression(g)}function ch(r,t,e,n){let i="vec4(1.0)";"icon-color"in r&&(i=E(n,r["icon-color"],A)),"icon-opacity"in r&&(i=`${i} * vec4(1.0, 1.0, 1.0, ${E(n,r["icon-opacity"],x)})`);const s=Se(r["icon-src"]),o=Dr(r,t,e,"icon-",s);if(t.setSymbolColorExpression(`${i} * texture2D(u_texture${s}, v_texCoord)`).setSymbolSizeExpression(o),"icon-width"in r&&"icon-height"in r&&t.setSymbolSizeExpression(`vec2(${E(n,r["icon-width"],x)}, ${E(n,r["icon-height"],x)})`),"icon-offset"in r&&"icon-size"in r){const a=E(n,r["icon-size"],W),l=t.getSymbolSizeExpression();t.setSymbolSizeExpression(a);const h=Lr(r,"icon-",n,"v_quadSizePx",a);t.setTextureCoordinateExpression(`(vec4((${h}).xyxy) + vec4(0., 0., ${a})) / (${l}).xyxy`)}if(Or(r,t,n,"icon-"),"icon-anchor"in r){const a=E(n,r["icon-anchor"],W);let l="1.0";"icon-scale"in r&&(l=E(n,r["icon-scale"],q));let h;r["icon-anchor-x-units"]==="pixels"&&r["icon-anchor-y-units"]==="pixels"?h=`${a} * ${l}`:r["icon-anchor-x-units"]==="pixels"?h=`${a} * vec2(vec2(${l}).x, v_quadSizePx.y)`:r["icon-anchor-y-units"]==="pixels"?h=`${a} * vec2(v_quadSizePx.x, vec2(${l}).x)`:h=`${a} * v_quadSizePx`;let c=`v_quadSizePx * vec2(0.5, -0.5) + ${h} * vec2(-1., 1.)`;if("icon-anchor-origin"in r)switch(r["icon-anchor-origin"]){case"top-right":c=`v_quadSizePx * -0.5 + ${h}`;break;case"bottom-left":c=`v_quadSizePx * 0.5 - ${h}`;break;case"bottom-right":c=`v_quadSizePx * vec2(-0.5, 0.5) + ${h} * vec2(1., -1.)`;break}t.setSymbolOffsetExpression(`${t.getSymbolOffsetExpression()} + ${c}`)}}function uh(r,t,e,n){if("stroke-color"in r&&t.setStrokeColorExpression(E(n,r["stroke-color"],A)),"stroke-pattern-src"in r){const i=Se(r["stroke-pattern-src"]),s=Dr(r,t,e,"stroke-pattern-",i);let o=s,a="vec2(0.)";"stroke-pattern-offset"in r&&"stroke-pattern-size"in r&&(o=E(n,r["stroke-pattern-size"],W),a=Lr(r,"stroke-pattern-",n,s,o));let l="0.";"stroke-pattern-spacing"in r&&(l=E(n,r["stroke-pattern-spacing"],x)),n.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return texture2D(texture, texCoord);
}`;const h=`u_texture${i}`;let c="1.";"stroke-color"in r&&(c=t.getStrokeColorExpression()),t.setStrokeColorExpression(`${c} * sampleStrokePattern(${h}, ${s}, ${a}, ${o}, ${l}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in r&&t.setStrokeWidthExpression(E(n,r["stroke-width"],x)),"stroke-offset"in r&&t.setStrokeOffsetExpression(E(n,r["stroke-offset"],x)),"stroke-line-cap"in r&&t.setStrokeCapExpression(E(n,r["stroke-line-cap"],O)),"stroke-line-join"in r&&t.setStrokeJoinExpression(E(n,r["stroke-line-join"],O)),"stroke-miter-limit"in r&&t.setStrokeMiterLimitExpression(E(n,r["stroke-miter-limit"],x)),"stroke-line-dash"in r){n.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType, float lineWidth) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${ct("square")}) {
    distanceSegment -= lineWidth * 0.5;
  } else if (capType == ${ct("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - lineWidth * 0.5);
  }
  return distanceSegment;
}`;let i=r["stroke-line-dash"].map(u=>E(n,u,x));i.length%2===1&&(i=[...i,...i]);let s="0.";"stroke-line-dash-offset"in r&&(s=E(n,r["stroke-line-dash-offset"],x));const o=`dashDistanceField_${Se(r["stroke-line-dash"])}`,a=i.map((u,f)=>`float dashLength${f} = ${u};`),l=i.map((u,f)=>`dashLength${f}`).join(" + ");let h="0.",c=`getSingleDashDistance(distance, radius, ${h}, dashLength0, totalDashLength, capType, lineWidth)`;for(let u=2;u<i.length;u+=2)h=`${h} + dashLength${u-2} + dashLength${u-1}`,c=`min(${c}, getSingleDashDistance(distance, radius, ${h}, dashLength${u}, totalDashLength, capType, lineWidth))`;n.functions[o]=`float ${o}(float distance, float radius, float capType, float lineWidth) {
  ${a.join(`
  `)}
  float totalDashLength = ${l};
  return ${c};
}`,t.setStrokeDistanceFieldExpression(`${o}(currentLengthPx + ${s}, currentRadiusPx, capType, v_width)`)}}function fh(r,t,e,n){if("fill-color"in r&&t.setFillColorExpression(E(n,r["fill-color"],A)),"fill-pattern-src"in r){const i=Se(r["fill-pattern-src"]),s=Dr(r,t,e,"fill-pattern-",i);let o=s,a="vec2(0.)";"fill-pattern-offset"in r&&"fill-pattern-size"in r&&(o=E(n,r["fill-pattern-size"],W),a=Lr(r,"fill-pattern-",n,s,o)),n.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return texture2D(texture, (samplePos + textureOffset) / textureSize);
}`;const l=`u_texture${i}`;let h="1.";"fill-color"in r&&(h=t.getFillColorExpression()),t.setFillColorExpression(`${h} * sampleFillPattern(${l}, ${s}, ${a}, ${o}, pxOrigin, pxPos)`)}}function dh(r,t,e){const n=Hl(),i=new rh,s={};if("icon-src"in r?ch(r,i,s,n):"shape-points"in r?hh(r,i,s,n):"circle-radius"in r&&lh(r,i,s,n),uh(r,i,s,n),fh(r,i,s,n),e){const l=E(n,e,N);i.setFragmentDiscardExpression(`!${l}`)}const o={};function a(l,h,c,u){if(!n[l])return;const f=Fr(c),g=Mr(c);i.addAttribute(`a_${h}`,f),o[h]={size:g,callback:u}}return a("geometryType",Di,O,l=>qt(ee(l.getGeometry()))),a("featureId",Oi,O|x,l=>{const h=l.getId()??null;return typeof h=="string"?qt(h):h}),sh(i,n),{builder:i,attributes:{...o,...ah(n)},uniforms:{...s,...oh(n,t)}}}function gh(r){const t=Array.isArray(r)?r:[r];if("style"in t[0]){const e=[],n=t,i=[];for(const s of n){const o=Array.isArray(s.style)?s.style:[s.style];let a=s.filter;s.else&&i.length&&(a=["all",...i.map(h=>["!",h])],s.filter&&a.push(s.filter),a.length<3&&(a=a[1])),s.filter&&i.push(s.filter);const l=o.map(h=>({style:h,...a&&{filter:a}}));e.push(...l)}return e}return"builder"in t[0]?t:t.map(e=>({style:e}))}const ph=[];let Nr;function _h(){return Nr||(Nr=Dl()),Nr}let mh=0;const it={POSITION:"a_position",INDEX:"a_index",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",PARAMETERS:"a_parameters",JOIN_ANGLES:"a_joinAngles",DISTANCE:"a_distance"};class xh{constructor(t,e,n,i,s){this.helper_,this.hitDetectionEnabled_=!!i;let o=t;if(!("builder"in t)){const h=t,c=dh(h.style,e,h.filter);o={builder:c.builder,attributes:c.attributes,uniforms:c.uniforms}}this.fillProgram_,this.strokeProgram_,this.symbolProgram_,this.hasFill_=!!o.builder.getFillVertexShader(),this.hasFill_&&(this.fillVertexShader_=o.builder.getFillVertexShader(),this.fillFragmentShader_=o.builder.getFillFragmentShader()),this.hasStroke_=!!o.builder.getStrokeVertexShader(),this.hasStroke_&&(this.strokeVertexShader_=o.builder.getStrokeVertexShader(),this.strokeFragmentShader_=o.builder.getStrokeFragmentShader()),this.hasSymbol_=!!o.builder.getSymbolVertexShader(),this.hasSymbol_&&(this.symbolVertexShader_=o.builder.getSymbolVertexShader(),this.symbolFragmentShader_=o.builder.getSymbolFragmentShader()),this.featureFilter_=null,s&&(this.featureFilter_=this.computeFeatureFilter(s));const a=this.hitDetectionEnabled_?{hitColor:{callback(){return Ll(this.ref,ph)},size:4}}:{};this.customAttributes_=Object.assign({},a,o.attributes),this.uniforms_=o.uniforms;const l=Object.entries(this.customAttributes_).map(([h,c])=>({name:`a_${h}`,size:c.size||1,type:V.FLOAT}));this.polygonAttributesDesc_=[{name:it.POSITION,size:2,type:V.FLOAT},...l],this.lineStringAttributesDesc_=[{name:it.SEGMENT_START,size:2,type:V.FLOAT},{name:it.MEASURE_START,size:1,type:V.FLOAT},{name:it.SEGMENT_END,size:2,type:V.FLOAT},{name:it.MEASURE_END,size:1,type:V.FLOAT},{name:it.JOIN_ANGLES,size:2,type:V.FLOAT},{name:it.DISTANCE,size:1,type:V.FLOAT},{name:it.PARAMETERS,size:1,type:V.FLOAT},...l],this.pointAttributesDesc_=[{name:it.POSITION,size:2,type:V.FLOAT},{name:it.INDEX,size:1,type:V.FLOAT},...l],this.setHelper(n)}computeFeatureFilter(t){const e=te();let n;try{n=et(t,N,e)}catch{return null}if(e.mapState||e.variables.size>0)return null;const i=je();return s=>{if(i.properties=s.getPropertiesInternal(),e.featureId){const o=s.getId();o!==void 0?i.featureId=o:i.featureId=null}return i.geometryType=ee(s.getGeometry()),n(i)}}async generateBuffers(t,e){let n=t;if(this.featureFilter_&&(n=n.filter(this.featureFilter_),n.isEmpty()))return null;const i=this.generateRenderInstructions_(n,e),[s,o,a]=await Promise.all([this.generateBuffersForType_(i.polygonInstructions,"Polygon",e),this.generateBuffersForType_(i.lineStringInstructions,"LineString",e),this.generateBuffersForType_(i.pointInstructions,"Point",e)]),l=hr(nt(),e);return{polygonBuffers:s,lineStringBuffers:o,pointBuffers:a,invertVerticesTransform:l}}generateRenderInstructions_(t,e){const n=this.hasFill_?th(t.polygonBatch,new Float32Array(0),this.customAttributes_,e):null,i=this.hasStroke_?Ql(t.lineStringBatch,new Float32Array(0),this.customAttributes_,e):null,s=this.hasSymbol_?Jl(t.pointBatch,new Float32Array(0),this.customAttributes_,e):null;return{polygonInstructions:n,lineStringInstructions:i,pointInstructions:s}}generateBuffersForType_(t,e,n){if(t===null)return null;const i=mh++;let s;switch(e){case"Polygon":s=$r.GENERATE_POLYGON_BUFFERS;break;case"LineString":s=$r.GENERATE_LINE_STRING_BUFFERS;break;case"Point":s=$r.GENERATE_POINT_BUFFERS;break}const o={id:i,type:s,renderInstructions:t.buffer,renderInstructionsTransform:n,customAttributesSize:Re(this.customAttributes_)},a=_h();return a.postMessage(o,[t.buffer]),t=null,new Promise(l=>{const h=c=>{const u=c.data;if(u.id!==i||(a.removeEventListener("message",h),!this.helper_.getGL()))return;const f=new Ci(yr,Ti).fromArrayBuffer(u.vertexBuffer),g=new Ci(vr,Ti).fromArrayBuffer(u.indexBuffer);this.helper_.flushBufferData(f),this.helper_.flushBufferData(g),l([g,f])};a.addEventListener("message",h)})}render(t,e,n){this.hasFill_&&this.renderInternal_(t.polygonBuffers[0],t.polygonBuffers[1],this.fillProgram_,this.polygonAttributesDesc_,e,n),this.hasStroke_&&this.renderInternal_(t.lineStringBuffers[0],t.lineStringBuffers[1],this.strokeProgram_,this.lineStringAttributesDesc_,e,n),this.hasSymbol_&&this.renderInternal_(t.pointBuffers[0],t.pointBuffers[1],this.symbolProgram_,this.pointAttributesDesc_,e,n)}renderInternal_(t,e,n,i,s,o){const a=t.getSize();a!==0&&(this.helper_.useProgram(n,s),this.helper_.bindBuffer(e),this.helper_.bindBuffer(t),this.helper_.enableAttributes(i),o(),this.helper_.drawElements(0,a))}setHelper(t,e=null){this.helper_=t,this.hasFill_&&(this.fillProgram_=this.helper_.getProgram(this.fillFragmentShader_,this.fillVertexShader_)),this.hasStroke_&&(this.strokeProgram_=this.helper_.getProgram(this.strokeFragmentShader_,this.strokeVertexShader_)),this.hasSymbol_&&(this.symbolProgram_=this.helper_.getProgram(this.symbolFragmentShader_,this.symbolVertexShader_)),this.helper_.addUniforms(this.uniforms_),e&&(e.polygonBuffers&&(this.helper_.flushBufferData(e.polygonBuffers[0]),this.helper_.flushBufferData(e.polygonBuffers[1])),e.lineStringBuffers&&(this.helper_.flushBufferData(e.lineStringBuffers[0]),this.helper_.flushBufferData(e.lineStringBuffers[1])),e.pointBuffers&&(this.helper_.flushBufferData(e.pointBuffers[0]),this.helper_.flushBufferData(e.pointBuffers[1])))}}var yh=xh,Te={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"};const st=new Uint8Array(4);let vh=class{constructor(t,e){this.helper_=t;const n=t.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=e||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){an(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,e){if(t<0||e<0||t>this.size_[0]||e>=this.size_[1])return st[0]=0,st[1]=0,st[2]=0,st[3]=0,st;this.readAll();const n=Math.floor(t)+(this.size_[1]-Math.floor(e)-1)*this.size_[0];return st[0]=this.data_[n*4],st[1]=this.data_[n*4+1],st[2]=this.data_[n*4+2],st[3]=this.data_[n*4+3],st}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),e.bindRenderbuffer(e.RENDERBUFFER,this.depthbuffer_),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t[0],t[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(t[0]*t[1]*4)}};var Eh=vh;function $h(r,t){const e=r.viewState.projection,n=t.getSource().getWrapX()&&e.canWrapX(),i=e.getExtent(),s=r.extent,o=n?Kt(i):null,a=n?Math.ceil((s[2]-i[2])/o)+1:1;return[n?Math.floor((s[0]-i[0])/o):0,a,o]}const Lt={...ht,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};class Rh extends Gl{constructor(t,e){const n={[Lt.RENDER_EXTENT]:[0,0,0,0],[Lt.PATTERN_ORIGIN]:[0,0],[Lt.GLOBAL_ALPHA]:1};super(t,{uniforms:n,postProcesses:e.postProcesses}),this.hitDetectionEnabled_=!e.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=Yt(),this.currentTransform_=nt(),this.tmpCoords_=[0,0],this.tmpTransform_=nt(),this.tmpMat4_=Pi(),this.currentFrameStateTransform_=nt(),this.styleVariables_={},this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(e),this.batch_=new xl,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(t){const e=this.getLayer().getSource();let n;this.batch_.addFeatures(e.getFeatures(),n),this.sourceListenKeys_=[tt(e,Te.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,n)),tt(e,Te.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),tt(e,Te.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),tt(e,Te.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(t){this.styleVariables_=t.variables,this.styles_=gh(t.style)}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map(t=>new yh(t,this.styleVariables_,this.helper,this.hitDetectionEnabled_,"filter"in t?t.filter:null))}reset(t){this.applyOptions_(t),this.helper&&this.createRenderers_(),super.reset(t)}afterHelperCreated(){this.styleRenderers_.length?this.styleRenderers_.forEach((t,e)=>t.setHelper(this.helper,this.buffers_[e])):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Eh(this.helper))}handleSourceFeatureAdded_(t,e){const n=e.feature;this.batch_.addFeature(n,t)}handleSourceFeatureChanged_(t){const e=t.feature;this.batch_.changeFeature(e)}handleSourceFeatureDelete_(t){const e=t.feature;this.batch_.removeFeature(e)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(t){ya(this.tmpTransform_,this.currentFrameStateTransform_),ri(this.tmpTransform_,t),this.helper.setUniformMatrixValue(Lt.PROJECTION_MATRIX,Er(this.tmpMat4_,this.tmpTransform_)),hr(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(Lt.SCREEN_TO_WORLD_MATRIX,Er(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,hr(this.tmpTransform_,t),lr(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(Lt.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(t){const e=this.helper.getGL();this.preRender(e,t);const[n,i,s]=$h(t,this.getLayer());this.helper.prepareDraw(t),this.renderWorlds(t,!1,n,i,s),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const o=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(t,!0,n,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(e,t),o}prepareFrameInternal(t){this.initialFeaturesAdded_||(this.addInitialFeatures_(t),this.initialFeaturesAdded_=!0);const e=this.getLayer(),n=e.getSource(),i=t.viewState,s=!t.viewHints[Q.ANIMATING]&&!t.viewHints[Q.INTERACTING],o=!Yi(this.previousExtent_,t.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),s&&(o||a)){const l=i.projection,h=i.resolution,c=e instanceof fl?e.getRenderBuffer():0,u=Hi(t.extent,c*h);n.loadFeatures(u,h,l),this.ready=!1;const f=this.helper.makeProjectionTransform(t,nt()),g=this.styleRenderers_.map((p,_)=>p.generateBuffers(this.batch_,f).then(m=>{this.buffers_[_]&&this.disposeBuffers(this.buffers_[_]),this.buffers_[_]=m}));Promise.all(g).then(()=>{this.ready=!0,this.getLayer().changed()}),this.previousExtent_=t.extent.slice()}return!0}renderWorlds(t,e,n,i,s){let o=n;e&&(this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0));do{this.helper.makeProjectionTransform(t,this.currentFrameStateTransform_),va(this.currentFrameStateTransform_,o*s,0);for(let a=0,l=this.styleRenderers_.length;a<l;a++){const h=this.styleRenderers_[a],c=this.buffers_[a];c&&h.render(c,t,()=>{this.applyUniforms_(c.invertVerticesTransform),this.helper.applyHitDetectionUniform(e)})}}while(++o<i)}forEachFeatureAtCoordinate(t,e,n,i,s){if(j(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderers_.length||!this.hitDetectionEnabled_)return;const o=lr(e.coordinateToPixelTransform,t.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],h=Nl(l),c=this.batch_.getFeatureFromRef(h);if(c)return i(c,this.getLayer(),null)}disposeBuffers(t){const e=n=>{for(const i of n)i&&this.helper.deleteBuffer(i)};t.pointBuffers&&e(t.pointBuffers),t.lineStringBuffers&&e(t.lineStringBuffers),t.polygonBuffers&&e(t.polygonBuffers)}disposeInternal(){this.buffers_.forEach(t=>{t&&this.disposeBuffers(t)}),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(t){Rt(t)}),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}}var Sh=Rh;class Th extends Ei{constructor(t){const e=Object.assign({},t);super(e),this.styleVariables_=t.variables||{},this.style_=t.style,this.hitDetectionDisabled_=!!t.disableHitDetection}createRenderer(){return new Sh(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}setStyle(t){this.style_=t,this.clearRenderer(),this.changed()}}var bh=Th;export{bh as default};
