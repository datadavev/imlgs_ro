var c={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function $(i,t){const n=i[0],o=i[1],e=i[2],s=i[3],r=t[0],l=t[1];let h=c.UNKNOWN;return r<n?h=h|c.LEFT:r>e&&(h=h|c.RIGHT),l<o?h=h|c.BELOW:l>s&&(h=h|c.ABOVE),h===c.UNKNOWN&&(h=c.INTERSECTING),h}function Q(){return[1/0,1/0,-1/0,-1/0]}function J(i,t,n,o,e){return e?(e[0]=i,e[1]=t,e[2]=n,e[3]=o,e):[i,t,n,o]}function tt(i,t,n,o,e){for(;n<o;n+=e)it(i,t[n],t[n+1]);return i}function it(i,t,n){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],n),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],n)}function nt(i){return[i[0],i[3]]}function et(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function ot(i,t,n){let o=!1;const e=$(i,t),s=$(i,n);if(e===c.INTERSECTING||s===c.INTERSECTING)o=!0;else{const r=i[0],l=i[1],h=i[2],u=i[3],a=t[0],m=t[1],f=n[0],E=n[1],S=(E-m)/(f-a);let x,d;s&c.ABOVE&&!(e&c.ABOVE)&&(x=f-(E-u)/S,o=x>=r&&x<=h),!o&&s&c.RIGHT&&!(e&c.RIGHT)&&(d=E-(f-h)*S,o=d>=l&&d<=u),!o&&s&c.BELOW&&!(e&c.BELOW)&&(x=f-(E-l)/S,o=x>=r&&x<=h),!o&&s&c.LEFT&&!(e&c.LEFT)&&(d=E-(f-r)*S,o=d>=l&&d<=u)}return o}function st(i,t,n){return Math.min(Math.max(i,t),n)}function L(i,t){const n=Math.pow(10,t);return Math.round(i*n)/n}function F(i,t){return Math.floor(L(i,t))}function P(i,t){return Math.ceil(L(i,t))}const rt={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let lt=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||rt[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};var O=lt;const z=6378137,p=Math.PI*z,ht=[-p,-p,p,p],ut=[-180,-85,180,85],G=z*Math.log(Math.tan(Math.PI/2));let w=class extends O{constructor(t){super({code:t,units:"m",extent:ht,global:!0,worldExtent:ut,getPointResolution:function(n,o){return n/Math.cosh(o[1]/z)}})}};const U=[new w("EPSG:3857"),new w("EPSG:102100"),new w("EPSG:102113"),new w("EPSG:900913"),new w("http://www.opengis.net/def/crs/EPSG/0/3857"),new w("http://www.opengis.net/gml/srs/epsg.xml#3857")];function at(i,t,n,o){const e=i.length;n=n>1?n:2,o=o??n,t===void 0&&(n>2?t=i.slice():t=new Array(e));for(let s=0;s<e;s+=o){t[s]=p*i[s]/180;let r=z*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));r>G?r=G:r<-G&&(r=-G),t[s+1]=r}return t}function ct(i,t,n,o){const e=i.length;n=n>1?n:2,o=o??n,t===void 0&&(n>2?t=i.slice():t=new Array(e));for(let s=0;s<e;s+=o)t[s]=180*i[s]/p,t[s+1]=360*Math.atan(Math.exp(i[s+1]/z))/Math.PI-90;return t}const gt=6378137,y=[-180,-90,180,90],mt=Math.PI*gt/180;class T extends O{constructor(t,n){super({code:t,units:"degrees",extent:y,axisOrientation:n,global:!0,metersPerUnit:mt,worldExtent:y})}}const H=[new T("CRS:84"),new T("EPSG:4326","neu"),new T("urn:ogc:def:crs:OGC:1.3:CRS84"),new T("urn:ogc:def:crs:OGC:2:84"),new T("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new T("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new T("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let b={};function ft(i){return b[i]||b[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function dt(i,t){b[i]=t}let N={};function Z(i,t,n){const o=i.getCode(),e=t.getCode();o in N||(N[o]={}),N[o][e]=n}const xt=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function _t(i){let t=0;for(const e of xt){const s=i.match(e);if(s){t=parseInt(s[1]);break}}if(!t)return null;let n=0,o=!1;return t>32700&&t<32761?n=t-32700:t>32600&&t<32661&&(o=!0,n=t-32600),n?{number:n,north:o}:null}function Et(i){return _t(i)?new O({code:i,units:"m"}):null}const Tt=[Et];function B(i,t){if(t!==void 0){for(let n=0,o=i.length;n<o;++n)t[n]=i[n];t=t}else t=i.slice();return t}function St(i){dt(i.getCode(),i),Z(i,i,B)}function pt(i){i.forEach(St)}function wt(i){if(typeof i!="string")return i;const t=ft(i);if(t)return t;for(const n of Tt){const o=n(i);if(o)return o}return null}function V(i){pt(i),i.forEach(function(t){i.forEach(function(n){t!==n&&Z(t,n,B)})})}function Mt(i,t,n,o){i.forEach(function(e){t.forEach(function(s){Z(e,s,n),Z(s,e,o)})})}function Rt(){V(U),V(H),Mt(H,U,at,ct)}Rt();class q{constructor(t,n,o,e){this.minX=t,this.maxX=n,this.minY=o,this.maxY=e}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,n){return this.minX<=t&&t<=this.maxX&&this.minY<=n&&n<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function M(i,t,n,o,e){return e!==void 0?(e.minX=i,e.maxX=t,e.minY=n,e.maxY=o,e):new q(i,t,n,o)}var Xt=q;function zt(i,t){return i>t?1:i<t?-1:0}function Yt(i,t,n){if(i[0]<=t)return 0;const o=i.length;if(t<=i[o-1])return o-1;if(typeof n=="function"){for(let e=1;e<o;++e){const s=i[e];if(s===t)return e;if(s<t)return n(t,i[e-1],s)>0?e-1:e}return o-1}if(n>0){for(let e=1;e<o;++e)if(i[e]<t)return e-1;return o-1}if(n<0){for(let e=1;e<o;++e)if(i[e]<=t)return e;return o-1}for(let e=1;e<o;++e){if(i[e]==t)return e;if(i[e]<t)return i[e-1]-t<t-i[e]?e-1:e}return o-1}function Ct(i,t,n){const o=t||zt;return i.every(function(e,s){if(s===0)return!0;const r=o(i[s-1],e);return!(r>0||r===0)})}function Y(i,t){if(!i)throw new Error(t)}function I(i,t,n,o,e,s){let r=0,l=i[n-o],h=i[n-o+1];for(;t<n;t+=o){const u=i[t],a=i[t+1];h<=s?a>s&&(u-l)*(s-h)-(e-l)*(a-h)>0&&r++:a<=s&&(u-l)*(s-h)-(e-l)*(a-h)<0&&r--,l=u,h=a}return r!==0}function Ft(i,t,n,o,e){let s;for(t+=o;t<n;t+=o)if(s=e(i.slice(t-o,t),i.slice(t,t+o)),s)return s;return!1}function Pt(i,t,n,o,e,s){return s=s??tt(Q(),i,t,n,o),et(e,s)?s[0]>=e[0]&&s[2]<=e[2]||s[1]>=e[1]&&s[3]<=e[3]?!0:Ft(i,t,n,o,function(r,l){return ot(e,r,l)}):!1}function Gt(i,t,n,o,e){return!!(Pt(i,t,n,o,e)||I(i,t,n,o,e[0],e[1])||I(i,t,n,o,e[0],e[3])||I(i,t,n,o,e[2],e[1])||I(i,t,n,o,e[2],e[3]))}function v(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}function K(i,t,n,o){return o!==void 0?(o[0]=i,o[1]=t,o[2]=n,o):[i,t,n]}const Zt=256,R=[0,0,0],_=5;class It{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Y(Ct(this.resolutions_,(e,s)=>s-e),"`resolutions` must be sorted in descending order");let n;if(!t.origins){for(let e=0,s=this.resolutions_.length-1;e<s;++e)if(!n)n=this.resolutions_[e]/this.resolutions_[e+1];else if(this.resolutions_[e]/this.resolutions_[e+1]!==n){n=void 0;break}}this.zoomFactor_=n,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Y(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const o=t.extent;o!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=nt(o)),Y(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Y(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Zt,Y(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=o!==void 0?o:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((e,s)=>{const r=new Xt(Math.min(0,e[0]),Math.max(e[0]-1,-1),Math.min(0,e[1]),Math.max(e[1]-1,-1));if(o){const l=this.getTileRangeForExtentAndZ(o,s);r.minX=Math.max(l.minX,r.minX),r.maxX=Math.min(l.maxX,r.maxX),r.minY=Math.max(l.minY,r.minY),r.maxY=Math.min(l.maxY,r.maxY)}return r}):o&&this.calculateTileRanges_(o)}forEachTileCoord(t,n,o){const e=this.getTileRangeForExtentAndZ(t,n);for(let s=e.minX,r=e.maxX;s<=r;++s)for(let l=e.minY,h=e.maxY;l<=h;++l)o([n,s,l])}forEachTileCoordParentTileRange(t,n,o,e){let s,r,l,h=null,u=t[0]-1;for(this.zoomFactor_===2?(r=t[1],l=t[2]):h=this.getTileCoordExtent(t,e);u>=this.minZoom;){if(r!==void 0&&l!==void 0?(r=Math.floor(r/2),l=Math.floor(l/2),s=M(r,r,l,l,o)):s=this.getTileRangeForExtentAndZ(h,u,o),n(u,s))return!0;--u}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,n,o){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,r=t[2]*2;return M(s,s+1,r,r+1,n)}const e=this.getTileCoordExtent(t,o||this.tmpExtent_);return this.getTileRangeForExtentAndZ(e,t[0]+1,n)}return null}getTileRangeForTileCoordAndZ(t,n,o){if(n>this.maxZoom||n<this.minZoom)return null;const e=t[0],s=t[1],r=t[2];if(n===e)return M(s,r,s,r,o);if(this.zoomFactor_){const h=Math.pow(this.zoomFactor_,n-e),u=Math.floor(s*h),a=Math.floor(r*h);if(n<e)return M(u,u,a,a,o);const m=Math.floor(h*(s+1))-1,f=Math.floor(h*(r+1))-1;return M(u,m,a,f,o)}const l=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,n,o)}getTileRangeForExtentAndZ(t,n,o){this.getTileCoordForXYAndZ_(t[0],t[3],n,!1,R);const e=R[1],s=R[2];this.getTileCoordForXYAndZ_(t[2],t[1],n,!0,R);const r=R[1],l=R[2];return M(e,r,s,l,o)}getTileCoordCenter(t){const n=this.getOrigin(t[0]),o=this.getResolution(t[0]),e=v(this.getTileSize(t[0]),this.tmpSize_);return[n[0]+(t[1]+.5)*e[0]*o,n[1]-(t[2]+.5)*e[1]*o]}getTileCoordExtent(t,n){const o=this.getOrigin(t[0]),e=this.getResolution(t[0]),s=v(this.getTileSize(t[0]),this.tmpSize_),r=o[0]+t[1]*s[0]*e,l=o[1]-(t[2]+1)*s[1]*e,h=r+s[0]*e,u=l+s[1]*e;return J(r,l,h,u,n)}getTileCoordForCoordAndResolution(t,n,o){return this.getTileCoordForXYAndResolution_(t[0],t[1],n,!1,o)}getTileCoordForXYAndResolution_(t,n,o,e,s){const r=this.getZForResolution(o),l=o/this.getResolution(r),h=this.getOrigin(r),u=v(this.getTileSize(r),this.tmpSize_);let a=l*(t-h[0])/o/u[0],m=l*(h[1]-n)/o/u[1];return e?(a=P(a,_)-1,m=P(m,_)-1):(a=F(a,_),m=F(m,_)),K(r,a,m,s)}getTileCoordForXYAndZ_(t,n,o,e,s){const r=this.getOrigin(o),l=this.getResolution(o),h=v(this.getTileSize(o),this.tmpSize_);let u=(t-r[0])/l/h[0],a=(r[1]-n)/l/h[1];return e?(u=P(u,_)-1,a=P(a,_)-1):(u=F(u,_),a=F(a,_)),K(o,u,a,s)}getTileCoordForCoordAndZ(t,n,o){return this.getTileCoordForXYAndZ_(t[0],t[1],n,!1,o)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,n){const o=Yt(this.resolutions_,t,n||0);return st(o,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,n){return Gt(n,0,n.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const n=this.resolutions_.length,o=new Array(n);for(let e=this.minZoom;e<n;++e)o[e]=this.getTileRangeForExtentAndZ(t,e);this.fullTileRanges_=o}}var vt=It;class D extends vt{constructor(t){super({extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes}),this.matrixIds_=t.matrixIds}getMatrixId(t){return this.matrixIds_[t]}getMatrixIds(){return this.matrixIds_}}var At=D;function Ot(i,t,n){const o=[],e=[],s=[],r=[],l=[];n=n!==void 0?n:[];const h="SupportedCRS",u="TileMatrix",a="Identifier",m="ScaleDenominator",f="TopLeftCorner",E="TileWidth",S="TileHeight",x=i[h],d=wt(x),k=d.getMetersPerUnit(),j=d.getAxisOrientation().startsWith("ne");return i[u].sort(function(g,X){return X[m]-g[m]}),i[u].forEach(function(g){let X;if(n.length>0?X=n.find(function(C){return g[a]==C[u]?!0:g[a].includes(":")?!1:i[a]+":"+g[a]===C[u]}):X=!0,X){e.push(g[a]);const C=g[m]*28e-5/k,A=g[E],W=g[S];j?s.push([g[f][1],g[f][0]]):s.push(g[f]),o.push(C),r.push(A==W?A:[A,W]),l.push([g.MatrixWidth,g.MatrixHeight])}}),new D({extent:t,origins:s,resolutions:o,matrixIds:e,tileSizes:r,sizes:l})}export{Ot as createFromCapabilitiesMatrixSet,At as default};
