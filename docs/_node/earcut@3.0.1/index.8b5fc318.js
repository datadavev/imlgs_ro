function K(n,r,t=2){const e=r&&r.length,x=e?r[0]*t:n.length;let i=F(n,0,x,t,!0);const u=[];if(!i||i.next===i.prev)return u;let l,o,f;if(e&&(i=Q(n,r,i,t)),n.length>80*t){l=1/0,o=1/0;let h=-1/0,s=-1/0;for(let a=t;a<x;a+=t){const Z=n[a],p=n[a+1];Z<l&&(l=Z),p<o&&(o=p),Z>h&&(h=Z),p>s&&(s=p)}f=Math.max(h-l,s-o),f=f!==0?32767/f:0}return w(i,u,t,l,o,f,0),u}function F(n,r,t,e,x){let i;if(x===C(n,r,t,e)>0)for(let u=r;u<t;u+=e)i=J(u/e|0,n[u],n[u+1],i);else for(let u=t-e;u>=r;u-=e)i=J(u/e|0,n[u],n[u+1],i);return i&&g(i,i.next)&&(k(i),i=i.next),i}function M(n,r){if(!n)return n;r||(r=n);let t=n,e;do if(e=!1,!t.steiner&&(g(t,t.next)||v(t.prev,t,t.next)===0)){if(k(t),t=r=t.prev,t===t.next)break;e=!0}else t=t.next;while(e||t!==r);return r}function w(n,r,t,e,x,i,u){if(!n)return;!u&&i&&V(n,e,x,i);let l=n;for(;n.prev!==n.next;){const o=n.prev,f=n.next;if(i?N(n,e,x,i):L(n)){r.push(o.i,n.i,f.i),k(n),n=f.next,l=f.next;continue}if(n=f,n===l){u?u===1?(n=O(M(n),r),w(n,r,t,e,x,i,2)):u===2&&P(n,r,t,e,x,i):w(M(n),r,t,e,x,i,1);break}}}function L(n){const r=n.prev,t=n,e=n.next;if(v(r,t,e)>=0)return!1;const x=r.x,i=t.x,u=e.x,l=r.y,o=t.y,f=e.y,h=Math.min(x,i,u),s=Math.min(l,o,f),a=Math.max(x,i,u),Z=Math.max(l,o,f);let p=e.next;for(;p!==r;){if(p.x>=h&&p.x<=a&&p.y>=s&&p.y<=Z&&z(x,l,i,o,u,f,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function N(n,r,t,e){const x=n.prev,i=n,u=n.next;if(v(x,i,u)>=0)return!1;const l=x.x,o=i.x,f=u.x,h=x.y,s=i.y,a=u.y,Z=Math.min(l,o,f),p=Math.min(h,s,a),m=Math.max(l,o,f),d=Math.max(h,s,a),D=A(Z,p,r,t,e),E=A(m,d,r,t,e);let y=n.prevZ,c=n.nextZ;for(;y&&y.z>=D&&c&&c.z<=E;){if(y.x>=Z&&y.x<=m&&y.y>=p&&y.y<=d&&y!==x&&y!==u&&z(l,h,o,s,f,a,y.x,y.y)&&v(y.prev,y,y.next)>=0||(y=y.prevZ,c.x>=Z&&c.x<=m&&c.y>=p&&c.y<=d&&c!==x&&c!==u&&z(l,h,o,s,f,a,c.x,c.y)&&v(c.prev,c,c.next)>=0))return!1;c=c.nextZ}for(;y&&y.z>=D;){if(y.x>=Z&&y.x<=m&&y.y>=p&&y.y<=d&&y!==x&&y!==u&&z(l,h,o,s,f,a,y.x,y.y)&&v(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;c&&c.z<=E;){if(c.x>=Z&&c.x<=m&&c.y>=p&&c.y<=d&&c!==x&&c!==u&&z(l,h,o,s,f,a,c.x,c.y)&&v(c.prev,c,c.next)>=0)return!1;c=c.nextZ}return!0}function O(n,r){let t=n;do{const e=t.prev,x=t.next.next;!g(e,x)&&H(e,t,t.next,x)&&b(e,x)&&b(x,e)&&(r.push(e.i,t.i,x.i),k(t),k(t.next),t=n=x),t=t.next}while(t!==n);return M(t)}function P(n,r,t,e,x,i){let u=n;do{let l=u.next.next;for(;l!==u.prev;){if(u.i!==l.i&&Y(u,l)){let o=I(u,l);u=M(u,u.next),o=M(o,o.next),w(u,r,t,e,x,i,0),w(o,r,t,e,x,i,0);return}l=l.next}u=u.next}while(u!==n)}function Q(n,r,t,e){const x=[];for(let i=0,u=r.length;i<u;i++){const l=r[i]*e,o=i<u-1?r[i+1]*e:n.length,f=F(n,l,o,e,!1);f===f.next&&(f.steiner=!0),x.push(X(f))}x.sort(R);for(let i=0;i<x.length;i++)t=S(x[i],t);return t}function R(n,r){let t=n.x-r.x;if(t===0&&(t=n.y-r.y,t===0)){const e=(n.next.y-n.y)/(n.next.x-n.x),x=(r.next.y-r.y)/(r.next.x-r.x);t=e-x}return t}function S(n,r){const t=T(n,r);if(!t)return r;const e=I(t,n);return M(e,e.next),M(t,t.next)}function T(n,r){let t=r;const e=n.x,x=n.y;let i=-1/0,u;if(g(n,t))return t;do{if(g(n,t.next))return t.next;if(x<=t.y&&x>=t.next.y&&t.next.y!==t.y){const s=t.x+(x-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(s<=e&&s>i&&(i=s,u=t.x<t.next.x?t:t.next,s===e))return u}t=t.next}while(t!==r);if(!u)return null;const l=u,o=u.x,f=u.y;let h=1/0;t=u;do{if(e>=t.x&&t.x>=o&&e!==t.x&&G(x<f?e:i,x,o,f,x<f?i:e,x,t.x,t.y)){const s=Math.abs(x-t.y)/(e-t.x);b(t,n)&&(s<h||s===h&&(t.x>u.x||t.x===u.x&&U(u,t)))&&(u=t,h=s)}t=t.next}while(t!==l);return u}function U(n,r){return v(n.prev,n,r.prev)<0&&v(r.next,n,n.next)<0}function V(n,r,t,e){let x=n;do x.z===0&&(x.z=A(x.x,x.y,r,t,e)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next;while(x!==n);x.prevZ.nextZ=null,x.prevZ=null,W(x)}function W(n){let r,t=1;do{let e=n,x;n=null;let i=null;for(r=0;e;){r++;let u=e,l=0;for(let f=0;f<t&&(l++,u=u.nextZ,!!u);f++);let o=t;for(;l>0||o>0&&u;)l!==0&&(o===0||!u||e.z<=u.z)?(x=e,e=e.nextZ,l--):(x=u,u=u.nextZ,o--),i?i.nextZ=x:n=x,x.prevZ=i,i=x;e=u}i.nextZ=null,t*=2}while(r>1);return n}function A(n,r,t,e,x){return n=(n-t)*x|0,r=(r-e)*x|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,n|r<<1}function X(n){let r=n,t=n;do(r.x<t.x||r.x===t.x&&r.y<t.y)&&(t=r),r=r.next;while(r!==n);return t}function G(n,r,t,e,x,i,u,l){return(x-u)*(r-l)>=(n-u)*(i-l)&&(n-u)*(e-l)>=(t-u)*(r-l)&&(t-u)*(i-l)>=(x-u)*(e-l)}function z(n,r,t,e,x,i,u,l){return!(n===u&&r===l)&&G(n,r,t,e,x,i,u,l)}function Y(n,r){return n.next.i!==r.i&&n.prev.i!==r.i&&!_(n,r)&&(b(n,r)&&b(r,n)&&$(n,r)&&(v(n.prev,n,r.prev)||v(n,r.prev,r))||g(n,r)&&v(n.prev,n,n.next)>0&&v(r.prev,r,r.next)>0)}function v(n,r,t){return(r.y-n.y)*(t.x-r.x)-(r.x-n.x)*(t.y-r.y)}function g(n,r){return n.x===r.x&&n.y===r.y}function H(n,r,t,e){const x=q(v(n,r,t)),i=q(v(n,r,e)),u=q(v(t,e,n)),l=q(v(t,e,r));return!!(x!==i&&u!==l||x===0&&j(n,t,r)||i===0&&j(n,e,r)||u===0&&j(t,n,e)||l===0&&j(t,r,e))}function j(n,r,t){return r.x<=Math.max(n.x,t.x)&&r.x>=Math.min(n.x,t.x)&&r.y<=Math.max(n.y,t.y)&&r.y>=Math.min(n.y,t.y)}function q(n){return n>0?1:n<0?-1:0}function _(n,r){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==r.i&&t.next.i!==r.i&&H(t,t.next,n,r))return!0;t=t.next}while(t!==n);return!1}function b(n,r){return v(n.prev,n,n.next)<0?v(n,r,n.next)>=0&&v(n,n.prev,r)>=0:v(n,r,n.prev)<0||v(n,n.next,r)<0}function $(n,r){let t=n,e=!1;const x=(n.x+r.x)/2,i=(n.y+r.y)/2;do t.y>i!=t.next.y>i&&t.next.y!==t.y&&x<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(e=!e),t=t.next;while(t!==n);return e}function I(n,r){const t=B(n.i,n.x,n.y),e=B(r.i,r.x,r.y),x=n.next,i=r.prev;return n.next=r,r.prev=n,t.next=x,x.prev=t,e.next=t,t.prev=e,i.next=e,e.prev=i,e}function J(n,r,t,e){const x=B(n,r,t);return e?(x.next=e.next,x.prev=e,e.next.prev=x,e.next=x):(x.prev=x,x.next=x),x}function k(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function B(n,r,t){return{i:n,x:r,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function nn(n,r,t,e){const x=r&&r.length,i=x?r[0]*t:n.length;let u=Math.abs(C(n,0,i,t));if(x)for(let o=0,f=r.length;o<f;o++){const h=r[o]*t,s=o<f-1?r[o+1]*t:n.length;u-=Math.abs(C(n,h,s,t))}let l=0;for(let o=0;o<e.length;o+=3){const f=e[o]*t,h=e[o+1]*t,s=e[o+2]*t;l+=Math.abs((n[f]-n[s])*(n[h+1]-n[f+1])-(n[f]-n[h])*(n[s+1]-n[f+1]))}return u===0&&l===0?0:Math.abs((l-u)/u)}function C(n,r,t,e){let x=0;for(let i=r,u=t-e;i<t;i+=e)x+=(n[u]-n[i])*(n[i+1]+n[u+1]),u=i;return x}function tn(n){const r=[],t=[],e=n[0][0].length;let x=0,i=0;for(const u of n){for(const l of u)for(let o=0;o<e;o++)r.push(l[o]);i&&(x+=i,t.push(x)),i=u.length}return{vertices:r,holes:t,dimensions:e}}export{K as default,nn as deviation,tn as flatten};
